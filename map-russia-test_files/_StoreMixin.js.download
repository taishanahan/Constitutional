//>>built
define("dgrid/_StoreMixin","dojo/_base/kernel dojo/_base/declare dojo/_base/lang dojo/_base/Deferred dojo/on dojo/aspect put-selector/put".split(" "),function(t,z,f,p,A,u,q){function B(a){return a}function v(a){if("object"!==typeof a)a=Error(a);else if("cancel"===a.dojoType)return;a.grid=this;A.emit(this.domNode,"dgrid-error",{grid:this,error:a,cancelable:!0,bubbles:!0})}return z("dgrid._StoreMixin",null,{store:null,query:null,queryOptions:null,getBeforePut:!0,noDataMessage:"",loadingMessage:"",constructor:function(){this.query=
{};this.queryOptions={};this.dirty={};this._updating={};this._columnsWithSet={};u.before(this,"configStructure",f.hitch(this,function(){this._columnsWithSet={}}))},postCreate:function(){this.inherited(arguments);this.store&&this._updateNotifyHandle(this.store)},destroy:function(){this.inherited(arguments);this._notifyHandle&&this._notifyHandle.remove()},_configColumn:function(a){a.set&&(this._columnsWithSet[a.field]=a);this.inherited(arguments)},_updateNotifyHandle:function(a){this._notifyHandle&&
(this._notifyHandle.remove(),delete this._notifyHandle);a&&"function"===typeof a.notify&&this.shouldObserveStore&&(this._notifyHandle=u.after(a,"notify",f.hitch(this,"_onNotify"),!0),this.get("sort"))},_setStore:function(a,b,c){this._updateNotifyHandle(a);this.store=a;this.dirty={};this.set("query",b,c)},_setQuery:function(a,b){var c=b&&b.sort;this.query=void 0!==a?a:this.query;this.queryOptions=b||this.queryOptions;this._started&&(c?this.set("sort",c):this.refresh())},setStore:function(a,b,c){t.deprecated("setStore(...)",
'use set("store", ...) instead',"dgrid 0.4");this.set("store",a,b,c)},setQuery:function(a,b){t.deprecated("setQuery(...)",'use set("query", ...) instead',"dgrid 0.4");this.set("query",a,b)},_getQueryOptions:function(){var a=f.delegate(this.queryOptions,{});if("function"===typeof this._sort||this._sort.length)a.sort=this._sort;return a},_getQuery:function(){var a=this.query;return"object"==typeof a&&null!=a?f.delegate(a,{}):a},_setSort:function(a,b){this.store&&(this._lastCollection=null);this.inherited(arguments)},
_onNotify:function(a,b){this.inherited(arguments);a&&1>this._numObservers&&this.refresh({keepScrollPosition:!0})},refresh:function(){var a=this.inherited(arguments);this.store||(this.noDataNode=q(this.contentNode,"div.dgrid-no-data"),this.noDataNode.innerHTML=this.noDataMessage);return a},renderArray:function(){var a=this,b=this.inherited(arguments);this.store||p.when(b,function(c){c.length&&a.noDataNode&&q(a.noDataNode,"!")});return b},_onEmptyRender:function(){},insertRow:function(a,b,c,g,h){var d=
this.store,r=this.dirty;d=d&&d.getIdentity(a);var e;d in r&&!(d in this._updating)&&(e=r[d]);e&&(a=f.delegate(a,e));return this.inherited(arguments)},updateDirty:function(a,b,c){var g=this.dirty,h=g[a];h||(h=g[a]={});h[b]=c},setDirty:function(a,b,c){t.deprecated("setDirty(...)","use updateDirty() instead","dgrid 0.4");this.updateDirty(a,b,c)},save:function(){function a(k,l){return function(m){var w=b._columnsWithSet,x=b._updating,n;if("function"===typeof m.set)m.set(l);else for(n in l)m[n]=l[n];for(n in w){var y=
w[n].set(m);void 0!==y&&(m[n]=y)}x[k]=!0;return p.when(c.put(m),function(){delete g[k];delete x[k]})}}var b=this,c=this.store,g=this.dirty,h=new p,d=h.promise,r=function(k){var l;return b.getBeforePut||!(l=b.row(k).data)?function(){return c.get(k)}:function(){return l}},e;for(e in g){var C=a(e,g[e]);d=d.then(r(e)).then(C)}h.resolve();return d},revert:function(){this.dirty={};this.refresh()},_trackError:function(a){"string"==typeof a&&(a=f.hitch(this,a));try{var b=a()}catch(c){v.call(this,c)}return p.when(b,
B,f.hitch(this,v))},newRow:function(){var a=this.inherited(arguments);this.noDataNode&&(q(this.noDataNode,"!"),delete this.noDataNode);return a},removeRow:function(a,b){var c={element:a};!b&&this.noDataMessage&&this.up(c).element===a&&this.down(c).element===a&&(this.noDataNode=q(this.contentNode,"div.dgrid-no-data"),this.noDataNode.innerHTML=this.noDataMessage);return this.inherited(arguments)}})});