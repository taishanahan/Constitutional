//>>built
define("esri/dijit/analysis/utils","require dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/_base/event dojo/_base/fx dojo/_base/json dojo/_base/kernel dojo/dom-attr dojo/has dojo/i18n dojo/io-query dojo/i18n!../../nls/jsapi dojo/json dojo/string dojo/query dojo/date/locale dojo/dom-style dojo/dom-class dojo/dom-construct dojo/Deferred dojo/promise/all dojo/fx/easing dojo/number dojo/_base/window dojo/when dojo/dom dojo/on dojo/data/ItemFileWriteStore dojo/topic dojo/store/Memory dojox/mvc/equals dijit/registry dijit/Dialog dijit/form/CheckBox ../../kernel ../../lang ../../units ../../request ./HelpWindow ../../tasks/query ../../dijit/BrowseItems ../../layers/FeatureLayer ./PluginAnalysisLayers ../../tasks/Geoprocessor ../../dijit/SingleFilter ./FeatureRecordSetLayer ./PluginLayers ./PCSList ./ItemTypes ../../layers/ArcGISImageServiceLayer ../../layers/RasterXLayer ../../layers/RasterFunction ./AnalysisRegistry ../RasterFunctionEditor/utils".split(" "),
function(aa,I,l,x,wa,ba,S,ca,da,O,xa,ya,ea,F,J,r,K,T,G,za,C,D,fa,U,H,ha,P,V,W,ia,Aa,ja,ka,la,ma,X,na,k,p,Q,oa,pa,qa,L,Ba,Y,Ca,ra,Da,Z,E,M,sa,ta,q,ua){I={};l.mixin(I,{_helpDialog:null,systemRFTGroupName:"Raster Function Templates",i18n:null,UNITSMAP:{Feet:"esriFeet",Yards:"esriYards",Miles:"esriMiles",Meters:"esriMeters",Kilometers:"esriKilometers",NauticalMiles:"esriNauticalMiles"},initHelpLinks:function(a,b,d){if(a){var c=la.byNode(a),f=c?c.get("helpFileName"):d&&d.helpFileName?d.helpFileName:null,
e=c?c.get("isSingleTenant"):d&&d.isSingleTenant?d.isSingleTenant:!1,g=q.Modes.standard,h=c&&c.portalSelf?c.portalSelf.helpBase:d&&d.helpBase?d.helpBase:null,m=c&&c.portalSelf;this._helpDialog||(this._helpDialog=new oa({isPortal:e,portalSelf:m}));c&&(c.showGeoAnalyticsParams||c.showBigData)||d&&d.analysisMode&&d.analysisMode===q.Modes.Bigdata?(f+="_bd",g=q.Modes.Bigdata):d&&d.analysisMode&&"raster"===d.analysisMode&&(f+="_ra",g=q.Modes.Raster);K("[esriHelpTopic]",a).forEach(function(t,B,w){t&&(G.set(t,
"display",k.isDefined(b)&&!0!==b?"none":""),k.isDefined(t._helpClickHandler)&&(t._helpClickHandler.remove(),t._helpClickHandler=null),t._helpClickHandler=W(t,"click",l.hitch(this,function(u){ba.stop(u);d&&d.showHelpFromUrl&&d.helpUrl?this._helpDialog.show(u,{showHelpFromUrl:d.showHelpFromUrl,helpUrl:d.helpUrl}):this._helpDialog.show(u,{helpId:O.get(t,"esriHelpTopic"),helpFileName:f,analysisGpServer:d&&d.analysisGpServer?d.analysisGpServer:null,helpParentNode:a,isPortal:e,analysisMode:g,helpBase:h,
portalSelf:c&&c.portalSelf})})))},this)}},constructAnalysisFeatColl:function(a){var b={},d;b.featureCollection=a.layerDefinition;for(d in b.featureCollection)b.featureCollection.hasOwnProperty(d)&&"objectIdField"===d&&(b.featureCollection.objectIdFieldName=l.clone(b.featureCollection.objectIdField),delete b.featureCollection.objectIdField);b.featureCollection.features=a.featureSet.features;return b},constructAnalysisInputLyrObj:function(a,b,d){if(a instanceof M||"Image Service"===a.type||"esri.layers.RasterXLayer"===
a.declaredClass)return ua.getRasterJsonFromLayer(a);var c={},f="";k.isDefined(d)||(d=!0);if(a.getMap)var e=a.getMap();else a._map&&(e=a._map);if(a.url&&!a._collection)c={url:a.url},this.isHostedService(a.url),a.getDefinitionExpression&&a.getDefinitionExpression()?c.filter=a.getDefinitionExpression():k.isDefined(a.definitionExpression)&&""!==a.definitionExpression&&(c.filter=a.definitionExpression),a.useMapTime&&a.timeInfo&&e&&e.timeExtent&&d&&(e.timeExtent.startTime?(f+=e.timeExtent.startTime.getTime(),
e.timeExtent.endTime&&(f+=","+e.timeExtent.endTime.getTime())):e.timeExtent.endTime&&(f+=e.timeExtent.endTime.getTime()),f&&(c.time=f)),a.credential&&(c.serviceToken=a.credential.token),-1!==c.url.indexOf("?")&&(d=c.url.substring(c.url.indexOf("?")+1,c.url.length),d=ea.queryToObject(d),l.mixin(c,d),c.url=c.url.substring(0,c.url.indexOf("?")));else if(!a.url||a._collection)try{c=a.toJson()}catch(g){a._json=J.parse(a._json),c=a.toJson()}c.name=a.name;b&&(c=new ra(c));return c},formatDate:function(a){return T.format(a,
{datePattern:"yyyy-MM-dd",selector:"date"})+" "+T.format(a,{selector:"time",timePattern:"HH:mm:ss"})},isHostedService:function(a){if(!a)return!1;var b=-1!==a.indexOf(".arcgis.com/");a=-1!==a.indexOf("/services")||-1!==a.indexOf("//tiles")||-1!==a.indexOf("//features");return b&&a},isPortalHostedService:function(a){return a?-1!==a.toLowerCase().indexOf("/hosted/"):!1},isTimeEnabled:function(a){var b=10.2<=a.version&&a._useStandardizedQueries;return a.useMapTime&&a.timeInfo&&(b||10.2<=a.version)||k.isDefined(a.time)},
isTimeInstantLayer:function(a){return k.isDefined(a.timeInfo)&&k.isDefined(a.timeInfo.startTimeField)&&!k.isDefined(a.timeInfo.endTimeField)||k.isDefined(a.time)&&k.isDefined(a.time.timeType)&&"instant"===a.time.timeType},buildReport:function(a,b){var d="";b||(b={},l.mixin(b,F.analysisMsgCodes));x.forEach(a,function(c,f){if("string"===typeof c.message){var e=k.isDefined(b[c.messageCode])?b[c.messageCode]:c.message;d+=c.style.substring(0,c.style.indexOf("\x3c/"))+(this._isEmptyObject(c.params)?e:r.substitute(e,
c.params))+c.style.substring(c.style.indexOf("\x3c/"))}else if(l.isArray(c.message)){var g=[];var h=l.clone(c.style);x.forEach(c.message,function(m,t){h=h.replace(/<\//,"${"+t+"}");e=k.isDefined(b[c.messageCode+"_"+t])?b[c.messageCode+"_"+t]:m;e=this._isEmptyObject(c.params)?e:r.substitute(e,c.params);"string"===typeof e&&(e=this.safetagsReplace(e));g.push(e+"\x3c/")},this);h=r.substitute(h,g);d+=h}},this);return d},getLayerFeatureCount:function(a,b){var d=new pa,c=new D;b||(b={});d.geometry=b.geometry;
d.geometryType=b.geometryType||"esriGeometryEnvelope";a.url||d.geometry?(a.url&&(d.where=b.where||"1\x3d1",a.getDefinitionExpression&&a.getDefinitionExpression()&&!b.where?d.where=a.getDefinitionExpression():k.isDefined(a.definitionExpression)&&""!==a.definitionExpression&&!b.where&&(d.where=a.definitionExpression)),c=a.queryCount(d)):c.resolve(a.graphics.length);return c.promise},createPolygonFeatureCollection:function(a){var b={layerDefinition:null,featureSet:{features:[],geometryType:q.GeometryTypes.Polygon}};
b.layerDefinition={currentVersion:10.2,copyrightText:"",defaultVisibility:!0,relationships:[],isDataVersioned:!1,supportsRollbackOnFailureParameter:!0,supportsStatistics:!0,supportsAdvancedQueries:!0,geometryType:q.GeometryTypes.Polygon,minScale:0,maxScale:0,objectIdField:"OBJECTID",templates:[],type:"Feature Layer",displayField:"TITLE",visibilityField:"VISIBLE",name:a,hasAttachments:!1,typeIdField:"TYPEID",capabilities:"Query",allowGeometryUpdates:!0,htmlPopupType:"",hasM:!1,hasZ:!1,globalIdField:"",
supportedQueryFormats:"JSON",hasStaticData:!1,maxRecordCount:-1,indexes:[],types:[],drawingInfo:{renderer:{type:"simple",symbol:{color:[0,0,0,255],outline:{color:[0,0,0,255],width:3,type:"esriSLS",style:"esriSLSSolid"},type:"esriSFS",style:"esriSFSNull"},label:"",description:""},transparency:0,labelingInfo:null,fixedSymbols:!0},fields:[{alias:"OBJECTID",name:"OBJECTID",type:"esriFieldTypeOID",editable:!1},{alias:"Title",name:"TITLE",length:50,type:"esriFieldTypeString",editable:!0},{alias:"Visible",
name:"VISIBLE",type:"esriFieldTypeInteger",editable:!0},{alias:"Description",name:"DESCRIPTION",length:1073741822,type:"esriFieldTypeString",editable:!0},{alias:"Type ID",name:"TYPEID",type:"esriFieldTypeInteger",editable:!0}]};return b},createPointFeatureCollection:function(a){var b={layerDefinition:null,featureSet:{features:[],geometryType:q.GeometryTypes.Point}};b.layerDefinition={objectIdField:"OBJECTID",templates:[],type:"Feature Layer",drawingInfo:{renderer:{field1:"TYPEID",type:"simple",symbol:{height:24,
xoffset:0,yoffset:12,width:24,contentType:"image/png",type:"esriPMS",url:aa.toUrl("./images/GreenStickpin.png")},description:"",value:"0",label:"Stickpin"}},displayField:"TITLE",visibilityField:"VISIBLE",name:a,hasAttachments:!1,typeIdField:"TYPEID",capabilities:"Query",types:[],geometryType:q.GeometryTypes.Point,fields:[{alias:"OBJECTID",name:"OBJECTID",type:"esriFieldTypeOID",editable:!1},{alias:"Title",name:"TITLE",length:50,type:"esriFieldTypeString",editable:!0},{alias:"Visible",name:"VISIBLE",
type:"esriFieldTypeInteger",editable:!0},{alias:"Description",name:"DESCRIPTION",length:1073741822,type:"esriFieldTypeString",editable:!0},{alias:"Type ID",name:"TYPEID",type:"esriFieldTypeInteger",editable:!0}]};return b},createFolderStore:function(a,b){var d=new ia({data:{identifier:"id",label:"name",items:[]}});d.newItem({name:b,id:""});x.forEach(a,function(c){d.newItem({name:c.title,id:c.id})});return d},setupFoldersUI:function(a){a.folderSelect.set("store",a.folderStore);a.folderSelect.set("required",
!0);a.folderSelect.set("searchAttr","name");k.isDefined(a.folderId)?a.folderStore.get(a.folderId).then(l.hitch(this,function(b){k.isDefined(b)?a.folderSelect.set("item",b):a.folderStore.get("").then(function(d){a.folderSelect.set("item",d)},this)})):a.folderName?a.folderStore.fetch({query:{name:a.folderName},onComplete:l.hitch(this,function(b){k.isDefined(b)&&0<b.length?a.folderSelect.set("item",b[0]):a.folderStore.get("").then(function(d){a.folderSelect.set("item",d)},this)})}):a.username?a.folderSelect.set("displayedValue",
a.username):a.folderStore.get("").then(function(b){a.folderSelect.set("item",b)},this)},_isEmptyObject:function(a){for(var b in a)if(a.hasOwnProperty(b))return!1;return!0},validateServiceName:function(a,b){var d=/(:|&|<|>|%|#|\?|\\|"|\/|\+|=|\*|@|'|;|\||,)/g.test(a),c=!0,f=!0;if(k.isDefined(b)&&b.textInput)var e=b.textInput;k.isDefined(b)&&k.isDefined(b.isItem)&&(f=b.isItem);this.initI18n();if(0===a.length||0===r.trim(a).length){var g=this.i18n.requiredValue;c=!1}else if(d)g=this.i18n.invalidServiceName,
c=!1;else if(f&&98<a.length)g=this.i18n.invalidServiceNameLength,c=!1;else if(f&&170<encodeURIComponent(a).length){for(a+="";170<encodeURIComponent(a).length;)a=a.substring(0,a.length-1);g=r.substitute(this.i18n.suggestedServiceNameLength,{count:a.length});c=!1}e&&!c&&e.set("invalidMessage",g);return c},getStepNumber:function(a){K(".esriAnalysisNumberLabel",a).forEach(function(b,d){d=this._getNumberLabel(d);O.set(b,"innerHTML",d)},this)},_getNumberLabel:function(a){var b="";this.initI18n();switch(a){case 0:b=
this.i18n.oneLabel;break;case 1:b=this.i18n.twoLabel;break;case 2:b=this.i18n.threeLabel;break;case 3:b=this.i18n.fourLabel;break;case 4:b=this.i18n.fiveLabel;break;case 5:b=this.i18n.sixLabel;break;case 6:b=this.i18n.sevenLabel;break;case 7:b=this.i18n.eightLabel;break;case 8:b=this.i18n.nineLabel;break;case 9:b=this.i18n.tenLabel;break;case 10:b=this.i18n.elevenLabel;break;case 11:b=this.i18n.twelveLabel;break;case 12:b=this.i18n.thirteenLabel}return b},populateAnalysisLayers:function(a,b,d,c){if(a){var f=
[],e=a.get(b);b=c&&c.layerSelect?c.layerSelect:a._analysisSelect;a.rerun&&!e&&(c||(c={}),c.chooseBlank=!0);a._titleRow&&G.set(a._titleRow,"display","none");a._analysisLabelRow&&G.set(a._analysisLabelRow,"display","table-row");a._selectAnalysisRow&&(G.set(a._selectAnalysisRow,"display","table-row"),G.set(a._analysisSelect.domNode.parentNode,"padding-bottom","1em"));a.domNode&&this.getStepNumber(a.domNode);k.isDefined(c)&&c.chooseLabel&&f.push({value:-1,label:this.i18n.chooseLabel});k.isDefined(c)&&
c.chooseBlank&&f.push({value:"  ",label:""});k.isDefined(c)&&k.isDefined(c.posIncrement)||(k.isDefined(c)||(c={}),c.posIncrement=0);a.get(d)||a.set(d,[]);x.forEach(a.get(d),function(g,h){h+=c.posIncrement;h={value:k.isDefined(c)&&c.chooseLabel?""+h+1:""+h,label:g.name};e&&(g.name===e.name||g.url&&e.url&&g.url===e.url)&&(h.selected=!0);f.push(h)},this);b.addOption(f);b.set("required",!0);c.chooseBlank&&"  "===b.get("value")&&setTimeout(l.hitch(this,this._validateSelectUI,b),100)}},isValidAnalysisLayer:function(a){var b=
"",d=!0;var c={isValid:d,validationMessage:b};var f,e,g=0,h=0,m=0,t,B,w,u=!0;if(!k.isDefined(a)||!k.isDefined(a.toolName))return c;this.initI18n();c=a.toolName;var v=a.layers;var n=a.analysisLayer;var y=c.charAt(0).toLowerCase()+c.substring(1);var z=this.i18n;a=a.showReadyToUseLayers||!1;x.forEach(v,function(A){u=!1;if(A instanceof M||"esri.layers.RasterXLayer"===A.declaredClass)t=!0;t&&1<A.bandCount&&(B=!0);t&&1===A.bandCount&&(w=!0);A.geometryType===q.GeometryTypes.Point&&(R=!0,g++);if(A.geometryType===
q.GeometryTypes.Point||A.geometryType===q.GeometryTypes.MultiPoint)f=!0;A.geometryType===q.GeometryTypes.Line&&(e=!0,m++);A.geometryType===q.GeometryTypes.Polygon&&(N=!0,h++)},this);if(-1!==x.indexOf(["CreateDriveTimeAreas","PlanRoutes","ConnectOriginsToDestinations"],c)&&(!R||n&&n.geometryType!==q.GeometryTypes.Point))b=r.substitute(this.i18n.selectPointLayer,{toolName:z[y]}),d=!1;else if("AggregatePoints"!==c&&"InterpolatePoints"!==c||(!n||n.geometryType===q.GeometryTypes.Point||n.geometryType===
q.GeometryTypes.MultiPoint)&&f)if("CalculateDensity"===c&&(!f&&!e||n&&n.geometryType!==q.GeometryTypes.Point&&n.geometryType!==q.GeometryTypes.MultiPoint&&n.geometryType!==q.GeometryTypes.Line))b=r.substitute(this.i18n.areaFeatureInvalidMsg,{toolName:z[y]}),d=!1;else if("FindHotSpots"!==c&&"FindOutliers"!==c||a||!(!f&&!N||n&&n.geometryType!==q.GeometryTypes.Point&&n.geometryType!==q.GeometryTypes.MultiPoint&&n.geometryType!==q.GeometryTypes.Polygon))if("OverlayLayers"!==c&&"AggregatePoints"!==c&&
"SummarizeWithin"!==c&&"SummarizeNearby"!==c&&"FindNearest"!==c&&"MergeLayers"!==c||a||0!==v.length&&(1!==v.length||v[0]!==n&&k.isDefined(n)))if("ConnectOriginsToDestinations"===c&&!a&&(u||2>g))b=r.substitute(this.i18n.odPointMsg,{toolName:z[y]}),d=!1;else if(this.isFindCentroids(c)&&this.isPointLayer(n))b=r.substitute(this.i18n.selectNoPointLayer,{toolName:z[y]}),d=!1;else if("AggregatePoints"===c&&!a&&1<v.length){var N=x.some(v,function(A){return A.geometryType===q.GeometryTypes.Polygon});N||(b=
r.substitute(this.i18n.aggregatePolyMsg,{toolName:z[y]}),d=!1)}else if("MergeLayers"===c&&!a&&1<v.length)1<g||1<m||1<h||(b=this.i18n.mergeValidationMsg,d=!1);else if("SummarizeWithin"!==c&&"DissolveBoundaries"!==c||(!n||n.geometryType===q.GeometryTypes.Polygon)&&N||a)if("ExtractData"===c)(d=x.some(v,function(A){return-1!==A.capabilities.indexOf("Extract")}))||(b=r.substitute(this.i18n.extractValidationMsg));else if(("ConnectOriginsToDestinations"===c||c===q.Tools.ChooseBestFacilities)&&1<v.length){var R=
x.some(v,function(A){var va=k.isDefined(n)&&n.id===A.id;return A.geometryType===q.GeometryTypes.Point&&!va});R||(b=r.substitute(c===q.Tools.ChooseBestFacilities?this.i18n.selectPointLayer:this.i18n.odPointMsg,{toolName:z[y]}),d=!1)}else"CalculateSlope"===c||"DeriveAspect"===c||"RemapValues"===c?t?w||(d=!1,b=r.substitute(this.i18n.noSingleBandISMsg,{toolName:z[y]})):(d=!1,b=r.substitute(this.i18n.noImageServiceMsg,{toolName:z[y]})):"ExtractRaster"===c?t||(d=!1,b=r.substitute(this.i18n.noImageServiceMsg,
{toolName:z[y]})):"MonitorVegetation"===c&&(t?B||(d=!1,b=r.substitute(this.i18n.noMultiBandISMsg,{toolName:z[y]})):(d=!1,b=r.substitute(this.i18n.noImageServiceMsg,{toolName:z[y]})));else b=r.substitute(this.i18n.selectPolyLayer,{toolName:z[y]}),d=!1;else b=r.substitute(this.i18n.overlayValidationMsg,{toolName:z[y]}),d=!1;else b=r.substitute(this.i18n.hotspotsLineFeatureMsg,{toolName:z[y]}),d=!1;else b=r.substitute(this.i18n.selectPointLayer,{toolName:z[y]}),d=!1;return c={isValid:d,validationMessage:b}},
isFindCentroids:function(a){return a===q.Tools.FindCentroids},isPointLayer:function(a){return a&&a.geometryType===q.GeometryTypes.Point},initI18n:function(){this.i18n||(this.i18n={},l.mixin(this.i18n,F.common),l.mixin(this.i18n,F.analysisTools),l.mixin(this.i18n,F.analysisMsgCodes),l.mixin(this.i18n,F.browseLayersDlg),l.mixin(this.i18n,F.driveTimes),l.mixin(this.i18n,F.calculateFields))},addBrowseAnalysisDialog:function(a){if(a&&a.widget){this.i18n||this.initI18n();var b="esri/dijit/analysis/PluginAnalysisLayers",
d=function(v){return"\x3cimg class\x3d'grid-item galleryThumbnail' width\x3d'120px' height\x3d'80px' alt\x3d'' src\x3d'"+(v.thumbnailUrl||this._portal.staticImagesUrl+"/desktopapp.png")+"'\x3e"},c=function(v){return'\x3cdiv class\x3d"galleryLabelContainer"\x3e\x3cspan alt\x3d\''+(v.title||v.name||"\x3cNo Title\x3e")+"'\x3e"+(v.title.replace(/_/g," ")||v.name.replace(/_/g," ")||"\x3cNo Title\x3e")+"\x3c/span\x3e\x3c/div\x3e"},f=function(v){return"\x3cimg class\x3d'grid-item-thumb' width\x3d'16px' height\x3d'16px' alt\x3d'' src\x3d'"+
v.iconUrl+"'/\x3e"},e=function(v){return"\x3cimg class\x3d'grid-item-thumb' width\x3d'16px' height\x3d'16px' alt\x3d'' src\x3d'"+v.iconUrl+"'/\x3e"},g=ha.doc.createDocumentFragment();g=C.create("div",{style:"width:100%;height:100%;"},g);var h=C.create("div",{style:"width:100%;height:10%;","class":""}),m=C.create("div",{style:"width:100%"},g),t=this._isCustomAnalysisQuery(a.widget);1===a.browseType?(b="esri/dijit/analysis/PluginLayers",b={portalUrl:a.widget.get("portalUrl"),message:"",plugin:b,sortDescending:!0,
sort:"title",self:a.widget.get("portalSelf"),itemsPerPage:100,demandList:!0,extent:a.widget.get("map").extent,useExtent:!1,fetchTimeout:600,galleryTemplate:"\x3cdiv class\x3d'listServiceTitle'\x3e\x3ctable cellpadding\x3d'0' cellspacing\x3d'0' width\x3d'100%'\x3e\x3ctr width\x3d'100%'\x3e\x3ctd nowrap\x3d'nowrap'\x3e  \x3cdiv  style\x3d\"position:absolute;left:80px; top:10px; width:1px; height:1px; background: transparent;\"\x3e\x3c/div\x3e\x3cdiv style\x3d'overflow:hidden;'\x3e\x3ca style\x3d\"height:16px;\"\x3e${item.title}\x3c/a\x3e\x3c/div\x3e\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e\x3ctable cellpadding\x3d'0' cellspacing\x3d'0' width\x3d'100%'\x3e\x3ctr width\x3d'100%' class\x3d'bottomRowTable'\x3e\x3ctd width\x3d'20'\x3e  \x3cspan class\x3d'esriAlignLeading'\x3e${item:_formatThumbnail}\x3c/span\x3e\x3c/td\x3e\x3ctd nowrap\x3d'nowrap'\x3e  \x3cspan class\x3d'esriAlignLeading' style\x3d'color:#656565;'\x3e${item.owner}\x3c/span\x3e\x3c/td\x3e\x3ctd style\x3d'padding-right:5px;padding-left:3px;'\x3e\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e\x3c/div\x3e",
showInfoPanel:!0,isAutoClose:!1,checkIsButtonEnabled:!0,formatThumbnail:e,formatInfoPanelImage:f,"class":"esriAnalysisLayersItems"}):b={portalUrl:a.widget.get("portalUrl"),message:"",plugin:b,sortDescending:!0,sort:"title",self:a.widget.get("portalSelf"),pagingLinks:1,rowsPerPage:6,"class":"esriBrowseAnalysisLayers itemsGallery esriFloatLeading",extent:a.widget.get("map").extent,useExtent:!t,fetchTimeout:600,galleryTemplate:'\x3cdiv style\x3d\'opacity:1;\' class\x3d\'grid-item gallery-view galleryNode\'\x3e${item:_formatItemTitle}${item:_formatThumbnail}\x3cdiv class\x3d"linksDiv" style\x3d\'display:none;\'\x3e\x3cdiv class\x3d"esriItemLinks"\x3e\x3cdiv class\x3d"esriFloatLeading"\x3e\x3ca style\x3d"text-decoration: none;"\x3e\x3cspan\x3eAdd layer to analysis\x3c/span\x3e\x3cdiv class\x3d"dijitReset dijitInline esriArrows"\x3e\x3c/div\x3e\x3c/a\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e',
formatItemTitle:c,showInfoPanel:!1,showTooltip:!0,formatThumbnail:d,style:"width:48em;height:100%;clear:both;"};c=C.toDom('\x3cdiv class\x3d"esriBrowseOptions"\x3e');C.place(c,h);d=C.create("div",{"class":"esriBrowseOption"},c);if(!a.browseType||1!==a.browseType){c=C.create("div",{"class":"esriBrowseOption"},c);var B=new X({name:"addlayer",id:a.widget.id+(a.browseType?a.browseType:"")+"_addlayercheck","class":"",value:!1,checked:!1},C.create("input",{},c));C.create("label",{"for":a.widget.id+"_addlayercheck",
"class":"esriBrowseOption_label",innerHTML:this.i18n.addLayer},c)}c=!0;a.browseType&&1===a.browseType?c=!1:t&&(c=!1);c=new X({name:"extentcheck",id:a.widget.id+(a.browseType?a.browseType:"")+"_addextentcheck","class":"",value:c,checked:c},C.create("input",{},d));C.create("label",{"for":a.widget.id+(a.browseType?a.browseType:"")+"_addextentcheck","class":"esriBrowseOption_label",innerHTML:this.i18n.withinMapArea},d);b.messageRight=h;var w=new qa(b,m);c.on("change",l.hitch(this,function(v){w.set("useExtent",
v)}));var u=new ma({title:1===a.browseType?this.i18n.browseLayers:t?this.i18n.browseAnalysisLayers:this.i18n.browseAnalysisTitle,content:g,browseItems:w,addlayerCheckBox:B,style:a.browseType&&1===a.browseType?"":"padding:.75em 0;background-color: #fff;width:50em;"});a.widget.own(u.on("hide",l.hitch(u,function(v){u.browseItems.reset()})));return u}},addAnalysisReadyLayer:function(a,b){function d(w){var u;if("Feature Service"===e.type){var v=new L(e.url,{outFields:["*"]});l.mixin(e,v)}"Image Service"===
e.type&&(v=-1<w.capabilities.indexOf("TilesOnly")?new sa(e.url,{outFields:["*"]}):new M(e.url,{outFields:["*"]}),l.mixin(e,v));l.mixin(e,w);e.id=e.title+"_"+w.id;e.title=a.item.selectedLayer?e.title+"-"+w.name:e.title.replace(/_/g," ");e.name=e.title;e.version=e.currentVersion;if(h&&a.widget.showBrowseLayers){var n=(u=a.layersSelect.get("store"))&&u.data;u=2;u=n.splice(n.length-u,u);var y={id:n.length,label:e.title,name:e.title,url:e.url};n.push(y);n=n.concat(u);u=new ja({data:n,idProperty:"id"});
a.layersSelect.set("store",u);a.layersSelect.set("value",y.name)}else{n=a.layersSelect.getOptions();if(a.widget.useArcGISComponents&&(a.widget.showBrowseLayers||a.widget.showReadyToUseLayers))u=2;else if(a.widget.showBrowseLayers&&a.widget.showReadyToUseLayers)u=3;else if(a.widget.showBrowseLayers||a.widget.showReadyToUseLayers)u=2;u=n.splice(n.length-u,u);a.layersSelect.removeOption(u);n=a.layers.length;a.posIncrement&&(n+=a.posIncrement);n=""+n;u.unshift({value:n,label:e.title,selected:!0});a.layersSelect.addOption(u);
a.layersSelect.set("value",n)}v&&(e.lyr=v,v.name=e.name);e.linfo=w;a.layers.push(e);if(a.browseDialog.addlayerCheckBox&&a.browseDialog.addlayerCheckBox.get("checked")||g||b)this._addLayerHandle&&this._addLayerHandle.remove(),this._addLayerHandle=a.widget.map.on("layer-add",l.hitch(this,function(z){this._addLayerHandle.remove();a.widget.emit("add-ready-to-use-layer",{layer:z.layer,layerInfo:w,item:e})})),a.widget.map.addLayer(v);a.browseDialog.browseItems&&a.browseDialog.browseItems.clear()}if(k.isDefined(a)&&
k.isDefined(a.item)&&k.isDefined(a.layersSelect)&&k.isDefined(a.layers)&&k.isDefined(a.browseDialog)){a.browseDialog.hide&&a.browseDialog.hide();var c,f;(c=!a.item.selectedLayer&&a.item.url?a.item.type===E.IS?a.item.url:a.item.url+"/0":a.item.selectedLayer.url)&&-1!==window.location.protocol.indexOf("https:")&&(c=c.replace("http:","https:"));var e={url:c,itemId:a.item.id,title:a.item.title,type:a.item.type,analysisReady:!0};c=x.some(a.layers,function(w,u){var v=w.analysisReady&&e.analysisReady&&w.itemId===
e.itemId;a.item.selectedLayer&&a.item.selectedLayer.url&&(v=w.itemId&&e.itemId?w.itemId===e.itemId&&w.url===e.url:w.url===e.url);v&&(f=u);return v});var g;a.browseDialog.browseItems&&K(".js-add-layer-checkbox",a.browseDialog.browseItems.infoPanel).forEach(function(w){g=w.checked});var h=-1!==a.layersSelect.baseClass.indexOf("dijitComboBox");var m=new D;var t="sync";if(c){a.posIncrement&&(f+=a.posIncrement);if(a.browseDialog.addlayerCheckBox&&a.browseDialog.addlayerCheckBox.get("checked")||g||b){a.posIncrement||
(a.posIncrement=0);var B=a.layers[f-a.posIncrement];a.widget.map.getLayer(B.lyr.id)||(this._addLayerHandle&&this._addLayerHandle.remove(),this._addLayerHandle=a.widget.map.on("layer-add",l.hitch(this,function(w){this._addLayerHandle.remove();a.widget.emit("add-ready-to-use-layer",{layer:w.layer,layerInfo:B.linfo,item:B})})),a.widget.map.addLayer(B.lyr))}h?a.layersSelect.set("value",a.layers[f-1].name):a.layersSelect.set("value",""+f);a.browseDialog.browseItems&&a.browseDialog.browseItems.clear();
m.resolve()}else a.item.selectedLayer?(e.url=a.item.selectedLayer.url,m.then(l.hitch(this,d)),setTimeout(function(){m.resolve(a.item.selectedLayer)},500)):(t=a.item.itemDataUrl?Q({url:a.item.itemDataUrl,content:{f:"json"}}):"sync",P(t,l.hitch(this,function(w){w&&w.layers&&w.layers[0].id&&(e.url=e.url.substring(0,e.url.lastIndexOf("/0"))+"/"+w.layers[0].id);Q({url:e.url,content:{f:"json"}}).then(l.hitch(this,function(u){d(u);m.resolve()}))})));return m.promise}},addReadyToUseLayerOption:function(a,
b){a&&(a.showReadyToUseLayers||a.showBrowseLayers)&&(b||(b=[]),a.signInPromise||(a.signInPromise=new D,setTimeout(l.hitch(this,function(){a.signInPromise.resolve()}),100)),a.i18n||(this.initI18n(),a.i18n=this.i18n),a.signInPromise.then(l.hitch(this,function(){x.forEach(b,function(d){var c=d.select||d;if(-1!==c.baseClass.indexOf("dijitComboBox")&&a.showBrowseLayers){if(d=c.get("store"))d.put({id:"separator",name:"separator",label:"\x3chr\x3e"}),d.put({id:"browselayers",name:"browselayers",label:a.i18n.browseLayers})}else{var f=
c.getOptions();x.some(f,function(e){return"separator"===e.type},this)||!a.showReadyToUseLayers&&!a.showBrowseLayers||c.addOption({type:"separator",value:""});this.addBrowseOptionForTool({select:c,disableLAAL:d.disableLAAL},a)}},this);a.showReadyToUseLayers&&!k.isDefined(a._browsedlg)&&(a._browsedlg=this.addBrowseAnalysisDialog({widget:a}),a.own(a._browsedlg.browseItems.on("select-change",l.hitch(a,a._handleBrowseItemsSelect)),a._browsedlg.on("hide",l.hitch(a,function(){x.forEach(b,function(d){"browse"===
d.get("value")&&d.reset()});a.layersSelect&&a.layersSelect.reset()}))));a.showBrowseLayers&&!k.isDefined(a._browseLyrsdlg)&&(a._browseLyrsdlg=this.addBrowseAnalysisDialog({widget:a,browseType:1}),a.own(a._browseLyrsdlg.on("browseitems-close",l.hitch(this,function(d){"add-layer"===d.action&&(a._browseLyrsdlg.browseItems.plugIn._grid&&(d.selection.selectedLayer=a._browseLyrsdlg.browseItems.plugIn._selectedLayer,a._handleBrowseItemsSelect({dialog:a._browseLyrsdlg,selection:d.selection})),a._browseLyrsdlg.browseItems.closeInfoPanel())})),
a._browseLyrsdlg.on("hide",l.hitch(a,function(){x.forEach(b,function(d){"browselayers"===d.get("value")&&d.reset()})}))))})))},addBrowseOptionForTool:function(a,b){var d=a.select,c=a.disableLAAL||!1,f=d.getOptions();a=[];var e=!1;if(!x.some(f,function(g){return"browselayers"===g.value||"browse"===g.value},this)){if(0<f.length&&"separator"!==f[f.length-1].type||0===f.length)a.push({type:"separator"}),e=!0;b.useArcGISComponents&&(b.showBrowseLayers||b.showReadyToUseLayers)?a.push({value:"browselayers",
label:b.i18n.browseAnalysisLayers}):(!c&&b.showReadyToUseLayers&&(c=b.i18n.browseAnalysisTitle,this._isCustomAnalysisQuery(b)&&(c=b.i18n.browseAnalysisLayers),a.push({value:"browse",label:c})),b.showBrowseLayers&&a.push({value:"browselayers",label:b.i18n.browseLayers}));(!0===e&&1<a.length||!1===e&&0<a.length)&&d.addOption(a)}},_isCustomAnalysisQuery:function(a){var b='title:"Living Atlas Analysis Layers" AND owner:esri',d=!1;a&&a.isSingleTenant&&(b='title:"Living Atlas Analysis Layers" AND owner:esri_livingatlas');
a.portalSelf&&a.portalSelf.analysisLayersGroupQuery&&a.portalSelf.analysisLayersGroupQuery!==b?d=!0:a._portal&&a._portal.analysisLayersGroupQuery&&a._portal.analysisLayersGroupQuery!==b&&(d=!0);return d},getMaxInputByMode:function(a){if(a&&a.units&&a.type&&a.limits&&a.travelMode){var b,d=a.limits.maximumBreakDistanceValue,c=a.limits.maximumBreakDistanceValueUnits,f=a.limits.maximumBreakTimeValue,e=a.limits.maximumBreakTimeValueUnits,g=this.isWalkingTravelMode(a.travelMode.travelMode);g&&(d=a.limits.maximumBreakWalkingDistanceValue,
c=a.limits.maximumBreakWalkingDistanceValueUnits,f=a.limits.maximumBreakWalkingTimeValue,e=a.limits.maximumBreakWalkingTimeValueUnits);"reachableStreets"===a.alternateLimits&&(e=this.generateLimitsForReachableStreets({limits:a.limits,isWalking:g}),d=e.driveDistanceLimit,c=e.driveDistanceUnit,f=e.driveTimeLimit,e=e.driveTimeUnit);"unreachableAreas"===a.alternateLimits&&(e=this.generateLimitsForUnreachableAreas({limits:a.limits,isWalking:g}),d=e.driveDistanceLimit,c=e.driveDistanceUnit,f=e.driveTimeLimit,
e=e.driveTimeUnit);f*=this.perMinute(e);d*=this.perMile(c);"StraightLine"===a.type?"Miles"===a.units?b=1E3:"Yards"===a.units?b=176E4:"Kilometers"===a.units?b=H.format(1609.344,{places:2}):"Meters"===a.units?b=H.format(1609344,{places:2}):"Feet"===a.units&&(b=528E4):this.isDistanceMode(a.travelMode)?"Miles"===a.units?b=d:"Yards"===a.units?b=1760*d:"Kilometers"===a.units?b=H.format(1.609344*d,{places:2}):"Meters"===a.units?b=H.format(1609.344*d,{places:2}):"Feet"===a.units&&(b=5280*d):this.isTimeMode(a.travelMode)&&
("Minutes"===a.units?b=f:"Seconds"===a.units?b=60*f:"Hours"===a.units&&(b=f/60));return"string"===typeof b?H.parse(b):parseFloat(b)}},isWalkingTravelMode:function(a){if(a&&a.restrictionAttributeNames)return a.restrictionAttributeNames.some(function(b){return"walking"===b.toLowerCase()})},isDistanceMode:function(a){return"Distance"===a.units},isTimeMode:function(a){return"Time"===a.units},generateLimitsForUnreachableAreas:function(a){var b={driveDistanceLimit:null,driveDistanceUnit:null,driveTimeLimit:null,
driveTimeUnit:null};a.isWalking?(b.driveDistanceLimit=a.limits.maximumBreakWalkingDistanceValueDetailedPolygons,b.driveDistanceUnit=a.limits.maximumBreakWalkingDistanceValueUnitsDetailedPolygons,b.driveTimeLimit=a.limits.maximumBreakWalkingTimeValueDetailedPolygons,b.driveTimeUnit=a.limits.maximumBreakWalkingTimeValueUnitsDetailedPolygons):(b.driveDistanceLimit=a.limits.maximumBreakDistanceValueDetailedPolygons,b.driveDistanceUnit=a.limits.maximumBreakDistanceValueUnitsDetailedPolygons,b.driveTimeLimit=
a.limits.maximumBreakTimeValueDetailedPolygons,b.driveTimeUnit=a.limits.maximumBreakTimeValueUnitsDetailedPolygons);return b},generateLimitsForReachableStreets:function(a){var b={driveDistanceLimit:null,driveDistanceUnit:null,driveTimeLimit:null,driveTimeUnit:null};a.isWalking?(b.driveDistanceLimit=a.limits.maximumBreakWalkingDistanceValueServiceAreaLines,b.driveDistanceUnit=a.limits.maximumBreakWalkingDistanceValueUnitsServiceAreaLines,b.driveTimeLimit=a.limits.maximumBreakWalkingTimeValueServiceAreaLines,
b.driveTimeUnit=a.limits.maximumBreakWalkingTimeValueUnitsServiceAreaLines):(b.driveDistanceLimit=a.limits.maximumBreakDistanceValueServiceAreaLines,b.driveDistanceUnit=a.limits.maximumBreakDistanceValueUnitsServiceAreaLines,b.driveTimeLimit=a.limits.maximumBreakTimeValueServiceAreaLines,b.driveTimeUnit=a.limits.maximumBreakTimeValueUnitsServiceAreaLines);return b},updateModeConstraints:function(a){if(a&&a.validateWidget&&a.units&&a.type&&a.travelMode){var b=a.validateWidget.get("constraints");b.max=
this.getMaxInputByMode(a);a.validateWidget.set(b)}},getTravelModes:function(a){var b=new D,d,c,f,e;k.isDefined(this.travelModes)&&0<this.travelModes.length?b.resolve(this.travelModes):a&&a.widget?a.widget.signInPromise.then(l.hitch(this,function(g){(e=a.widget.get("helperServices"))&&e.routingUtilities?(f=e.routingUtilities.url,d="sync"):d=a.widget._getSelf(a.widget.portalUrl);P(d,l.hitch(this,function(h){h&&h.helperServices&&h.helperServices.routingUtilities&&(f=h.helperServices.routingUtilities.url);
k.isDefined(f)?(c=new Y(f+"/GetTravelModes"),c.execute({}).then(l.hitch(this,function(m){this.travelModes=x.map(m[0].value&&m[0].value.features,function(t){return ca.fromJson(t.attributes.TravelMode)});m[1]&&m[1].paramName&&"defaultTravelMode"===m[1].paramName&&(this.defaultTravelModeId=m[1].value);b.resolve(this.travelModes)}),l.hitch(this,function(m){b.reject(m)}))):b.reject(Error("Missing Routing Utility Service to get Travel Modes"))}),function(h){b.reject(h)})})):b.reject(Error("Missing parameter: params.widget required parameter"));
return b.promise},populateTravelModes:function(a){if(a&&a.selectWidget&&a.widget){var b=[],d=a.allowmode||"all",c=!1;this.initI18n();a.addStraightLine&&b.push({value:"StraightLine",label:'\x3cdiv class\x3d"esriFloatLeading bufferIcon esriStraightLineDistanceIcon"\x3e\x3c/div\x3e\x3cdiv class\x3d"esriLeadingMargin4" style\x3d"height:20px;margin-top:10px;"\x3e'+this.i18n.straightLineDistance+"\x3c/div\x3e",selected:a.value&&"StraightLine"===a.value});this.getTravelModes({widget:a.widget}).then(l.hitch(this,
function(f){var e=k.isDefined(a.enableTravelModes)&&!a.enableTravelModes;x.forEach(f,function(g,h){h=this.createOptionForTravelMode(g,{name:g.name,disabled:e,separator:a.separator});this.isTravelModeAllowed(d,h.units)&&("all"!==d&&(h.value=h.value.replace(h.units,"")),a.value&&a.value.id===g.id?ka(a.value,g)&&(h.selected=!h.disabled,c=!0):!a.value&&a.selectDefaultMode&&this.defaultTravelModeId&&this.defaultTravelModeId===g.id&&(h.selected=!0),b.push(h))},this);!c&&this.isRequiredToAddTravelMode(a)&&
this.isTravelModeAllowed(d,this.getTravelModeUnits(a.value))&&b.push(this.getOptionForCustomTravelMode(a,e));a.selectWidget.removeOption();a.selectWidget.addOption(b);a.widget.emit("travelmodes-added",{travelOptions:b})}),l.hitch(this,function(f){b&&0<b.length&&(a.selectWidget.removeOption(),a.selectWidget.addOption(b),a.widget.emit("travelmodes-added",{travelOptions:b}))}))}},getTravelModeLabel:function(a,b){b=b?b:a.name;return'\x3cdiv class\x3d"esriFloatLeading bufferIcon esri'+this.getTravelModei18nKey(a.type)+
this.getTravelModeUnits(a)+'Icon"\x3e\x3c/div\x3e\x3cdiv class\x3d"esriLeadingMargin4" style\x3d"height:20px;margin-top:10px;" title\x3d"'+a.description+'"\x3e'+b+"\x3c/div\x3e"},getTravelModeUnits:function(a){var b=a.units||name.split(/\s/)[1];return b=a.impedanceAttributeName===a.timeAttributeName?"Time":a.impedanceAttributeName===a.distanceAttributeName?"Distance":"Other"},getTravelModeValue:function(a,b){return a.replace(/\s/g,b||"")},getTravelModei18nKey:function(a){return"AUTOMOBILE"===a?"Driving":
"TRUCK"===a?"Trucking":"WALK"===a?"Walking":"Other"},isTravelModeAllowed:function(a,b){return"all"===a||a.toLowerCase()===b.toLowerCase()},isRequiredToAddTravelMode:function(a){return a.widget.rerun&&"StraightLine"!==a.value},isTrafficBasedTravelMode:function(a){var b=this.getTravelModei18nKey(a.type).toLowerCase();return"time"===this.getTravelModeUnits(a).toLowerCase()&&("driving"===b||"trucking"===b)},getOptionForCustomTravelMode:function(a,b){a=this.createOptionForTravelMode(a.value,{name:"\x26lt"+
a.value.name+"\x26gt",disabled:b,separator:a.separator});a.selected=!0;return a},createOptionForTravelMode:function(a,b){return{label:this.getTravelModeLabel(a,b.name),value:this.getTravelModeValue(b.name,b.separator),travelMode:a,disabled:b.disabled,modei18nKey:this.getTravelModei18nKey(a.type).toLowerCase(),units:this.getTravelModeUnits(a)}},updateDisplay:function(a,b,d){(new K.NodeList(a)).style("display",b?d?d:"block":"none")},isGreaterThanZero:function(){return 0<this.get("value")},getExprFunctions:function(){this.i18n||
this.initI18n();this.exprFunctions||(this.exprFunctions=[{type:"NumType",label:r.substitute(this.i18n.asMetersFunc,{functionName:"as_meters(\x3ci\x3enumber\x3c/i\x3e)",num:"\x3ci\x3enumber\x3c/i\x3e"}),name:"as_meters()"},{type:"NumType",label:r.substitute(this.i18n.asKilometersFunc,{functionName:"as_kilometers(\x3ci\x3enumber\x3c/i\x3e)",num:"\x3ci\x3enumber\x3c/i\x3e"}),name:"as_kilometers()"},{type:"NumType",label:r.substitute(this.i18n.asFeetFunc,{functionName:"as_feet(\x3ci\x3enumber\x3c/i\x3e)",
num:"\x3ci\x3enumber\x3c/i\x3e"}),name:"as_feet()"},{type:"NumType",label:r.substitute(this.i18n.asYardsFunc,{functionName:"as_yards(\x3ci\x3enumber\x3c/i\x3e)",num:"\x3ci\x3enumber\x3c/i\x3e"}),name:"as_yards()"},{type:"NumType",label:r.substitute(this.i18n.asMilesFunc,{functionName:"as_miles(\x3ci\x3enumber\x3c/i\x3e)",num:"\x3ci\x3enumber\x3c/i\x3e"}),name:"as_miles()"},{type:"NumType",label:r.substitute(this.i18n.asNuaticalMilesFunc,{functionName:"as_nautical_miles(\x3ci\x3enumber\x3c/i\x3e)",
num:"\x3ci\x3enumber\x3c/i\x3e"}),name:"as_nautical_miles()"},{type:"NumType",label:r.substitute(this.i18n.absFunc,{functionName:"abs(\x3ci\x3enumber\x3c/i\x3e)",num:"\x3ci\x3enumber\x3c/i\x3e"}),name:"abs()"},{type:"NumType",label:r.substitute(this.i18n.logFunc,{functionName:"log(\x3ci\x3enumber\x3c/i\x3e)",num:"\x3ci\x3enumber\x3c/i\x3e"}),name:"log()"},{type:"NumType",label:r.substitute(this.i18n.sinFunc,{functionName:"sin(\x3ci\x3enumber\x3c/i\x3e)",num:"\x3ci\x3enumber\x3c/i\x3e"}),name:"sin()"},
{type:"NumType",label:r.substitute(this.i18n.cosFunc,{functionName:"cos(\x3ci\x3enumber\x3c/i\x3e)",num:"\x3ci\x3enumber\x3c/i\x3e"}),name:"cos()"},{type:"NumType",label:r.substitute(this.i18n.tanFunc,{functionName:"tan(\x3ci\x3enumber\x3c/i\x3e)",num:"\x3ci\x3enumber\x3c/i\x3e"}),name:"tan()"},{type:"NumType",label:r.substitute(this.i18n.squareRootFunc,{functionName:"sqrt(\x3ci\x3enumber\x3c/i\x3e)",num:"\x3ci\x3enumber\x3c/i\x3e"}),name:"sqrt()"},{type:"NumType",label:r.substitute(this.i18n.minFunc,
{functionName:"min(\x3ci\x3enumber\x3c/i\x3e)",num:"\x3ci\x3enumber\x3c/i\x3e"}),name:"min()"},{type:"NumType",label:r.substitute(this.i18n.maxFunc,{functionName:"max(\x3ci\x3enumber\x3c/i\x3e)",num:"\x3ci\x3enumber\x3c/i\x3e"}),name:"max()"},{type:"NumType",label:r.substitute(this.i18n.constrainFunc,{functionName:"constrain(\x3ci\x3enumber\x3c/i\x3e, \x3ci\x3elow\x3c/i\x3e, \x3ci\x3ehigh\x3c/i\x3e",num:"\x3ci\x3enumber\x3c/i\x3e",low:"\x3ci\x3elow\x3c/i\x3e",high:"\x3ci\x3ehigh\x3c/i\x3e"}),name:"constrain(,,)"},
{type:"NumType",label:r.substitute(this.i18n.iffFunc,{functionName:"iif(\x3ci\x3econdition\x3c/i\x3e,\x3ci\x3evalue if TRUE\x3c/i\x3e,\x3ci\x3evalue if FALSE\x3c/i\x3e)",num:"\x3ci\x3enumber\x3c/i\x3e"}),name:"iif(,,)"},{type:"NumType",label:r.substitute(this.i18n.whenFunc,{functionName:"when(\x3ci\x3enumber\x3c/i\x3e)",num:"\x3ci\x3enumber\x3c/i\x3e"}),name:"when(,)"},{type:"NumType",label:r.substitute(this.i18n.decodeFunc,{functionName:"decode(\x3ci\x3eexpression\x3c/i\x3e, \x3ci\x3ecase1,return1,..caseN,returnN\x3c/i\x3e, \x3ci\x3edefault\x3c/i\x3e)",
num:"\x3ci\x3enumber\x3c/i\x3e"}),name:"decode(,,,)"}]);return this.exprFunctions},addAttributeOptions:function(a){this.initI18n();k.isDefined(a.allowSelectLabel)||(a.allowSelectLabel=!0);var b=[],d=k.isDefined(a.emptyValue)?a.emptyValue:"";if(a.allowNumericType||void 0===a.allowNumericType)b=[q.FieldTypes.Short,q.FieldTypes.Integer,q.FieldTypes.Float,q.FieldTypes.Double];var c=a.layer;var f=a.selectWidget;var e=c?c.fields:[];f.removeOption(f.getOptions());a.allowSelectLabel&&f.addOption({value:d,
label:this.i18n.attribute});a.allowStringType&&b.push(q.FieldTypes.String);a.allowDateType&&b.push(q.FieldTypes.Date);var g=[];x.forEach(e,function(h){-1!==x.indexOf(b,h.type)&&h.name!==c.objectIdField&&g.push({value:h.name,label:k.isDefined(h.alias)&&""!==h.alias?h.alias:h.name,type:h.type===q.FieldTypes.String?q.PseudoFieldTypes.String:h.type===q.FieldTypes.Date?q.PseudoFieldTypes.Date:q.PseudoFieldTypes.Number})},this);if(0===g.length)return!1;f.addOption(g);k.isDefined(a.priorityChange)?f.set("value",
d,a.priorityChange):f.set("value",d);f.set("disabled",!c||0===c.fields.length);return!0},addStatisticsOptions:function(a){this.initI18n();var b=a.selectWidget,d=[{value:"SUM",label:this.i18n.sum},{value:"MIN",label:this.i18n.minimum},{value:"MAX",label:this.i18n.maximum},{value:"MEAN",label:a.showGeoAnalyticsParams?this.i18n.mean:this.i18n.average},{value:"STDDEV",label:this.i18n.standardDev}],c=[{value:"MIN",label:this.i18n.minimum},{value:"MAX",label:this.i18n.maximum}],f=[{value:"First",label:this.i18n.first},
{value:"Last",label:this.i18n.last}],e=k.isDefined(a.emptyValue)?a.emptyValue:"";b.removeOption(b.getOptions());b.addOption([{value:e,label:this.i18n.statistic}]);a.showGeoAnalyticsParams&&(b.addOption({value:"COUNT",label:this.i18n.count}),d.push({value:"VARIANCE",label:this.i18n.variance}),d.splice(4,0,{value:"RANGE",label:this.i18n.range}));a.showFirstLastStats&&b.addOption(f);a.type&&"number"!==a.type?a.type&&"string"===a.type?(b.addOption({value:"ANY",label:this.i18n.any}),a.selectWidget.optionsType=
"string"):a.type&&"date"===a.type&&(b.addOption(c),a.selectWidget.optionsType="date"):(b.addOption(d),a.selectWidget.optionsType="number");b.set("value",e)},addFillOptions:function(a){var b=a.selectWidget,d=[{value:"ZEROES",label:this.i18n.zeroes},{value:"SPATIAL_NEIGHBORS",label:this.i18n.spatialneighbhors},{value:"SPACE_TIME_NEIGHBORS",label:this.i18n.spacetimeneighbors},{value:"TEMPORAL_TREND",label:this.i18n.temporaltrend}];b.removeOption(b.getOptions());b.addOption([{value:"0",label:this.i18n.fill}]);
a.type&&"number"!==a.type||b.addOption(d)},perMeter:function(a){var b=1;switch(a){case p.MILLIMETERS:b=1E3;break;case p.CENTIMETERS:b=100;break;case p.DECIMETERS:b=10;break;case p.METERS:b=1;break;case p.KILOMETERS:b=.001;break;case p.INCHES:b=39.370079;break;case p.FEET:b=3.2808399;break;case p.YARDS:b=1.0936133;break;case p.MILES:b=6.2137119E-4;break;case p.NAUTICAL_MILES:b=5.399568E-4;break;case p.ACRES:b=2.4710538E-4;break;case p.ARES:b=.01;break;case p.HECTARES:b=1E-4;break;case p.SQUARE_INCHES:b=
1550.0031;break;case p.SQUARE_FEET:b=10.7639104;break;case p.SQUARE_YARDS:b=1.19599005;break;case p.SQUARE_MILES:b=3.86102159E-7;break;case p.SQUARE_NAUTICAL_MILES:b=2.9155335E-7;break;case p.SQUARE_MILLIMETERS:b=1E6;break;case p.SQUARE_CENTIMETERS:b=1E4;break;case p.SQUARE_DECIMETERS:b=100;break;case p.SQUARE_METERS:b=1;break;case p.SQUARE_KILOMETERS:b=1E-6}return b},perMile:function(a){var b=1;switch(a){case "Feet":b=1.89394E-4;break;case "Yards":b=5.68182E-4;break;case "Meters":b=6.21371E-4;break;
case "Kilometers":b=.621371}return b},perMinute:function(a){var b=1;switch(a){case "Seconds":b=.0166667;break;case "Hours":b=60}return b},getType:function(a){var b=null;switch(a){case p.ACRES:b=2;break;case p.ARES:b=2;break;case p.CENTIMETERS:b=1;break;case p.DECIMETERS:b=1;break;case p.FEET:b=1;break;case p.HECTARES:b=2;break;case p.INCHES:b=1;break;case p.KILOMETERS:b=1;break;case p.METERS:b=1;break;case p.MILES:b=1;break;case p.MILLIMETERS:b=1;break;case p.NAUTICAL_MILES:b=1;break;case p.SQUARE_CENTIMETERS:b=
2;break;case p.SQUARE_DECIMETERS:b=2;break;case p.SQUARE_FEET:b=2;break;case p.SQUARE_INCHES:b=2;break;case p.SQUARE_KILOMETERS:b=2;break;case p.SQUARE_METERS:b=2;break;case p.SQUARE_MILES:b=2;break;case p.SQUARE_MILLIMETERS:b=2;break;case p.SQUARE_NAUTICAL_MILES:b=2;break;case p.SQUARE_YARDS:b=2;break;case p.YARDS:b=1;break;default:b=0}return b},unitConversion:function(a,b,d){var c=!0;k.isDefined(a)||(this.emitError("The 'From' Value must be a valid numeric value: "+a),c=!1);k.isDefined(b)||(this.emitError("The 'From' Units must be defined: "+
b),c=!1);k.isDefined(d)||(this.emitError("The 'To' Units must be defined: "+d),c=!1);a instanceof Array&&(this.emitError("Only single 'From' Value supported: "+a),c=!1);b instanceof Array&&(this.emitError("Only single 'From' Units supported: "+b),c=!1);d instanceof Array&&(this.emitError("Only single 'To' Units supported: "+d),c=!1);var f=this.getType(b),e=this.getType(d);0===f&&(this.emitError("Unsupported 'From' Units: "+b),c=!1);0===e&&(this.emitError("Unsupported 'To' Units: "+d),c=!1);f!==e&&
(this.emitError("Incompatible 'From' and 'To' Units: "+b+" and "+d),c=!1);return c?b===d?+a:+a/this.perMeter(b)*this.perMeter(d):Number.NaN},emitError:function(a){},isEmpty:function(a){for(var b in a)if(a.hasOwnProperty(b))return!1;return J.stringify(a)===J.stringify({})},getRoutingUtilities:function(a){var b=new D,d={},c,f,e,g;a||b.reject(Error("Missing parameter: widget required parameter"));-1!==x.indexOf(["CreateDriveTimeAreas","EnrichLayer","SummarizeNearby"],a.toolName)?l.mixin(d,{toolName:"GenerateServiceAreas",
serviceName:"asyncServiceArea"}):a.toolName===q.Tools.ChooseBestFacilities?l.mixin(d,{toolName:"SolveLocationAllocation",serviceName:"asyncLocationAllocation"}):"PlanRoutes"===a.toolName?l.mixin(d,{toolName:"SolveVehicleRoutingProblem",serviceName:"asyncVRP"}):"FindNearest"===a.toolName?l.mixin(d,{toolName:"FindClosestFacilities",serviceName:"asyncClosestFacility"}):"ConnectOriginsToDestinations"===a.toolName&&l.mixin(d,{toolName:"FindRoutes",serviceName:"asyncRoute"});this.routingUtilities||(this.routingUtilities=
{});this.routingUtilities&&this.routingUtilities[a.toolName]?b.resolve(this.routingUtilities[a.toolName]):a.signInPromise.then(l.hitch(this,function(h){(g=a.get("helperServices"))&&g.routingUtilities?(e=g.routingUtilities.url,c="sync"):c=a._getSelf(a.portalUrl);P(c,l.hitch(this,function(m){m&&m.helperServices&&m.helperServices.routingUtilities&&(e=m.helperServices.routingUtilities.url);k.isDefined(e)||b.reject(Error("Missing Routing Utility Service to get Network Analysis Service Limits."));f=new Y(e+
"/GetToolInfo");f.execute(d).then(l.hitch(this,function(t){t&&0<t.length&&t[0].value?(this.routingUtilities[a.toolName]=t[0].value,b.resolve(t[0].value)):b.reject("Routing Utility Service 'GetToolInfo' job did not return service limits.")}),function(t){b.reject(t)})}))}),function(h){b.reject(h)});return b.promise},getNetworkAnalysisLimits:function(a){var b=new D;a||b.reject(Error("Missing parameter: widget required parameter"));this.getRoutingUtilities(a).then(l.hitch(this,function(d){d.serviceLimits?
b.resolve(d.serviceLimits):b.reject()}),function(d){b.reject(d)});return b.promise},isEsriWorldGeocoder:function(a){var b=this.isAgoWorldGeocodeServer(a);a=this.isAgoWorldGeocodeServerProxy(a);return b||a},isAgoWorldGeocodeServer:function(a){return a&&!!a.match(/(arcgis.com\/arcgis\/rest\/services\/world\/geocodeserver).*/ig)},isCustomGeoEnrichmentServer:function(a,b){var d=(a||"").toLowerCase();a=-1<d.indexOf("/geoenrichmentserver")&&-1<d.indexOf("/servers/")&&-1<d.indexOf("/rest/services/");b=!b&&
d.indexOf("utility")&&-1<d.indexOf(".arcgis.com");return a&&b},isAgoWorldGeocodeServerProxy:function(a){return a&&!!a.match(/(\/servers\/[\da-z\.-]+\/rest\/services\/world\/geocodeserver).*/ig)},isWorldGeoLocator:function(a){return a&&!!a.match(/(\/rest\/services\/world\/geocodeserver).*/ig)},showMessages:function(a,b,d){O.set(b,"innerHTML",a);S.fadeIn({node:d,easing:U.quadIn,onEnd:l.hitch(this,function(){G.set(d,{display:""})})}).play()},hideMessages:function(a){S.fadeOut({node:a,easing:U.quadOut,
onEnd:function(){G.set(a,{display:"none"})}}).play()},getHelpUrl:function(a){if(a.topic&&a.widget){var b;a.widget.portalSelf&&a.widget.portalSelf.helpBase?b=a.widget.portalSelf.helpBase+"index.html#":!a.widget.isSingleTenant||a.widget.portalSelf&&a.widget.portalSelf.helpBase||(b="http://server.arcgis.com/en/portal/latest/use/");"BufferExpression"===a.topic&&(b+="Use_expressions_with_GeoAnalytics_Tools/019300000183000000/");return b}},isPCS:function(a){return!!a&&!!Z&&-1!==x.indexOf(Z,a)},isPCSByLayerType:function(a){var b=
!!a&&!!a.fullExtent&&this.isPCS(a.fullExtent.spatialReference.wkid);!b&&a.extent&&(b=!!a&&!!a.extent&&this.isPCS(a.extent.spatialReference.wkid));!b&&a.spatialReference&&(b=!!a&&!!a.spatialReference&&this.isPCS(a.spatialReference.wkid));return b},checkPCSforAnalysis:function(a){var b=a.widget&&a.widget.toolName,d=!!a.widget&&!!a.widget.context&&!!a.widget.context.processSR&&this.isPCS(a.widget.context.processSR.wkid),c=!0,f=a.jobParams||a.widget.jobParams,e=!!a.widget&&!!a.widget.context&&!!a.widget.context.processSR&&
!!a.widget.context.processSR.wkid;if(!b||!f||!a.widget.showGeoAnalyticsParams)return!1;var g="\x3ca  href\x3d'#' id\x3d'"+a.widget.id+"_warn_settings_link'\x3e"+a.widget.i18n.analysisSettings+"\x3c/a\x3e\x3cdiv class\x3d'esriAnalysisSettingsIcon'\x3e\x3c/div\x3e";var h=r.substitute(a.widget.i18n.PCSReqMsg,{defaultSpatialRef:a.widget.i18n.worldCylindrical,settingsIcon:g});"FindHotSpots"!==b&&"FindPointClusters"!==b||d?"CalculateDensity"!==b&&"FindPointClusters"!==b&&"GeographicallyWeightedRegression"!==
b||d?"AggregatePoints"!==b||-1===x.indexOf(["HEXAGON","SQUARE"],f.binType)||d?"SummarizeWithin"===b&&f.summaryPolygons&&!d?c=this.isPCSByLayerType(a.widget.sumWithinLayer):"SummarizeWithin"!==b||-1===x.indexOf(["HEXAGON","SQUARE"],f.binType)||d?"JoinFeatures"===b&&f.spatialNearDistance&&"Near"===f.spatialRelationship&&!d?(c=this.isPCSByLayerType(a.widget.targetLayer))||(h=r.substitute(a.widget.i18n.JFPCSReqMsg,{settingsIcon:g})):"BuildMultiVariableGrid"!==b||d?"CalculateMotionStatistics"===b&&"Planar"===
f.distanceMethod&&(1<f.motionStatistics.split(",").length||1===f.motionStatistics.split(",").length&&-1===f.motionStatistics.indexOf("Duration"))&&!d?(c=this.isPCSByLayerType(a.widget.inputLayer))||(h=r.substitute(a.widget.i18n.CMSPCSReqMsg,{settingsIcon:g})):"TraceProximityEvents"!==b||"Planar"!==f.distanceMethod||d||(c=this.isPCSByLayerType(a.widget.inputLayer))||(h=r.substitute(a.widget.i18n.TPEPCSReqMsg,{settingsIcon:g})):c=x.every(a.inputLayers,function(m){return this.isPCSByLayerType(m)},this):
c=this.isPCSByLayerType(a.widget.summaryLayer):c=this.isPCSByLayerType(a.widget.pointLayer):(c=this.isPCSByLayerType(a.widget.inputLayer),"GeographicallyWeightedRegression"!==b||c||(h=r.substitute(a.widget.i18n.GWRPCSReqMsg,{settingsIcon:g}))):(c=this.isPCSByLayerType(a.widget.analysisLayer),"FindPointClusters"!==b||c||(h=r.substitute(a.widget.i18n.FPCSReqMsg,{settingsIcon:g})));c||a.hasPCSWarnShown||(a.widget.set("disableRunAnalysis",c),this.settingsVM&&this.settingsDlg&&a.widget._bodyNode&&a.widget._errorMessagePane&&
(this.showMessages(h,a.widget._bodyNode,a.widget._errorMessagePane),V.byId(a.widget.id+"_warn_settings_link")&&W(V.byId(a.widget.id+"_warn_settings_link"),"click",l.hitch(a.widget,a.widget.showSettingsDlg))));!c&&a.hasPCSWarnShown&&e&&(c=!0);return c},tryParseJSON:function(a){try{var b=J.parse(a);if(b&&"object"===typeof b&&null!==b)return b}catch(d){}return!1},decodeTag:function(a){return{"\x26lt;":"\x3c","\x26gt;":"\x3e"}[a]||a},stringDecode:function(a){return a.replace(/(&lt;|&gt;)/g,this.decodeTag)},
jobParamsToWidgetProps:function(a){if(a&&a.jobParams){var b=a.jobParams,d=new D,c=[],f=[],e;for(e in b){var g;b.hasOwnProperty(e)&&("string"===typeof b[e]&&-1!==b[e].search(/(&lt;|&gt;)/g)&&(b[e]=this.stringDecode(b[e])),g="string"===typeof b[e]?this.tryParseJSON(b[e]):b[e])&&(-1!==e.toLowerCase().indexOf("layer")&&"object"===typeof g?f.push({key:e,obj:g}):g&&(g.Raster||g.url)&&f.push({key:e,obj:g}),b[e]=g)}for(e=0;e<f.length;e++){g=f[e].obj;var h=f[e].key;"object"===typeof g&&g.length?(b[h]=[],x.forEach(g,
function(m,t){this._getFlayers(m,h,b,c,!0,t)},this)):"object"===typeof g&&g.Raster?(g.url=g.Raster.url,this._getFlayers(g,h,b,c,!0,"Raster")):this._getFlayers(g,h,b,c)}fa(c).then(l.hitch(this,function(){d.resolve(a)}),l.hitch(this,function(){d.resolve(a)}));return d.promise}},_getLayerType:function(a){return a?-1!==a.indexOf("BigDataCatalogServer")?E.BIGDATA:-1!==a.indexOf("ImageServer")?E.IS:E.FS:null},_getFlayers:function(a,b,d,c,f,e){if(a.url){var g=Q({url:a.url,content:{f:"json"}});var h=new D;
c.push(h);g.then(l.hitch(this,function(m,t,B,w,u){var v=this._getLayerType(m.url);if(v===E.FS){var n=new L(m.url,{mode:L.MODE_ONDEMAND,outFields:["*"],resourceInfo:u});m.filter&&n.setDefinitionExpression(m.filter);n.filter=m.filter}else v===E.BIGDATA?(n=u,l.mixin(n,m)):v===E.IS&&(u=m.Raster||m,n=new M(u.url),u.renderingRule&&n.setRenderingRule(new ta(u.renderingRule)),u.name&&(n.name=u.name),m.Raster&&m.Raster.url===m.url&&delete m.url);m.name&&(n.name=m.name);f?d[t][w]=n:f&&v===E.IS?l.mixin(d[t][w],
n):d[t]=n;B.resolve()},a,b,h,e),l.hitch(this,function(m,t,B,w,u){m={name:m.name,empty:!0};f?d[t][w]=m:d[t]=m;B.resolve()},a,b,h,e))}else c=new L(a,{outFields:["*"]}),a.name&&(c.name=a.name),f?d[b][e]=c:d[b]=c},isLayerInLayers:function(a,b){return x.some(b,function(d){return this.isSameLayer(a,d)},this)},addBlankOption:function(a,b){b&&b.length?b.push({value:"  ",label:""}):a.addOption({value:"  ",label:""});setTimeout(l.hitch(this,this._validateSelectUI,a),100)},_validateSelectUI:function(a){a._hasBeenBlurred=
!0;a.set("focused",!0);a.validate();a.set("focused",!1);a._hasBeenBlurred=!1;setTimeout(l.hitch(this,function(){a.reset()}),1E3)},updateExpressions:function(a){a&&a.selectedInputLayers&&a.inputLayers&&a.data&&a.expressions&&(x.forEach(a.selectedInputLayers,function(b,d){x.forEach(a.inputLayers,function(c,f){c&&b&&(!b.url&&!c.url&&b.name===c.name||b.url&&c.url&&b.url===c.url)&&(b._oldIndex=d,b._newIndex=f)})}),x.forEach(a.data,function(b,d){0<d&&b&&(d=a.expressions[d-1],k.isDefined(b.layer)&&(b.layer=
d&&d.layer),k.isDefined(b.selectingLayer)&&(b.selectingLayer=d&&d.selectingLayer))}),x.forEach(a.data,function(b){var d=!1,c=!1;x.forEach(a.selectedInputLayers,function(f){k.isDefined(b.layer)&&b.layer===f._oldIndex&&!d&&(b.layer=f._newIndex,d=!0);k.isDefined(b.selectingLayer)&&b.selectingLayer===f._oldIndex&&!c&&(b.selectingLayer=f._newIndex,c=!0)},this)},this))},isBigDataTypeTobeAdded:function(a){return-1==x.indexOf(a,'type:"Big Data File Share"')?!0:!1},removeDuplicates:function(a,b){for(var d=
[],c={},f=0;f<a.length;f++)c[a[f]]?c[a[f]]+=1:(d.push(a[f]),c[a[f]]=1);return b?c:d},isPoint:function(a){return a&&a.geometryType===q.GeometryTypes.Point},isLine:function(a){return a&&a.geometryType===q.GeometryTypes.Line},isPolygon:function(a){return a&&a.geometryType===q.GeometryTypes.Polygon},isSameLayer:function(a,b){return a&&b&&(a.name&&b.name&&a.name===b.name||a.url&&b.url&&a.url===b.url)},getTimeType:function(a){return a?k.isDefined(a.timeInfo)&&k.isDefined(a.timeInfo.startTimeField)&&!k.isDefined(a.timeInfo.endTimeField)?
q.TimeTypes.Instant:k.isDefined(a.timeInfo)&&k.isDefined(a.timeInfo.startTimeField)&&k.isDefined(a.timeInfo.endTimeField)?q.TimeTypes.Interval:k.isDefined(a.time)&&k.isDefined(a.time.timeType)?a.time.timeType:!1:!1},fetchGroupForRFT:function(a){var b=new D,d=da.locale,c=d?d.substring(0,2):"en";d=this.systemRFTGroupName+" owner: ("+("en"===c?["esri_en"]:["esri_en","esri_"+c]).join(" OR ")+")";a.queryGroups({q:d},!0).then(function(f){0<f.total&&f.results?(f=f.results,f=this.findRFTLocaleGroup(f,c)||
this.findRFTLocaleGroup(f,"en"),b.resolve(f)):b.resolve(null)}.bind(this));return b},findRFTLocaleGroup:function(a,b){var d;a.some(function(c){var f=c.owner;if(f&&f.substring(f.length-2)===b)return d=c,!0});return d},updateOptions:function(a,b){if(a){for(;0<a.getOptions().length;)a.removeOption(a.getOptions());a._setDisplay("");b&&0<b.length&&a.addOption(b)}},addOptionsFromLayers:function(a){a.select&&a.layers&&(a.customOptions=a.customOptions||[],a.forbiddenLayers=a.forbiddenLayers||[],a.layers.forEach(function(b,
d){this.isLayerInLayers(b,a.forbiddenLayers)||a.customOptions.push({value:d.toString(),label:b.name,selected:a.selectedOption&&this.isSameLayer(a.selectedOption,b)})},this),this.updateOptions(a.select,a.customOptions),this.addBrowseOptionForTool({select:a.select,disableLAAL:!0},a.widget))},replaceTag:function(a){return{"\x26":"\x26amp;","\x3c":"\x26lt;","\x3e":"\x26gt;"}[a]||a},safetagsReplace:function(a){return a.replace(/[<>]/g,this.replaceTag)}});l.setObject("dijit.analysis.utils",I,na);return I});