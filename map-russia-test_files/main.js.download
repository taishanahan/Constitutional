//>>built
/*
 layer.url ||*/
define("arcgisonline/map/main",["dojo","dijit","dojox"],function(b,r,X){function G(a,c,d){if(a.removeEventListener)return a.removeEventListener(c,d,!1);if(a.detachEvent)return a.detachEvent("on"+c,d)}function M(a,c){for(c=c.parentNode;null!=c;){if(c==a)return!0;c=c.parentNode}return!1}b.provide("arcgisonline.map.main");String.prototype.startsWith=function(a){return 0==this.indexOf(a)};String.prototype.endsWith=function(a){return this.substring(this.length-a.length)===a};String.prototype.count=function(a){return this.split(a).length-
1};String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^\s\s*/,"").replace(/\s\s*$/,"")});arcgisonline.isEmpty=function(a){return a?b.json.stringify(a)===b.json.stringify({}):!1};var H=function(a){a.preventDefault();var c=b.hasClass(this,"is-active");b.query(".dropdown").removeClass("is-active");if(!c){b.addClass(this,"is-active");b.stopEvent(a);a={btn:a.target||a.srcElement,dropdown:this};arcgisonline.map.main.dropdownHandlers&&b.forEach(arcgisonline.map.main.dropdownHandlers,
function(e){b.disconnect(e);e=null});arcgisonline.map.main.dropdownHandlers=[];arcgisonline.map.main.dropdownHandlers.push(b.connect(document.body,"click",b.hitch(a,z)));c="click";b.has("esri-touch")&&!b.has("ff")&&(c="touchstart",arcgisonline.map.main.map&&arcgisonline.map.main.dropdownHandlers.push(b.connect(arcgisonline.map.main.map.container,c,b.hitch(a,z))));var d=b.query(".esriSimpleSliderIncrementButton");d&&d.length&&arcgisonline.map.main.dropdownHandlers.push(b.connect(d[0],c,b.hitch(a,z)));
(d=b.query(".esriSimpleSliderDecrementButton"))&&d.length&&arcgisonline.map.main.dropdownHandlers.push(b.connect(d[0],c,b.hitch(a,z)))}},z=function(a){var c=b.query(".dropdown-menu",this.dropdown)[0];M(c,a.target||a.srcElement)||(b.removeClass(this.dropdown,"is-active"),G(document.body,"click",z),(a=b.query(".esriSimpleSliderIncrementButton"))&&a.length&&G(a[0],"click",z),(a=b.query(".esriSimpleSliderDecrementButton"))&&a.length&&G(a[0],"click",z),arcgisonline.map.main.dropdownHandlers&&b.forEach(arcgisonline.map.main.dropdownHandlers,
function(d){b.disconnect(d);d=null}),arcgisonline.map.main.dropdownHandlers=[])};arcgisonline.map.main={defaultBaseLayer:null,defaultBaseLayerMapLods:null,scaleBarUnits:"metric",mapLods:null,baseTilingSchemeScales:"",selfCallResult:null,map:null,overviewMap:null,scalebar:null,measureTool:null,measureActivated:!1,bookmarksTool:null,homeButton:null,locateButton:null,defaultExtent:null,initialExtent:null,lastExtent:null,defaultService:null,currentBaseService:"",isUserBaseService:!1,allLegendInfos:[],
basemapTitle:"",queryLimitExceededLayers:[],mapLayers:[],mapTables:[],geometryService:null,mapInitialized:!1,startup:!0,isMapFullyLoaded:!1,mapHasChanged:!1,mapFullyLoadedTimer:null,noDataDisplayTimer:null,analysisProps:{},esriIdCredential:null,init:function(a){arcgisonline.map.embedded.doEmbeddedCheck(a).then(function(c){if(c){if(!esri.isTouchEnabled&&(b.has("edge")||4<b.has("trident")))var d=b.connect(document,"touchstart",function(){esri.isTouchEnabled||(esri.isTouchEnabled=!0,b.disconnect(d),
b.disconnect(e),b.disconnect(f),"contentStack"===arcgisonline.map.leftPanel.getLeftContentPanelStack()&&b.publish("onLayerUpdate",[""]))}),e=document.addEventListener("MSPointerDown",function(l){"touch"!==l.pointerType||esri.isTouchEnabled||(esri.isTouchEnabled=!0,b.disconnect(d),b.disconnect(e),b.disconnect(f),"contentStack"===arcgisonline.map.leftPanel.getLeftContentPanelStack()&&b.publish("onLayerUpdate",[""]))}),f=document.addEventListener("pointerdown",function(l){"touch"!==l.pointerType||esri.isTouchEnabled||
(esri.isTouchEnabled=!0,b.disconnect(d),b.disconnect(e),b.disconnect(f),"contentStack"===arcgisonline.map.leftPanel.getLeftContentPanelStack()&&b.publish("onLayerUpdate",[""]))});esri.arcgis.utils.arcgisUrl=esriGeowConfig.restBaseUrl+"content/items";arcgisonline.sharing.geow.Account.loadMapSettings(b.hitch(this,arcgisonline.map.main.initMapProperties));b.query("#home-navigation-dropdown-link").onclick(b.hitch(b.byId("home-navigation-dropdown"),H));b.query("#webmap-recentMaps").onclick(b.hitch(b.byId("recentMaps-navigation"),
H));b.query("#logged-in-navigation-link").onclick(b.hitch(b.byId("logged-in-navigation"),H));9>b.isIE&&b.style(b.byId("locationDiv"),"right","8px");b.byId("headerBanner")&&(c=b.coords(b.byId("headerBanner")),0<c.h&&b.style(b.query(".header-map-home")[0],"marginTop",c.h+"px"));arcgisonline.map.table.hideAttributeTable();b.connect(r.byId("leftContentPanel"),"resize",arcgisonline.map.leftPanel,"checkLeftPanelButtonLabels");arcgisonline.map.main.dojoPatch();9>b.isIE&&b.style(b.byId("locationDiv"),"right",
"8px");if(navigator.userAgent.match(/iPad;.*CPU.*OS 7_\d/i)&&window.innerHeight!=document.documentElement.clientHeight){var h=function(){b.style(document.getElementById("page-border"),"height",window.innerHeight+"px");r.byId("page-border").resize();0===document.body.scrollTop&&0===document.body.scrollLeft||window.scrollTo(0,0)};setTimeout(function(){h()},1);window.addEventListener("orientationchange",h,!1)}b.subscribe("onUTCOffsetChange",b.hitch(arcgisonline.map.main,"onUTCOffsetChange"))}})},initMapProperties:function(a){arcgisonline.map.main.selfCallResult=
a;esriGeowConfig.userInfo=a.user;esriGeowConfig.userInfo&&(esriGeowConfig.userInfo.credential=arcgisonline.map.main.esriIdCredential,esriGeowConfig.userInfo.token=arcgisonline.map.main.esriIdCredential.token);arcgisonline.map.vectorTile.checkFallBackVectorTileLayers().then(function(c){c=c.baseMap;var d=c.baseMapLayers[0];(esriGeowConfig.allSSL||"https:"==location.protocol)&&d.url&&(arcgisonline.sharing.util.isHostedService(d.url)||arcgisonline.sharing.util.supportsHttps(d.url))&&(d.url=d.url.replace("http:",
"https:"),d.resourceInfo&&d.resourceInfo.tileServers&&d.resourceInfo.tileServers.length&&b.forEach(d.resourceInfo.tileServers,function(g,m){if(arcgisonline.sharing.util.isHostedService(g)||arcgisonline.sharing.util.supportsHttps(g))d.resourceInfo.tileServers[m]=g.replace("http:","https:")}));arcgisonline.map.main.basemapTitle=c.title;arcgisonline.map.main.defaultBaseLayer={layer:null,layers:d.layers,id:d.id||"defaultBasemap",type:"base",title:d.title||arcgisonline.map.main.getSpecialTitle(d)||c.title,
itemId:d.itemId,url:d.url?d.url:null,templateUrl:d.templateUrl?d.templateUrl:null,styleUrl:d.styleUrl,identify:!1,serviceInfo:d.resourceInfo,copyright:d.copyright,fullExtent:d.fullExtent instanceof esri.geometry.Extent?d.fullExtent:d.fullExtent?esri.geometry.Extent(d.fullExtent):null,subDomains:d.subDomains,tileInfo:d.tileInfo?esri.layers.TileInfo(d.tileInfo):null,tileServers:d.tileServers,wmtsInfo:d.wmtsInfo,refreshInterval:d.refreshInterval};arcgisonline.map.main.defaultBaseLayer.url||(arcgisonline.map.main.defaultBaseLayer._layerType=
c.baseMapLayers[0].type||c.baseMapLayers[0].layerType);if(d.resourceInfo&&d.resourceInfo.tileInfo)arcgisonline.map.main.defaultBaseLayerMapLods=d.resourceInfo.tileInfo.lods;else if("WMS"==d.type||"WMS"==d.layerType)arcgisonline.map.main.defaultBaseLayer=b.mixin(arcgisonline.map.main.defaultBaseLayer,{_layerType:"WMS",extent:esri.geometry.Extent(d.extent),layers:d.layers,mapUrl:d.mapUrl,maxHeight:d.maxHeight,maxWidth:d.maxWidth,opacity:d.opacity,spatialReferences:d.spatialReferences,version:d.version,
visibility:d.visibility,visibleLayers:d.visibleLayers.toString()});else if("OpenStreetMap"==d.type||"OpenStreetMap"==d.layerType)c=new esri.layers.OpenStreetMapLayer,arcgisonline.map.main.defaultBaseLayerMapLods=c.tileInfo.lods;else if(d.type&&-1<d.type.indexOf("BingMaps")||d.layerType&&-1<d.layerType.indexOf("BingMaps")){if(!esriGeowConfig.self.bingKey){arcgisonline.sharing.dijit.dialog.GeneralDlg.prototype.statics.getInstance().show({title:esri.i18nBundle.generalDlg.errorDlgTitle,message:b.string.substitute(esri.i18nBundle.viewer.error.basemapTitleNotAvailable2,
{title:c.title})});return}arcgisonline.map.main.defaultBaseLayer.bingKey=esriGeowConfig.self.bingKey;c=new esri.virtualearth.VETiledLayer({bingMapsKey:esriGeowConfig.self.bingKey,mapStyle:esri.virtualearth.VETiledLayer.MAP_STYLE_AERIAL});arcgisonline.map.main.defaultBaseLayerMapLods=c.tileInfo.lods}b.connect(document,"onkeypress",b.hitch(arcgisonline.map.main,"onKeyPress"));c=arcgisonline.map.main.buildNewMapViewerUrl();b.byId("webmap-openNewViewer").href=c;b.connect(b.byId("webmap-openNewViewer"),
"onclick",b.hitch(arcgisonline.map.main,"openNewMapViewer"));b.connect(b.byId("webmap-newMap"),"onclick",b.hitch(arcgisonline.map.main,"openNewMap"));b.connect(b.byId("webmap-modifyMap"),"onclick",b.hitch(arcgisonline.map.role,"updateUserActionAfterModify"));b.connect(b.byId("webmap-details"),"onclick",b.hitch(arcgisonline.map.leftPanel,"openLeftDetailsPanel"));b.connect(b.byId("webmap-basemap"),"onclick",b.hitch(arcgisonline.map.main,"showBasemapGallery"));arcgisonline.map.main.isReadOnlyMode()||
b.connect(b.byId("webmap-edit"),"onclick",b.hitch(arcgisonline.map.leftPanel,"openLeftEditPanel"));esriGeowConfig.showAnalysisHistory&&!arcgisonline.map.main.isReadOnlyMode()?(b.connect(r.byId("webmap-analysis-analysis"),"onClick",b.hitch(this,function(g){arcgisonline.map.dijit.toc.analysis.configureAnalysis(g,{isMenu:!0})})),b.connect(r.byId("webmap-analysis-history"),"onClick",b.hitch(this,function(g){arcgisonline.map.dijit.toc.analysis.configureAnalysisHistory(g,{isMenu:!0})}))):(r.byId("webmap-analysis").destroy(),
c=b.create("div",{id:"webmap-analysis"}),b.place(c,b.byId("webmap-spacer2"),"after"),new r.form.ToggleButton({iconClass:"menuIconPerformAnalysis",style:"margin-top:2px;"},c),arcgisonline.map.main.isReadOnlyMode()||b.connect(b.byId("webmap-analysis"),"onclick",b.hitch(this,function(g){"analysisStack"==arcgisonline.map.leftPanel.getLeftContentPanelStack()||"toolStack"==arcgisonline.map.leftPanel.getLeftContentPanelStack()?arcgisonline.map.leftPanel.openLeftTOCPanel():arcgisonline.map.dijit.toc.analysis.configureAnalysis(g,
{isMenu:!0})})));arcgisonline.map.main.isReadOnlyMode()||(b.connect(b.byId("webmap-share"),"onclick",b.hitch(arcgisonline.map.main,"linkToMap",!1)),b.connect(b.byId("webmap-directions"),"onclick",b.hitch(arcgisonline.map.leftPanel,"openLeftDirectionsPanel")));b.connect(b.byId("webmap-measure"),"onclick",b.hitch(arcgisonline.map.main,"showMeasureTool"));b.connect(b.byId("webmap-bookmarks"),"onclick",b.hitch(arcgisonline.map.main,"showBookmarksTool"));if(esriGeowConfig.self.helperServices.printTask.templates&&
1<esriGeowConfig.self.helperServices.printTask.templates.length){var e=r.byId("webmap-print-templates-menu");b.forEach(esriGeowConfig.self.helperServices.printTask.templates,function(g){g=new r.MenuItem({label:g.label,onClick:b.hitch(arcgisonline.map.print,"printMap",g)});e.addChild(g)})}else e=r.byId("webmap-print-templates-menu"),c=new r.MenuItem({label:esri.i18nBundle.viewer.map,onClick:b.hitch(arcgisonline.map.print,"printMap",esriGeowConfig.self.helperServices.printTask.templates&&esriGeowConfig.self.helperServices.printTask.templates[0]||
null,!1)}),e.addChild(c),c=new r.MenuItem({label:esri.i18nBundle.viewer.mapWithLegend,onClick:b.hitch(arcgisonline.map.print,"printMap",esriGeowConfig.self.helperServices.printTask.templates&&esriGeowConfig.self.helperServices.printTask.templates[0]||null,!0)}),e.addChild(c);b.style(r.byId("webmap-print-templates").domNode,"display","");b.style(r.byId("webmap-print").domNode,"display","none");arcgisonline.map.main.checkReadOnly();arcgisonline.map.embedded.adjustUIForEmbedded();b.subscribe("onLayerVisibilityChange",
b.hitch(arcgisonline.map.main,"onLayerVisibilityChange"));b.subscribe("onDefExprChanged",b.hitch(arcgisonline.map.main,"markMapAsChanged","onFilterApply"));b.subscribe("onServiceDefExprChanged",b.hitch(arcgisonline.map.itemData,"updateServiceDefinitionWithFilter"));b.subscribe("onServiceFieldsChanged",b.hitch(arcgisonline.map.itemData,"updateServiceFields"));arcgisonline.map.role.setupUserActions();arcgisonline.map.main.updateHeaderLinks();esriGeowConfig.self.helperServices&&esriGeowConfig.self.helperServices.geometry&&
esriGeowConfig.self.helperServices.geometry.url?esri.config.defaults.geometryService=new esri.tasks.GeometryService(esriGeowConfig.self.helperServices.geometry.url):console.err("No Geometry Service defined.",esriGeowConfig.self);esri.config.defaults.kmlService=esriGeowConfig.kmlService;esri.config.defaults.geoRSSService=esriGeowConfig.geoRSSService;esri.config.defaults.io.proxyUrl=esriGeowConfig.proxyServer;esri.isDefined(esriGeowConfig.isMultiTenant)&&!1===esriGeowConfig.isMultiTenant?(esri.config.defaults.io.corsEnabledServers.push(arcgisonline.sharing.util.getHttpUrl(location.host).replace(/:80$/,
"")),esri.config.defaults.io.corsEnabledServers.push(arcgisonline.sharing.util.getSecureUrl(location.host).replace(/:443$/,""))):(esri.config.defaults.io.corsEnabledServers.push(arcgisonline.sharing.util.getHttpUrl(location.host)),esri.config.defaults.io.corsEnabledServers.push(arcgisonline.sharing.util.getSecureUrl(location.host)));esriGeowConfig.self.authorizedCrossOriginDomains&&esriGeowConfig.self.authorizedCrossOriginDomains.length&&b.forEach(esriGeowConfig.self.authorizedCrossOriginDomains,
function(g){esri.config.defaults.io.corsEnabledServers.push({host:g,withCredentials:!0})});c=arcgisonline.sharing.util.getUser();arcgisonline.map.main.scaleBarUnits="metric";if(esriGeowConfig.self.user&&esriGeowConfig.self.user.units)arcgisonline.map.main.scaleBarUnits=esriGeowConfig.self.user.units;else if(esriGeowConfig.self.units)arcgisonline.map.main.scaleBarUnits=esriGeowConfig.self.units;else if(c&&c.region&&"US"===c.region||c&&!c.region&&"US"===esriGeowConfig.self.region||c&&!c.region&&!esriGeowConfig.self.region||
!c&&"US"===esriGeowConfig.self.ipCntryCode||!c&&!esriGeowConfig.self.ipCntryCode&&"en-us"===b.locale)arcgisonline.map.main.scaleBarUnits="english";c&&c.accountId||(arcgisonline.map.main.appAccess=!0);b.config.deferredOnError=function(g,m){};b.mixin(esri.symbol.defaultSimpleMarkerSymbol,{style:"circle",color:[0,0,0,1],outline:null,size:4,angle:0,xoffset:0,yoffset:0});var f=esri.dijit.Popup.prototype._zoomToFeature;esri.dijit.Popup.prototype._zoomToFeature=function(){var g=this.getSelectedFeature(),
m=g.getLayer();if(m&&m.__isFootprintLayer&&g.attributes.xmin&&g.attributes.ymin&&g.attributes.xmax&&g.attributes.ymax)g=new esri.geometry.Extent(g.attributes.xmin,g.attributes.ymin,g.attributes.xmax,g.attributes.ymax,m.fullExtent.spatialReference),arcgisonline.map.main.map.setExtent(g,!0);else return f.apply(this,arguments)};c=arcgisonline.sharing.util.getUser();arcgisonline.map.main.loggedIn();arcgisonline.map.leftPanel.initSettings();c=arcgisonline.sharing.util.urlToObject(document.URL);c.query=
c.query||{};c.query.folder&&(arcgisonline.map.save_open.folderId=c.query.folder,arcgisonline.map.save_open.folderTitle="dummy");c.query.useExisting||arcgisonline.map.storage.deleteMapCookie();if(c.query.useExisting)arcgisonline.map.storage.openWebMapFromCookie();else if(c.query.webmap)arcgisonline.map.save_open.openWebMapItemCard(c.query.webmap);else if(c.query.basemapUrl){var h=arcgisonline.map.main.decodeUrl(c.query.basemapUrl),l=arcgisonline.map.main.getTitleFromUrl(h);arcgisonline.map.main.basemapTitle=
l;-1<c.query.basemapUrl.indexOf("/VectorTileServer")?(-1===h.indexOf("root.json")&&(h+=(h.endsWith("/")?"":"/")+"resources/styles/root.json"),arcgisonline.map.vectorTile.addVectorTileAsBaseLayer({id:"VectorTile_"+Math.floor(10001*Math.random()),type:"VectorTileLayer",layerType:"VectorTileLayer",title:l,styleUrl:h},null,b.hitch(this,function(){arcgisonline.map.layer.loadMoreLayers()}))):arcgisonline.map.layer.addUserBaseLayer({url:h})}else arcgisonline.map.layer.addDefaultBaseLayers();window.onresize=
9>b.isIE?function(){r.byId("page-border").resize();arcgisonline.map.main.checkTitleDiv();arcgisonline.map.main.checkMinWidthOfPage()}:function(){arcgisonline.map.main.checkTitleDiv();arcgisonline.map.main.checkMinWidthOfPage()}})},updateHeaderLinks:function(){var a=esriGeowConfig.baseUrl,c=esriGeowConfig.self,d=arcgisonline.sharing.util.getUser();arcgisonline.sharing.util.isPortal()&&"7443"===location.port&&(a=arcgisonline.sharing.util.getSecureUrl(a));arcgisonline.sharing.util.isPortal()||(d&&(b.attr(b.byId("accountSwitcher-link"),
"innerHTML",esri.i18nBundle.siteHeader.switchAccounts+"\x26nbsp;\x26nbsp;"),b.query("#accountSwitcher-link").removeClass("hide"),b.connect(b.byId("accountSwitcher-link"),"onclick",b.hitch(this,function(g){g.preventDefault();window.open("https://"+window.location.host+"/home/pages/Account/manage_accounts.html#client_id\x3darcgisonline")}))),esriGeowConfig.self&&esriGeowConfig.self.subscriptionInfo&&("Trial"===esriGeowConfig.self.subscriptionInfo.type||"Trial Press"===esriGeowConfig.self.subscriptionInfo.type)&&
(b.attr(b.byId("trial-download-link"),"innerHTML",esri.i18nBundle.siteHeader.trialDownload+"\x26nbsp;\x26nbsp;"),b.query("#trial-download-link").removeClass("hide"),b.connect(b.byId("trial-download-link"),"onclick",b.hitch(this,function(g){g.preventDefault();g=(esriGeowConfig.self&&esriGeowConfig.self.user&&esriGeowConfig.self.user.culture||esriGeowConfig.self&&esriGeowConfig.self.culture||dojoConfig.locale||"en").toLowerCase();g=esriGeowConfig.learnArcGIS+"/"+(g in{"pt-br":1,"pt-pt":1,"zh-cn":1}?
g:g.split("-")[0].toLowerCase())+"/trial";window.open(g)}))));b.attr(b.byId("home-navigation-dropdown-link"),"innerHTML",'\x3cdiv id\x3d"site_logo"\x3eArc\x3cspan\x3eGIS\x3c/span\x3e\x3c/div\x3e');b.addClass(b.byId("home-navigation-dropdown-link"),"site_logo");var e=esriGeowConfig.self&&esriGeowConfig.self.portalProperties&&esriGeowConfig.self.portalProperties.topNav||{},f=esriGeowConfig.self&&d&&d.accountId&&d.accountId===esriGeowConfig.self.id,h=c.helpBase+(c.isPortal&&"ArcGISEnterpriseOnKubernetes"!==
c.portalDeploymentType?esriGeowConfig.helpMap["120001577"]||"":"");b.query(".homeHelp").attr("href",h);b.query(".homeHelp",this.domNode).connect("onclick",b.hitch(this,function(g){g.preventDefault();window.open(h,"_blank")}));b.query(".homeScene",this.domNode).connect("onclick",b.hitch(this,function(g){g.preventDefault();window.location="../webscene/viewer.html"}));var l=e.scene;(!l||"all"===l||"members"===l&&f||"sceneCreators"===l&&f&&esriGeowConfig.userRole&&esriGeowConfig.userRole.canCreateItem())&&
b.query(".homeScene",this.domNode).removeClass("hide");d?(b.query("#profileLink",this.domNode).connect("onclick",b.hitch(this,function(g){g.preventDefault();arcgisonline.map.main.goToPage(a+"user.html")})),b.query(".loggedInSignout",this.domNode).connect("onclick",b.hitch(this,function(g){g.preventDefault();arcgisonline.map.main.logOut()})),b.query(".homeHome",this.domNode).connect("onclick",b.hitch(this,function(g){g.preventDefault();arcgisonline.map.main.goToPage(a+"index.html")})),b.query(".homeHome",
this.domNode).removeClass("hide"),arcgisonline.map.role.isAllowed("header_myContent")&&(b.query(".homeMyContent",this.domNode).connect("onclick",b.hitch(this,function(g){g.preventDefault();arcgisonline.map.main.goToPage(a+"content.html")})),b.query(".homeMyContent",this.domNode).removeClass("hide")),b.query(".homeGroups",this.domNode).connect("onclick",b.hitch(this,function(g){g.preventDefault();arcgisonline.map.main.goToPage(a+"groups.html")})),l=e.groups,(!l||"all"===l||"members"===l&&f)&&b.query(".homeGroups",
this.domNode).removeClass("hide"),l=e.notebook||"members",arcgisonline.pages.utils.notebook.notebookServerConfigured()&&("members"===l&&f||"notebookCreators"===l&&f&&esriGeowConfig.userRole&&esriGeowConfig.userRole.canCreateNotebooks())&&b.query(".homeNotebook",this.domNode).removeClass("hide"),arcgisonline.sharing.util.isPortal()?b.query(".loggedInHelp",this.domNode).connect("onclick",b.hitch(this,function(g){g.preventDefault();arcgisonline.map.main.openHelp()})):b.query(".loggedInHelp",this.domNode).connect("onclick",
b.hitch(this,function(g){g.preventDefault();window.open(c.helpBase,"_blank")})),b.style(b.query(".homeHelp",this.domNode)[0],"display","none"),d.accountId?(b.attr(b.byId("home-navigation-dropdown-link"),"innerHTML",esri.i18nBundle.siteHeader.simpleHome),b.query("#home-navigation-dropdown-link").removeClass("site_logo top-nav-title").addClass("top-nav-link"),b.query(".homeGallery",this.domNode).connect("onclick",b.hitch(this,function(g){g.preventDefault();arcgisonline.map.main.goToPage(a+"gallery.html")})),
e=e.gallery,"noOne"!==e&&(!e||"all"===e||"members"===e&&f)&&b.query(".homeGallery",this.domNode).removeClass("hide"),b.query(".homeMyOrg",this.domNode).connect("onclick",b.hitch(this,function(g){g.preventDefault();arcgisonline.map.main.goToPage(a+"organization.html")})),arcgisonline.sharing.util.isPortal()&&esriGeowConfig.restrictOrganizationPageToAdmin&&(!esriGeowConfig.userRole||esriGeowConfig.userRole&&!esriGeowConfig.userRole.isAdmin())?b.query(".homeMyOrg",this.domNode).addClass("hide"):b.query(".homeMyOrg",
this.domNode).removeClass("hide")):(b.query("#home-navigation-dropdown-link").removeClass("top-nav-link").addClass("top-nav-title site_logo"),b.query(".homeOverview",this.domNode).connect("onclick",b.hitch(this,function(g){g.preventDefault();arcgisonline.map.main.goToPage(a+"../features/features.html")})),b.query(".homeOverview").removeClass("hide"),b.query(".homePricing",this.domNode).connect("onclick",b.hitch(this,function(g){g.preventDefault();arcgisonline.map.main.goToPage(a+"../features/plans/pricing.html")})),
b.query(".homePricing").removeClass("hide")),f=b.byId("my-settings"),f.classList.remove("hide"),f.innerHTML='\x3cspan class\x3d"icon-ui-link-external dropdown-link-external-icon"\x3e\x3c/span\x3e'+esri.i18nBundle.siteHeader.mySettings,b.connect(f,"onclick",b.hitch(this,function(g){g.preventDefault();window.open(esriGeowConfig.baseUrl+"user.html#settings","_blank")})),!arcgisonline.sharing.util.isPortal()&&d&&"both"===d.userType&&(b.query("#training-link").removeClass("hide"),b.attr(b.byId("training-link"),
"innerHTML",'\x3cspan class\x3d"icon-ui-link-external dropdown-link-external-icon"\x3e\x3c/span\x3e'+esri.i18nBundle.siteHeader.training),b.connect(b.byId("training-link"),"onclick",b.hitch(this,function(g){g.preventDefault();g={administrator:"//www.esri.com/training/main/arcgis-online-administrators",publisher:"//www.esri.com/training/main/arcgis-online-publishers",user:"//www.esri.com/training/main/arcgis-online-users","public":"//www.esri.com/training/main/arcgis-online-training",custom:"//www.esri.com/training/main/arcgis-online-training"};
var m=esriGeowConfig.userRole,n;m?m.isAdmin()||m.isBasedOnAdmin()?n=g.administrator:m.isPublisher()||m.isBasedOnPublisher()?n=g.publisher:m.isUser()||m.isBasedOnUser()?n=g.user:m.isCustom()&&(n=g.custom):n=g["public"];window.open(n)})),b.query("#esri-community-link").removeClass("hide"),b.attr(b.byId("esri-community-link"),"innerHTML",'\x3cspan class\x3d"icon-ui-link-external dropdown-link-external-icon"\x3e\x3c/span\x3e'+esri.i18nBundle.siteHeader.esriCommunity),b.connect(b.byId("esri-community-link"),
"onclick",b.hitch(this,function(g){g.preventDefault();window.open(esriGeowConfig.esriCommunityLink,"_blank")})),b.query("#my-esri-link").removeClass("hide"),b.attr(b.byId("my-esri-link"),"innerHTML",'\x3cspan class\x3d"icon-ui-link-external dropdown-link-external-icon"\x3e\x3c/span\x3e'+esri.i18nBundle.siteHeader.myEsri),b.connect(b.byId("my-esri-link"),"onclick",b.hitch(this,function(g){g.preventDefault();window.open(esriGeowConfig.myEsriLink,"_blank")})),b.query("#arcgis-blog-link").removeClass("hide"),
b.attr(b.byId("arcgis-blog-link"),"innerHTML",'\x3cspan class\x3d"icon-ui-link-external dropdown-link-external-icon"\x3e\x3c/span\x3e'+esri.i18nBundle.siteHeader.arcgisBlog),b.connect(b.byId("arcgis-blog-link"),"onclick",b.hitch(this,function(g){g.preventDefault();window.open("https://www.esri.com/arcgis-blog/arcgis-online/","_blank")})))):(b.query(".signin",this.domNode).connect("onclick",b.hitch(this,function(g){g.preventDefault();arcgisonline.map.main.signIn()})),esriGeowConfig.self.urlKey||arcgisonline.sharing.util.isPortal()?
(b.attr(b.byId("home-navigation-dropdown-link"),"innerHTML",esri.i18nBundle.siteHeader.simpleHome),b.query(".homeHome",this.domNode).connect("onclick",b.hitch(this,function(g){g.preventDefault();arcgisonline.map.main.goToPage(a+"index.html")})),b.query(".homeHome",this.domNode).removeClass("hide"),b.query(".homeGallery",this.domNode).connect("onclick",b.hitch(this,function(g){g.preventDefault();arcgisonline.map.main.goToPage(a+"gallery.html")})),(e=e&&e.gallery)&&"all"!==e||b.query(".homeGallery",
this.domNode).removeClass("hide")):(b.query(".homeOverview",this.domNode).connect("onclick",b.hitch(this,function(g){g.preventDefault();arcgisonline.map.main.goToPage(a+"../features/features.html")})),b.query(".homeOverview",this.domNode).removeClass("hide"),b.query(".homePricing",this.domNode).connect("onclick",b.hitch(this,function(g){g.preventDefault();arcgisonline.map.main.goToPage(a+"../features/plans/pricing.html")})),b.query(".homePricing",this.domNode).removeClass("hide")));(!esriGeowConfig.self.isPortal||
esriGeowConfig.self.livingAtlasGroupQuery&&esriGeowConfig.self.livingAtlasGroupQuery.length)&&b.style(b.byId("webmap-add-esri-maplayers"),"display","block");d&&d.accountId&&!esriGeowConfig.self.isPortal&&arcgisonline.map.vectorTile.checkSupport().then(b.hitch(this,function(g){var m=g?"Map Service;Image Service;Feature Service;WMS;WFS;WMTS;KML;Vector Tile Service".split(";"):"Map Service;Image Service;Feature Service;WMS;WFS;WMTS;KML".split(";");esri.request({url:esriGeowConfig.restBaseUrl+"community/users/"+
d.username+"/provisionedListings",content:{f:"json",start:1,num:100},callbackParamName:"callback",load:function(n){if(n&&n.provisionedListings){for(var p=!1,q=0;q<n.provisionedListings.length;q++){var t=n.provisionedListings[q];if(-1<b.indexOf(m,t.type)&&-1===b.indexOf(t.typeKeywords,"Elevation 3D Layer")&&-1===b.indexOf(t.tags,"mature support")){b.style(b.byId("webmap-add-provisionedListings"),"display","block");p=!0;break}}if(!p)for(q=0;q<n.provisionedListings.length&&!p;q++)t=n.provisionedListings[q],
p||-1!==t.type.indexOf("Application")||"Web Map"===t.type||esri.request({url:esriGeowConfig.restBaseUrl+"content/items/"+this.mapLayer.oldItemCard.id+"/relatedItems?relationshipType\x3dService2Style\x26direction\x3dreverse\x26f\x3djson",callbackParamName:"callback",load:b.hitch(this,function(v,u){if(v&&v.relatedItems&&v.relatedItems.length)for(u=0;u<v.relatedItems.length;u++){var B=v.relatedItems[u];-1<b.indexOf(m,B.type)&&-1===b.indexOf(B.typeKeywords,"Elevation 3D Layer")&&-1===b.indexOf(B.tags,
"mature support")&&(b.style(b.byId("webmap-add-provisionedListings"),"display","block"),p=!0)}}),error:b.hitch(this,function(v){})})}},error:function(n){}})}));arcgisonline.map.main.updateRecentWebMaps()},initMap:function(a){arcgisonline.map.main.mapInitialized=!0;b.connect(arcgisonline.map.main.map,"onDblClick",b.hitch(arcgisonline.map.main,"onDblClick"));b.connect(arcgisonline.map.main.map,"onExtentChange",b.hitch(arcgisonline.map.main,"onExtentChange"));b.connect(arcgisonline.map.main.map,"onPanStart",
b.hitch(arcgisonline.map.main,"onPanStart"));b.connect(arcgisonline.map.main.map,"onPanEnd",b.hitch(arcgisonline.map.main,"onPanEnd"));b.connect(arcgisonline.map.main.map,"onZoomEnd",b.hitch(arcgisonline.map.main,"onZoomEnd"));b.subscribe("_onRendererUpdate",b.hitch(arcgisonline.map.main,"onRendererUpdate"));arcgisonline.map.main.setHandCursor();arcgisonline.map.main.initialExtent=a;arcgisonline.map.main.setMapExtent(a);if(arcgisonline.map.main.defaultService.layer.loaded)arcgisonline.map.main.onDefaultServiceLoad(arcgisonline.map.main.defaultService.layer);
else b.connect(arcgisonline.map.main.defaultService.layer,"onLoad",b.hitch(arcgisonline.map.main,"onDefaultServiceLoad"));arcgisonline.map.main.map.disableClickRecenter()},createOverviewMap:function(){if(!isEmbedded||!isEmbedded.isItemDetail){var a=arcgisonline.map.main.map.getLayer(arcgisonline.map.main.currentBaseService);if(!a||!arcgisonline.map.main.mapInitialized)setTimeout(b.hitch(arcgisonline.map.main,"createOverviewMap"),1E3);else if(!arcgisonline.map.main.overviewMap){var c=!1;b.forEach(arcgisonline.map.main.mapLayers,
function(e){"base"===e.type&&e.layer&&"esri.layers.VectorTileLayer"===e.layer.declaredClass&&(c=!0)});if(c){var d=esriGeowConfig.extentService;if(4326===a.spatialReference.wkid)d=esriGeowConfig.gcsBasemapService;else if(!arcgisonline.map.main.map.spatialReference.isWebMercator())return;if(esriGeowConfig.allSSL||"https:"==location.protocol)d=d.replace("http:","https:");a=new esri.layers.ArcGISTiledMapServiceLayer(d,{});b.connect(a,"onLoad",function(){arcgisonline.map.main.overviewMap=new esri.dijit.OverviewMap({id:"overviewMap",
baseLayer:a,map:arcgisonline.map.main.map,opacity:.45,width:200,height:200});arcgisonline.map.main.overviewMap.startup()})}else arcgisonline.map.main.overviewMap||"esri.layers.WMSLayer"===a.declaredClass||(arcgisonline.map.main.overviewMap=new esri.dijit.OverviewMap({id:"overviewMap",map:arcgisonline.map.main.map,opacity:.45,width:200,height:200}),arcgisonline.map.main.overviewMap.startup())}}},destroyOverviewMap:function(){arcgisonline.map.main.overviewMap&&(arcgisonline.map.main.overviewMap.destroy(),
arcgisonline.map.main.overviewMap=null)},recreateOverviewMap:function(){arcgisonline.map.main.destroyOverviewMap();arcgisonline.map.main.createOverviewMap()},createHomeButton:function(){arcgisonline.map.main.destroyHomeButton();var a=b.byId("map_zoom_slider"),c=b.create("div",{id:"homeButtonDiv"});b.place(c,a,1);arcgisonline.map.main.homeButton=new esri.dijit.HomeButton({map:arcgisonline.map.main.map,theme:"homeButton",extent:arcgisonline.map.main.map.extent},"homeButtonDiv");arcgisonline.map.main.homeButton.startup()},
destroyHomeButton:function(){arcgisonline.map.main.homeButton&&(arcgisonline.map.main.homeButton.destroy(),arcgisonline.map.main.homeButton=null,b.byId("homeButtonDiv")&&document.body.removeChild(b.byId("homeButtonDiv")))},recreateHomeButton:function(){arcgisonline.map.main.destroyHomeButton();arcgisonline.map.main.createHomeButton()},createLocateButton:function(){if(!isEmbedded||!isEmbedded.isItemDetail){arcgisonline.map.main.destroyLocateButton();var a=b.byId("map_zoom_slider"),c=b.create("div",
{id:"locateButtonDiv"});b.place(c,a,"after");arcgisonline.map.main.locateButton=new esri.dijit.LocateButton({map:arcgisonline.map.main.map,theme:"locateButton"},"locateButtonDiv");arcgisonline.map.main.locateButton.startup();arcgisonline.map.main.locateButton.on("locate",function(d){d.error?arcgisonline.sharing.dijit.dialog.GeneralDlg.prototype.statics.getInstance().show({title:esri.i18nBundle.generalDlg.errorDlgTitle,message:esri.i18nBundle.viewer.error.unableToLocate}):setTimeout(function(){arcgisonline.map.main.locateButton.clear()},
5E3)})}},destroyLocateButton:function(){arcgisonline.map.main.locateButton&&(arcgisonline.map.main.locateButton.destroy(),arcgisonline.map.main.locateButton=null,b.byId("locateButtonDiv")&&document.body.removeChild(b.byId("locateButtonDiv")))},recreateLocateButton:function(){arcgisonline.map.main.destroyLocateButton();arcgisonline.map.main.createLocateButton()},onMapLoad:function(){arcgisonline.map.main.map&&(b.publish("onMapLoad"),b.connect(r.byId("map"),"resize",b.hitch(arcgisonline.map.main,"resizeMap")),
setTimeout("arcgisonline.map.main.map.reposition()",1E3),arcgisonline.map.main.createOverviewMap(),arcgisonline.map.main.resizeNoDataDiv(),arcgisonline.map.fileImport.setupDragDrop(),esriGeowConfig.usageTrackingEnabled&&!arcgisonline.sharing.util.isPortal()&&(arcgisonline.map.main.onLayerAddCorsCheckHandler&&b.disconnect(arcgisonline.map.main.onLayerAddCorsCheckHandler),arcgisonline.map.main.onLayerAddCorsCheckHandler=b.connect(arcgisonline.map.main.map,"onLayerAdd",b.hitch(arcgisonline.map.main,
"corsCheck"))),arcgisonline.map.main.setupMapAlert(),arcgisonline.map.main.setupHandlerForCache(),esri.id.setProtocolErrorHandler(function(a){arcgisonline.map.main.reloadViewerSecureIdMgr(a);return!1}),arcgisonline.map.main.map.infoWindow.resize(300,250),arcgisonline.map.geocode.createWidget())},onDefaultServiceLoad:function(a){a=1E3;arcgisonline.map.save_open.openedWebMap&&(a=3E3);arcgisonline.map.main.mapFullyLoadedTimer=setTimeout("arcgisonline.map.main.mapFullyLoaded()",a)},mapFullyLoaded:function(){var a=
!0;for(e=0;e<arcgisonline.map.main.mapLayers.length;e++){var c=arcgisonline.map.main.mapLayers[e];c&&c.layer&&"esri.layers.KMLLayer"==c.layer.declaredClass?c.layer.loaded||(a=!1):c&&!c.layers&&null==arcgisonline.map.main.map.getLayer(c.id)?a=!1:c&&c.layers&&"mapNotes"==!c.type&&null==arcgisonline.map.main.map.getLayer(c.id+"_0")&&(a=!1)}if(a){clearTimeout(arcgisonline.map.main.mapFullyLoadedTimer);arcgisonline.map.main.cleanUpFailedServices();arcgisonline.map.main.onLayerAddHandler=b.connect(arcgisonline.map.main.map,
"onLayerAdd",b.hitch(arcgisonline.map.main,"onLayerAddedOrRemoved"));setTimeout(function(){arcgisonline.map.main.onLayerRemoveHandler=b.connect(arcgisonline.map.main.map,"onLayerRemove",b.hitch(arcgisonline.map.main,"onLayerAddedOrRemoved"));arcgisonline.map.main.onLayerReorderHandler=b.connect(arcgisonline.map.main.map,"onLayerReorder",b.hitch(arcgisonline.map.main,"onLayerReordered"))},5E3);b.connect(arcgisonline.map.main.map,"onBeforeUnload",function(){b.disconnect(arcgisonline.map.main.onLayerAddHandler);
b.disconnect(arcgisonline.map.main.onLayerRemoveHandler);b.disconnect(arcgisonline.map.main.onLayerReorderHandler)});b.publish("onLayerUpdate",[""]);arcgisonline.map.main.scalebar||(arcgisonline.map.main.scalebar=new esri.dijit.Scalebar({map:arcgisonline.map.main.map,scalebarUnit:arcgisonline.map.main.scaleBarUnits}));var d=arcgisonline.sharing.util.getUser();d&&arcgisonline.map.save_open.webMapInfo&&arcgisonline.map.save_open.webMapInfo.owner!==d.username&&"admin"!==arcgisonline.map.save_open.webMapInfo.itemControl&&
"update"!==arcgisonline.map.save_open.webMapInfo.itemControl?r.byId("webmap-save-save").set("disabled",!0):r.byId("webmap-save-save").set("disabled",!1);arcgisonline.map.main.createHomeButton();arcgisonline.map.main.createLocateButton();arcgisonline.map.time.checkTimeSliderProperties(!0);arcgisonline.map.main.isMapFullyLoaded=!0;arcgisonline.map.role.updateUserActionWithWebmap();arcgisonline.map.popup.addPopupLayers();a=(a=arcgisonline.sharing.util.urlToObject(document.URL).query)?a.timeExtent:null;
!a&&arcgisonline.map.save_open.openedWebMap&&(a=arcgisonline.map.save_open.openedWebMap.timeExtent);a?(a=a.split(","),2==a.length&&(c=new esri.TimeExtent,c.startTime=new Date(parseInt(a[0])),c.endTime=new Date(parseInt(a[1])),arcgisonline.map.main.map.setTimeExtent(c))):arcgisonline.map.time.checkOnTimeButton();arcgisonline.map.multiDimensions.checkOnMdSliderButton();arcgisonline.map.popup.setupPopupHandler();arcgisonline.map.main.initBookmarks();arcgisonline.map.main.updateHeaderPresentationLink();
for(var e=0;e<arcgisonline.map.main.mapLayers.length;e++)"base"==arcgisonline.map.main.mapLayers[e].type&&(arcgisonline.map.main.mapLayers[e].successfulDraw=!0);arcgisonline.map.leftPanel.mapLoadedSettings();var f=arcgisonline.sharing.util.urlToObject(document.URL);f.query=f.query||{};f.query.mapNotes&&arcgisonline.map.mapNotes.addMapNotesLayer();arcgisonline.map.main.checkLayerOrder();arcgisonline.map.main.refreshMapTables();arcgisonline.map.main.checkMinWidthOfPage();arcgisonline.map.main.checkTitleDiv();
arcgisonline.map.main.createUrlMarker();f.query.showPublish&&arcgisonline.map.main.linkToMap(!0);f.query.defExt&&arcgisonline.map.main.displayDefaultExtent();if(f.query.panel&&"gallery"===f.query.panel&&(f.query.layers||f.query.url)&&!f.query.webmap&&!f.query.review){arcgisonline.map.role.isAnonymous()&&arcgisonline.map.role.updateUserActionAfterModify();var h=f.query.layers&&f.query.layers.split(",")[0],l=f.query.url,g=null,m=setInterval(function(){for(var p=1;p<arcgisonline.map.main.mapLayers.length;p++){var q=
arcgisonline.map.main.mapLayers[p];if((h&&q.itemId===h||l&&q.layer.url===l)&&q.layer instanceof esri.layers.FeatureLayer)if(f.query.id&&q.layer.url&&-1<q.layer.url.indexOf("/"+f.query.id)){g=q;break}else if(!f.query.id){g=q;break}}g&&(p=arcgisonline.map.itemData.itemDataContents[g.itemId],q=g.origItemLayers,p&&p.layers&&!q||(clearInterval(m),arcgisonline.map.leftPanel.openLeftRendererPanel(g.id,-1,!0,!0,"true"===f.query.suggestField?!0:!1,f.query.showField,f.query.style)))},200)}if((d=arcgisonline.sharing.util.getUser())&&
f.query.review&&(f.query.layers||f.query.services)){h=(f.query.layers||f.query.services).split(",")[0];var n=0;m=setInterval(function(){b.forEach(arcgisonline.map.main.mapLayers,function(p){p.itemId===h&&"base"!=p.type&&p.itemCard&&p.url&&(p.itemCard.owner===d.username||"update"===p.itemCard.itemControl||"admin"===p.itemCard.itemControl)&&-1<b.indexOf(p.itemCard.typeKeywords,"Involved Lookup")&&(clearInterval(m),arcgisonline.map.leftPanel.openLeftGeocodePanel(null,{parameterList:p}))});20<n&&clearInterval(m);
n++},1E3)}b.publish("onMapFullyLoaded");f.query.find&&arcgisonline.map.geocode.doSearch(decodeURIComponent(f.query.find));arcgisonline.map.main.checkUnsupported4xFeatures();arcgisonline.map.main.checkAccessToViewer();l=arcgisonline.map.main.buildNewMapViewerUrl();b.byId("webmap-openNewViewer").href=l}else arcgisonline.map.main.mapFullyLoadedTimer=setTimeout("arcgisonline.map.main.mapFullyLoaded()",1E3)},buildNewMapViewerUrl:function(){var a=esriGeowConfig.newMapViewerUrl,c=arcgisonline.sharing.util.urlToObject(document.URL),
d="url urls webmap layers layerId basemapUrl basemapReferenceUrl center extent level find marker".split(" "),e=["Feature Service","Map Service","Image Service","KML","Vector Tile Service"];c.query=c.query||{};var f="?";for(key in c.query)if("layers"===key){var h=c.query[key].split(","),l=!1;b.forEach(h,function(g){var m=arcgisonline.map.save_open.itemCards[g];m&&-1<b.indexOf(e,m.type)&&(l?a+=","+g:(a+=f+"layers\x3d"+g,f="\x26",l=!0))})}else-1<b.indexOf(d,key)&&(a+=f+key+"\x3d"+c.query[key],f="\x26");
return a},openNewMapViewer:function(a){a&&a.preventDefault();a=arcgisonline.map.main.buildNewMapViewerUrl();1==arcgisonline.map.main.mapHasChanged?arcgisonline.sharing.dijit.dialog.OpenNewViewerDlg.prototype.statics.getInstance().show(a):arcgisonline.map.main.goToPage(a)},checkUnsupported4xFeatures:function(){-1<window.navigator.userAgent.indexOf("Trident/")||isEmbedded||!esriGeowConfig.newMapViewerEnabled||arcgisonline.map.utils.getUnsupported4xFeatures(arcgisonline.map.save_open.originalWebMap||
arcgisonline.map.save_open.openedWebMap,arcgisonline.map.save_open.webMapItemCard).then(function(a){if(a.anyUnsupportedFeatures){var c="";a.unsupportedWebmapFeatures&&a.unsupportedWebmapFeatures.length?c=esri.i18nBundle.viewer.error.openInNewMapViewerMsg1+" "+esri.i18nBundle.viewer.error.openInNewMapViewerMsg2:(b.forEach(a.layers,function(e){c+="\x3cli\x3e"+e.title+"\x3c/li\x3e"}),c=esri.i18nBundle.viewer.error.openInNewMapViewerMsg1ForLayers+"\x3c/br\x3e\x3cul\x3e"+c+"\x3c/ul\x3e"+esri.i18nBundle.viewer.error.openInNewMapViewerMsg2);
a="\x26nbsp;\x3ca class\x3d'esriHelpIcon esriFloatTrailing'title\x3d'"+esri.i18nBundle.common.help+"' href\x3d'"+(esriGeowConfig.helpBase+esriGeowConfig.helpMap["120002712"])+"' target\x3d'_blank' /\x3e";var d=arcgisonline.sharing.dijit.dialog.ChoiceDlg.prototype.statics.getInstance();d.show({title:esri.i18nBundle.viewer.error.openInNewMapViewerTitle+a,message:c,choiceOneTitle:esri.i18nBundle.viewer.error.openInNewMapViewerYes,choiceOneHandler:b.hitch(this,function(){var e=esriGeowConfig.newMapViewerUrl+
document.location.href.substring(document.location.href.indexOf("?"));window.open(e,"_blank")}),choiceTwoTitle:esri.i18nBundle.viewer.main.notRightNow,choiceTwoHandler:function(){}});b.style(d._dialog.domNode,"width","600px")}})},checkUnsupported4xItem:function(a,c){if(!(-1<window.navigator.userAgent.indexOf("Trident/"))&&esriGeowConfig.newMapViewerEnabled&&-1<a.typeKeywords.indexOf("ArcGIS API for JavaScript"))if(isEmbedded){var d="update"===a.itemControl||"admin"===a.itemControl,e=arcgisonline.sharing.dijit.dialog.GeneralDlg.prototype.statics.getInstance();
d=d?esri.i18nBundle.viewer.error.openInNewMapViewerLayerOwner:esri.i18nBundle.viewer.error.openInNewMapViewerLayerNotOwner;e.setButtonLabel(esri.i18nBundle.viewer.error.openInNewMapViewerYes);e.show({title:esri.i18nBundle.viewer.error.openInNewMapViewerTitle,message:d});b.aspect.after(e,"onOkClick",b.hitch(this,function(){var h=arcgisonline.sharing.util.urlToObject(document.URL);window.open(esriGeowConfig.newMapViewerUrl+"?layers\x3d"+h.query.layers+"\x26layerId\x3d"+h.query.layerId,"_blank")}))}else{d=
esri.i18nBundle.viewer.error.openInNewMapViewerLayerMsg1.replace("${title}",a.title)+"\x3cbr/\x3e\x3cbr/\x3e"+esri.i18nBundle.viewer.error.openInNewMapViewerLayerMsg2;var f="\x26nbsp;\x3ca class\x3d'esriHelpIcon esriFloatTrailing'title\x3d'"+esri.i18nBundle.common.help+"' href\x3d'"+(esriGeowConfig.helpBase+esriGeowConfig.helpMap["120002712"])+"' target\x3d'_blank' /\x3e";e=arcgisonline.sharing.dijit.dialog.ChoiceDlg.prototype.statics.getInstance();e.show({title:esri.i18nBundle.viewer.error.openInNewMapViewerTitle+
f,message:d,choiceOneTitle:esri.i18nBundle.viewer.error.openInNewMapViewerYes,choiceOneHandler:b.hitch(this,function(){var h=arcgisonline.sharing.util.urlToObject(document.URL),l=esriGeowConfig.newMapViewerUrl;l="itemBrowser"===c?l+("?layers\x3d"+a.id):"layers"===c?l+("?layers\x3d"+h.query.layers):l+("?webmap\x3d"+h.query.webmap);window.open(l,"_blank")}),choiceTwoTitle:esri.i18nBundle.viewer.main.notRightNow,choiceTwoHandler:function(){}});b.style(e._dialog.domNode,"width","600px")}},checkLayerOrder:function(){if(arcgisonline.map.save_open.basemapWebMap){var a=
arcgisonline.map.save_open.basemapWebMap;a.operationalLayers=[]}else arcgisonline.map.save_open.openedWebMap?a=arcgisonline.map.save_open.openedWebMap:(a=esriGeowConfig.self.defaultBasemap,a.operationalLayers=[]);var c=b.indexOf(arcgisonline.map.main.map.graphicsLayerIds,"LabelLayer");-1<c&&arcgisonline.map.main.map.reorderLayer("LabelLayer",arcgisonline.map.main.map.graphicsLayerIds.length);var d=[];b.forEach(a.baseMapLayers||a.baseMap.baseMapLayers,function(t){d.push(t.id)});b.forEach(a.operationalLayers,
function(t){d.push(t.id)});var e=[];b.forEach(arcgisonline.map.main.mapLayers,function(t){e.push(t.id)});for(var f=!1,h=1;h<arcgisonline.map.main.mapLayers.length-1;){var l=arcgisonline.map.main.mapLayers[h],g=arcgisonline.map.main.mapLayers[h+1],m=b.indexOf(d,l.id),n=b.indexOf(d,g.id);if(-1!==m&&-1!==n)if("user"!=l.type&&"mapNotes"!=l.type||"user"!=g.type&&"mapNotes"!=g.type||!(l.layers||l.layer instanceof esri.layers.FeatureLayer||l.layer instanceof esri.layers.GeoRSSLayer)||!(g.layers||g.layer instanceof
esri.layers.FeatureLayer||g.layer instanceof esri.layers.GeoRSSLayer))if("user"===l.type&&"base"===g.type||"labels"===l.type&&"labels"!==g.type)p=1,arcgisonline.map.main.mapLayers[h+1]=l,arcgisonline.map.main.mapLayers[h]=g,c=b.indexOf(arcgisonline.map.main.map.layerIds,l.id),f=b.indexOf(arcgisonline.map.main.map.layerIds,g.id),-1<c&&-1<f&&c<f&&arcgisonline.map.main.map.reorderLayer(l.id,c+p),e=[],b.forEach(arcgisonline.map.main.mapLayers,function(t){e.push(t.id)}),h=0,f=!0;else if("base"===l.type&&
"base"===g.type||"labels"===l.type&&"labels"===g.type){var q=[];b.forEach(a.baseMapLayers||a.baseMap.baseMapLayers,function(t){("base"===l.type&&!t.isReference||"labels"===l.type&&t.isReference)&&q.push(t.id)});m=b.indexOf(q,l.id);n=b.indexOf(q,g.id);m>n&&(p=1,arcgisonline.map.main.mapLayers[h+1]=l,arcgisonline.map.main.mapLayers[h]=g,c=b.indexOf(arcgisonline.map.main.map.layerIds,l.id),f=b.indexOf(arcgisonline.map.main.map.layerIds,g.id),-1<c&&-1<f&&c<f&&arcgisonline.map.main.map.reorderLayer(l.id,
c+p),e=[],b.forEach(arcgisonline.map.main.mapLayers,function(t){e.push(t.id)}),h=0,f=!0)}else"user"==l.type&&"user"==g.type&&-1<b.indexOf(arcgisonline.map.main.map.layerIds,l.id)&&-1<b.indexOf(arcgisonline.map.main.map.layerIds,g.id)?(m=b.indexOf(d,l.id),n=b.indexOf(d,g.id),m>n?(arcgisonline.map.main.mapLayers[h+1]=l,arcgisonline.map.main.mapLayers[h]=g,c=b.indexOf(arcgisonline.map.main.map.layerIds,l.id),f=b.indexOf(arcgisonline.map.main.map.layerIds,g.id),-1<c&&-1<f&&c<f&&arcgisonline.map.main.map.reorderLayer(l.id,
c+1),e=[],b.forEach(arcgisonline.map.main.mapLayers,function(t){e.push(t.id)}),h=0,f=!0):(m=b.indexOf(arcgisonline.map.main.map.layerIds,l.id),n=b.indexOf(arcgisonline.map.main.map.layerIds,g.id),m>n&&arcgisonline.map.main.map.reorderLayer(g.id,m+1))):"user"==l.type&&"user"==g.type&&-1<b.indexOf(arcgisonline.map.main.map.layerIds,l.id)&&(g.layers||g.layer instanceof esri.layers.FeatureLayer||g.layer instanceof esri.layers.GeoRSSLayer)||("user"==l.type&&"user"==g.type&&(l.layers||l.layer instanceof
esri.layers.FeatureLayer||l.layer instanceof esri.layers.GeoRSSLayer)&&-1<b.indexOf(arcgisonline.map.main.map.layerIds,g.id)?(p=1,arcgisonline.map.main.mapLayers[h+1]=l,arcgisonline.map.main.mapLayers[h]=g,l.layers?(c=b.indexOf(arcgisonline.map.main.map.graphicsLayerIds,l.layers[l.layers.length-1].id),-1<c&&b.forEach(l.layers,function(t,v){arcgisonline.map.main.map.reorderLayer(t.id,c+p)},this)):l.layer instanceof esri.layers.GeoRSSLayer?(f=l.layer.getFeatureLayers(),f.length&&(c=b.indexOf(arcgisonline.map.main.map.graphicsLayerIds,
f[f.length-1].id),-1<c&&b.forEach(f,function(t,v){arcgisonline.map.main.map.reorderLayer(t.id,c+p)},this))):(c=b.indexOf(arcgisonline.map.main.map.graphicsLayerIds,l.id),f=b.indexOf(arcgisonline.map.main.map.graphicsLayerIds,g.id),-1<c&&-1<f&&c<f&&arcgisonline.map.main.map.reorderLayer(l.id,c+p)),e=[],b.forEach(arcgisonline.map.main.mapLayers,function(t){e.push(t.id)}),h=0,f=!0):"labels"==g.type&&(n=b.indexOf(arcgisonline.map.main.map.layerIds,g.id),-1<n&&n<arcgisonline.map.main.map.layerIds.length-
1&&arcgisonline.map.main.map.reorderLayer(g.id,arcgisonline.map.main.map.layerIds.length-1)));else if(m=b.indexOf(d,l.id),n=b.indexOf(d,g.id),m>n){var p=1;g.layers?p=g.layers.length:g.layer instanceof esri.layers.GeoRSSLayer&&(p=g.layer.getFeatureLayers().length);arcgisonline.map.main.mapLayers[h+1]=l;arcgisonline.map.main.mapLayers[h]=g;l.layers?(c=b.indexOf(arcgisonline.map.main.map.graphicsLayerIds,l.layers[l.layers.length-1].id),-1<c&&b.forEach(l.layers,function(t,v){arcgisonline.map.main.map.reorderLayer(t.id,
c+p)},this)):l.layer instanceof esri.layers.GeoRSSLayer?(f=l.layer.getFeatureLayers(),c=b.indexOf(arcgisonline.map.main.map.graphicsLayerIds,f[f.length-1].id),-1<c&&b.forEach(f,function(t,v){arcgisonline.map.main.map.reorderLayer(t.id,c+p)},this)):(c=b.indexOf(arcgisonline.map.main.map.graphicsLayerIds,l.id),f=b.indexOf(arcgisonline.map.main.map.graphicsLayerIds,g.id),-1<c&&-1<f&&c<f&&arcgisonline.map.main.map.reorderLayer(l.id,c+p));e=[];b.forEach(arcgisonline.map.main.mapLayers,function(t){e.push(t.id)});
h=0;f=!0}h++}for(h=a=0;h<arcgisonline.map.main.mapLayers.length;h++)if(g=arcgisonline.map.main.mapLayers[h],("user"==g.type||"mapNotes"==g.type)&&(g.layers||g.layer instanceof esri.layers.FeatureLayer||g.layer instanceof esri.layers.GraphicsLayer||g.layer instanceof esri.layers.GeoRSSLayer))if(g.layers||g.layer instanceof esri.layers.GeoRSSLayer)for(g=g.layers?g.layers:g.layer.getFeatureLayers(),m=0;m<g.length;m++)n=g[m].id,-1<b.indexOf(arcgisonline.map.main.map.graphicsLayerIds,n)&&arcgisonline.map.main.map.reorderLayer(n,
a++);else n=g.id,-1<b.indexOf(arcgisonline.map.main.map.graphicsLayerIds,n)&&arcgisonline.map.main.map.reorderLayer(n,a++);for(h=a=0;h<arcgisonline.map.main.mapLayers.length;h++)g=arcgisonline.map.main.mapLayers[h],g.layer&&-1<b.indexOf(arcgisonline.map.main.map.layerIds,g.layer.id)&&arcgisonline.map.main.map.reorderLayer(g.layer.id,a++);f&&leftPanel&&leftPanel.reloadVisibleTOC();arcgisonline.map.labels.orderLayers()},onDblClick:function(a){if(!arcgisonline.map.edit.editActivated&&!arcgisonline.map.main.measureActivated&&
!arcgisonline.map.edit.analysisDrawActivated){var c=.5;null!=arcgisonline.map.main.mapLods&&(c=arcgisonline.map.main.map.getLevel()+1);arcgisonline.map.main.map.centerAndZoom(new esri.geometry.Point(a.mapPoint.x,a.mapPoint.y,arcgisonline.map.main.map.extent.spatialReference),c)}},onExtentChange:function(a,c,d,e){if(arcgisonline.map.main.startup){if(arcgisonline.map.main.map.getLayer(arcgisonline.map.main.currentBaseService)){null!=arcgisonline.map.main.defaultService.layer&&1==arcgisonline.map.main.defaultService.defaultVisibility&&
arcgisonline.map.main.map.getLayer(arcgisonline.map.main.currentBaseService).show();for(c=0;c<arcgisonline.map.main.mapLayers.length;c++)(d=arcgisonline.map.main.mapLayers[c])&&("user"==d.type||"labels"==d.type)&&d.defaultVisibility&&arcgisonline.map.main.showLayerOnceLoaded(d.id,0);arcgisonline.map.main.startup=!1}}else!arcgisonline.map.main.isUserBaseService&&e&&(arcgisonline.map.main.hideNoDataDisplay(),arcgisonline.map.main.displayNoData(e.level)),arcgisonline.map.main.lastExtent&&(c=arcgisonline.map.main.lastExtent.getWidth()*
arcgisonline.map.main.lastExtent.getHeight(),d=a.getWidth()*a.getHeight(),1.3<Math.max(c,d)/Math.min(c,d)&&arcgisonline.map.main.markMapAsChangedIfOwner("onExtentChange")),isEmbedded&&arcgisonline.map.main.markMapAsChangedIfOwner("onExtentChange"),c=Math.round(arcgisonline.map.main.map.getScale()),c=b.number.format(c,{pattern:"#,###,###,##0"}),b.byId("layerMenu.scaleCurrent")&&(b.byId("layerMenu.scaleCurrent").innerHTML=b.string.substitute(esri.i18nBundle.tocPanel.mapScale,{scale:c})),b.byId("subLayerMenu.scaleCurrent")&&
(b.byId("subLayerMenu.scaleCurrent").innerHTML=b.string.substitute(esri.i18nBundle.tocPanel.mapScale,{scale:c}));arcgisonline.map.dijit.toc.scale.checkLayersInMapScale();arcgisonline.map.main.lastExtent=b.clone(a)},showLayerOnceLoaded:function(a,c){for(var d=0;d<arcgisonline.map.main.mapLayers.length;d++){var e=arcgisonline.map.main.mapLayers[d];if(e.id==a){null==e.layer&&50>c?setTimeout(function(){arcgisonline.map.main.showLayerOnceLoaded(a,c+1)},100):null!=e.layer&&1==e.defaultVisibility&&e.layer.show();
break}}},onLayerAddResult:function(a,c){if(c&&c.message&&-1<c.message.indexOf("Too many WebGL contexts.")){var d=arcgisonline.map.main.getItemWithId(arcgisonline.map.main.mapLayers,a.id);arcgisonline.map.layer.removeLayer(d);b.publish("layerAddFailed",[d.itemId?{itemId:d.itemId,id:d.id}:d.id]);c=arcgisonline.sharing.dijit.dialog.GeneralDlg.prototype.statics.getInstance();a=b.string.substitute(esri.i18nBundle.viewer.error.layerNotAddedOutOfWebGL,{layer:d&&d.title||a.url});c.show({title:esri.i18nBundle.generalDlg.errorDlgTitle,
message:a})}},onLayerAddedOrRemoved:function(a){"esri.layers.GraphicsLayer"===a.declaredClass||a.__tempTableLayer||null==arcgisonline.map.main.mapLayers[0]||null==arcgisonline.map.main.mapLayers[0].layer||"base"!=arcgisonline.map.main.mapLayers[0].type||(a.timeInfo&&a.useMapTime&&(arcgisonline.map.time.timeSliderProperties=null),arcgisonline.map.edit.checkOnEditButton(),arcgisonline.map.time.checkOnTimeButton(),arcgisonline.map.dijit.toc.analysis.checkOnAnalysisButton(),arcgisonline.map.multiDimensions.checkOnMdSliderButton(),
null!=arcgisonline.map.save_open.webMapInfo&&(arcgisonline.map.save_open.webMapInfo.deleteExplorerSlides=!0),b.publish("onLayerUpdate",["reopen"]),leftPanel&&leftPanel.checkLegendStack(),arcgisonline.map.main.isMapFullyLoaded&&"editStack"===arcgisonline.map.leftPanel.getLeftContentPanelStack()&&a instanceof esri.layers.FeatureLayer&&a.isEditable()&&setTimeout(function(){r.byId("editPanel").recreateEditor()},0))},onLayerReordered:function(a){"esri.layers.GraphicsLayer"===a.declaredClass||"esri.layers.FeatureLayer"===
a.declaredClass&&a.mode===esri.layers.FeatureLayer.MODE_SELECTION||(null!=arcgisonline.map.save_open.webMapInfo&&(arcgisonline.map.save_open.webMapInfo.deleteExplorerSlides=!0),leftPanel&&leftPanel.checkLegendStack())},resizeMap:function(){if(arcgisonline.map.main.map&&arcgisonline.map.main.map.extent&&arcgisonline.map.main.map.extent.xmin){try{arcgisonline.map.main.map.resize()}catch(a){}arcgisonline.map.main.map.reposition();arcgisonline.map.main.resizeNoDataDiv()}arcgisonline.map.table.featureTable&&
b.isIE&&arcgisonline.map.table.featureTable.resize()},onLayerVisibilityChange:function(){arcgisonline.map.edit.checkOnEditButton();arcgisonline.map.time.checkOnTimeButton();arcgisonline.map.multiDimensions.checkOnMdSliderButton();arcgisonline.map.main.checkMapAlert();arcgisonline.map.main.markMapAsChangedIfOwner("onLayerVisibilityChange");leftPanel&&leftPanel.checkLegendStack()},onPanStart:function(){arcgisonline.map.edit.editActivated||(9>b.isIE?arcgisonline.map.main.map.setMapCursor("url(images/close_hand_cursor.cur),auto"):
arcgisonline.map.main.map.setMapCursor("url(images/close_hand_cursor.png),auto"))},onPanEnd:function(){arcgisonline.map.edit.editActivated||arcgisonline.map.main.setHandCursor()},onZoomEnd:function(){},onRendererUpdate:function(){leftPanel&&(leftPanel.deleteLegendStack(),"contentStack"==arcgisonline.map.leftPanel.getLeftContentPanelStack()?b.publish("onLayerUpdate",["reopen"]):leftPanel.deleteContentStack());arcgisonline.map.main.markMapAsChanged("onRendererUpdate")},setHandCursor:function(){null!=
arcgisonline.map.main.map&&arcgisonline.map.main.map.setMapCursor("default")},displayNoData:function(a){arcgisonline.map.main.noDataDisplayTimer=setTimeout("arcgisonline.map.main.displayNoDataDelay("+a+")",2500)},displayNoDataDelay:function(a){clearTimeout(arcgisonline.map.main.noDataDisplayTimer);if(null!=arcgisonline.map.main.mapLods){a=arcgisonline.map.main.mapLods[a].resolution;var c=arcgisonline.map.main.map.getLayer(arcgisonline.map.main.currentBaseService);if(c.tileInfo){c=c.tileInfo.lods;
var d=c[0].resolution;if(a<c[c.length-1].resolution||a>d)b.style(b.byId("noData1"),"display","block"),b.style(b.byId("noData2"),"display","block"),b.style(b.byId("noData3"),"display","block"),b.style(b.byId("noData4"),"display","block")}}},hideNoDataDisplay:function(){b.style(b.byId("noData1"),"display","none");b.style(b.byId("noData2"),"display","none");b.style(b.byId("noData3"),"display","none");b.style(b.byId("noData4"),"display","none")},resizeNoDataDiv:function(){arcgisonline.map.main.hideNoDataDisplay();
b.style(b.byId("noDataDiv"),"width",""+b.style(b.byId("mapDiv"),"width")+"px");b.style(b.byId("noDataDiv"),"height",""+b.style(b.byId("mapDiv"),"height")+"px");b.style(b.byId("noDataDiv"),"left",""+b.style(b.byId("mapDiv"),"left")+"px");b.style(b.byId("noDataDiv"),"top",""+b.style(b.byId("mapDiv"),"top")+"px");var a=arcgisonline.map.main.map.height/4-25;b.style(b.byId("noData1"),"margin",""+a+"px 0 "+a+"px 0");b.style(b.byId("noData2"),"margin",""+a+"px 0 "+a+"px 0");b.style(b.byId("noData3"),"margin",
""+a+"px 0 "+a+"px 0");b.style(b.byId("noData4"),"margin",""+a+"px 0 "+a+"px 0")},setDefaultTitle:function(){arcgisonline.map.main.setTitle(esri.i18nBundle.viewer.defaultMapTitle)},setTitle:function(a){b.byId("webmap-title-text").innerHTML=a;arcgisonline.map.main.checkTitleDiv();b.doc.title=esriGeowConfig.urlKey?a:(esriGeowConfig.portalName?esriGeowConfig.portalName:"ArcGIS")+" - "+a},checkTitleDiv:function(){if(arcgisonline.map.main.isMapFullyLoaded){var a=b.coords(b.byId("webmap-header")).w,c=b.coords(b.byId("home-navigation-dropdown")).w,
d=b.coords(b.byId("header-controls")).w;d=a-c-d-45;0>d&&(b.style(b.byId("header-controls"),"width","300px"),d=a-c-300-30);b.style(b.byId("webmap-title-text"),"visibility","visible");if(arcgisonline.map.save_open.webMapInfo&&(a=arcgisonline.sharing.util.getUser())&&(arcgisonline.map.save_open.webMapInfo.owner===a.username||"admin"===arcgisonline.map.save_open.webMapInfo.itemControl||"update"===arcgisonline.map.save_open.webMapInfo.itemControl)){a=b.coords(b.byId("webmap-title-edit-save")).w;var e=
b.coords(b.byId("webmap-title-edit-cancel")).w;0<a||0<e?b.style("webmap-title-edit-input","width",d-a-e-10+"px"):b.style("webmap-title-edit-input","width",d-10*esri.i18nBundle.common.save.length-10*esri.i18nBundle.common.cancel.length-50+"px");b.style(b.byId("webmap-title-edit"),"visibility","visible");arcgisonline.map.main.titleEditHandler||(arcgisonline.map.main.titleEditHandler=b.query("#webmap-title-edit").onclick(b.hitch(arcgisonline.map.main,"editTitle")),b.query("#webmap-title-edit-save").onclick(b.hitch(arcgisonline.map.main,
"saveTitle")),b.query("#webmap-title-edit-cancel").onclick(b.hitch(arcgisonline.map.main,"cancelTitle")))}b.style(b.byId("webmap-title"),"width",d+"px");b.style(b.byId("webmap-title-tableDiv"),"width",d+"px");b.style(b.byId("webmap-title-table"),"width",d+"px");b.byId("webmap-title-sizing").innerHTML=esri.i18nBundle.common.edit;a=b.coords(b.byId("webmap-title-edit")).w;d=d-a-10;b.byId("webmap-title-sizing").innerHTML=b.byId("webmap-title-text").innerHTML;a=b.coords(b.byId("webmap-title-sizing")).w+
10;b.style(b.byId("webmap-title-text"),"width",(d>a?a:d)+"px");esriGeowConfig.isRightToLeft?b.style(b.byId("webmap-title"),"paddingRight",c+18+"px"):b.style(b.byId("webmap-title"),"paddingLeft",c+18+"px")}},editTitle:function(){b.style(b.byId("webmap-title-text"),"display","none");b.style(b.byId("webmap-title-edit"),"display","none");b.style(b.byId("webmap-title-edit-inputGrp"),"display","");arcgisonline.map.main.checkTitleDiv();b.byId("webmap-title-edit-input").value=arcgisonline.map.save_open.webMapInfo?
arcgisonline.map.save_open.webMapInfo.title:esri.i18nBundle.viewer.defaultMapTitle},saveTitle:function(){var a=b.byId("webmap-title-edit-input").value;if(a&&a.length)if(-1<a.indexOf("\x3c")||-1<a.indexOf("\x3e"))b.byId("webmap-title-edit-input").value=arcgisonline.map.save_open.webMapInfo.title,d=arcgisonline.sharing.dijit.dialog.GeneralDlg.prototype.statics.getInstance(),d.show({title:esri.i18nBundle.generalDlg.errorDlgTitle,message:esri.i18nBundle.saveWebMapDlg.error.specialCharaters});else{250<
a.length&&(a=a.substring(0,250));d={title:a};var c=esriGeowConfig.restBaseUrl+"content/users/"+arcgisonline.map.save_open.webMapInfo.owner;c+=arcgisonline.map.save_open.webMapInfo.ownerFolder?"/"+arcgisonline.map.save_open.webMapInfo.ownerFolder:"";c+="/items/"+arcgisonline.map.save_open.webMapInfo.id+"/update";arcgisonline.sharing.util.postJson(d,c).then(function(e){arcgisonline.map.save_open.webMapInfo.title=a;arcgisonline.map.main.setTitle(a);b.style(b.byId("webmap-title-text"),"display","");b.style(b.byId("webmap-title-edit"),
"display","");b.style(b.byId("webmap-title-edit-inputGrp"),"display","none")},function(e){b.style(b.byId("webmap-title-text"),"display","");b.style(b.byId("webmap-title-edit"),"display","");b.style(b.byId("webmap-title-edit-inputGrp"),"display","none");arcgisonline.sharing.dijit.dialog.GeneralDlg.prototype.statics.getInstance().show({title:esri.i18nBundle.generalDlg.errorDlgTitle,message:b.string.substitute(esri.i18nBundle.viewer.save_open.mapNotSaved,{title:a})})})}else{b.byId("webmap-title-edit-input").value=
arcgisonline.map.save_open.webMapInfo.title;var d=arcgisonline.sharing.dijit.dialog.GeneralDlg.prototype.statics.getInstance();d.show({title:esri.i18nBundle.generalDlg.errorDlgTitle,message:esri.i18nBundle.saveWebMapDlg.error.provideTitle})}},cancelTitle:function(){b.style(b.byId("webmap-title-text"),"display","");b.style(b.byId("webmap-title-edit"),"display","");b.style(b.byId("webmap-title-edit-inputGrp"),"display","none")},setMapExtent:function(a){null==a&&(a=arcgisonline.map.main.defaultExtent);
arcgisonline.map.main.initialExtent=new esri.geometry.Extent(a.xmin,a.ymin,a.xmax,a.ymax,a.spatialReference);var c=arcgisonline.map.main.map.spatialReference;null==c&&(c=arcgisonline.map.main.defaultExtent.spatialReference);var d=arcgisonline.sharing.util.urlToObject(document.URL);d.query=d.query||{};if(d.query.extent)if(a=decodeURIComponent(d.query.extent).split(";"),1===a.length&&(a=decodeURIComponent(d.query.extent).split(",")),4==a.length||5==a.length){var e=b.number.parse(a[0]),f=b.number.parse(a[1]),
h=b.number.parse(a[2]),l=b.number.parse(a[3]);if(isNaN(e)||isNaN(e)||isNaN(e)||isNaN(e))e=parseFloat(a[0]),f=parseFloat(a[1]),h=parseFloat(a[2]),l=parseFloat(a[3]);if(isNaN(e)||isNaN(f)||isNaN(h)||isNaN(l))arcgisonline.map.main.map.setExtent(arcgisonline.map.main.defaultExtent,!1);else{var g=4326;5!=a.length||isNaN(a[4])||(g=parseInt(a[4]));f=new esri.geometry.Extent(e,f,h,l,new esri.SpatialReference({wkid:g}));arcgisonline.map.main.sameSpatialReference(c,new esri.SpatialReference({wkid:g}))?(arcgisonline.map.main.initialExtent=
f,arcgisonline.map.main.map.setExtent(f,!1)):(a=function(q,t){arcgisonline.map.main.initialExtent=q[0];arcgisonline.map.main.map.setExtent(q[0],!1)},e=function(q,t){arcgisonline.map.main.map.setExtent(arcgisonline.map.main.defaultExtent,!1)},arcgisonline.map.main.projectToMapSpatialReference(f,b.hitch(this,a),b.hitch(this,e)))}}else arcgisonline.map.main.map.setExtent(arcgisonline.map.main.defaultExtent,!1);else if(d.query.center){if(a=decodeURIComponent(d.query.center).split(";"),1===a.length&&(a=
decodeURIComponent(d.query.center).split(",")),2==a.length||3==a.length){f=b.number.parse(a[0]);h=b.number.parse(a[1]);if(isNaN(f)||isNaN(h))f=parseFloat(a[0]),h=parseFloat(a[1]);if(!isNaN(f)&&!isNaN(h)){g=4326;3!=a.length||isNaN(a[2])||(g=parseInt(a[2]));var m=function(q,t){var v=0,u=0;null!=arcgisonline.map.main.mapLods&&d.query.level?(u=parseInt(d.query.level),v=arcgisonline.map.main.mapLods[u].resolution*arcgisonline.map.main.map.width/2,u=arcgisonline.map.main.mapLods[u].resolution*arcgisonline.map.main.map.height/
2):d.query.resolution?(u=parseFloat(d.query.resolution),v=u*arcgisonline.map.main.map.width/2,u=u*arcgisonline.map.main.map.height/2):(v=arcgisonline.map.main.defaultExtent.getWidth()/2,u=arcgisonline.map.main.defaultExtent.getHeight()/2);q=new esri.geometry.Extent(q-v,t-u,q+v,t+u,c);arcgisonline.map.main.initialExtent=q;arcgisonline.map.main.map.setExtent(q)};arcgisonline.map.main.sameSpatialReference(c,new esri.SpatialReference({wkid:g}))?m(f,h):(a=function(q,t){m(q[0].x,q[0].y)},e=function(q,t){arcgisonline.map.main.map.setExtent(arcgisonline.map.main.defaultExtent,
!1)},arcgisonline.map.main.projectPointToMapSpatialReference(f,h,new esri.SpatialReference({wkid:g}),b.hitch(this,a),b.hitch(this,e)))}}}else if(arcgisonline.map.save_open.openedWebMap&&arcgisonline.map.save_open.openedWebMap.initialState&&arcgisonline.map.save_open.openedWebMap.initialState.viewpoint&&arcgisonline.map.save_open.openedWebMap.initialState.viewpoint.targetGeometry&&arcgisonline.map.save_open.openedWebMap.initialState.viewpoint.scale){f=new esri.geometry.Extent(arcgisonline.map.save_open.openedWebMap.initialState.viewpoint.targetGeometry);
var n=f.getCenter(),p=arcgisonline.map.save_open.openedWebMap.initialState.viewpoint.scale;f=n.x;h=n.y;m=function(q,t){q=arcgisonline.map.main.getExtentFromCenter(n,arcgisonline.map.main.map.width,p);arcgisonline.map.main.initialExtent=q;arcgisonline.map.main.map.setExtent(q)};arcgisonline.map.main.sameSpatialReference(c,n.spatialReference)?m(f,h):(a=function(q,t){m(q[0].x,q[0].y)},e=function(q,t){arcgisonline.map.main.map.setExtent(arcgisonline.map.main.defaultExtent,!1)},arcgisonline.map.main.projectPointToMapSpatialReference(f,
h,new esri.SpatialReference({wkid:g}),b.hitch(this,a),b.hitch(this,e)))}else arcgisonline.map.save_open.openedWebMap&&arcgisonline.map.save_open.openedWebMap.initialState&&arcgisonline.map.save_open.openedWebMap.initialState.viewpoint&&arcgisonline.map.save_open.openedWebMap.initialState.viewpoint.targetGeometry?(f=new esri.geometry.Extent(arcgisonline.map.save_open.openedWebMap.initialState.viewpoint.targetGeometry),arcgisonline.map.main.sameSpatialReference(c,f.spatialReference)?(arcgisonline.map.main.initialExtent=
f,arcgisonline.map.main.map.setExtent(f,!1)):(a=function(q,t){arcgisonline.map.main.initialExtent=q[0];arcgisonline.map.main.map.setExtent(q[0],!1)},e=function(q,t){arcgisonline.map.main.map.setExtent(arcgisonline.map.main.defaultExtent,!1)},arcgisonline.map.main.projectToMapSpatialReference(f,b.hitch(this,a),b.hitch(this,e)))):(arcgisonline.map.main.map.spatialReference||(g=new esri.SpatialReference(a.spatialReference.toJson()),arcgisonline.map.main.map.spatialReference=g),arcgisonline.map.main.map.setExtent(a,
!1))},createUrlMarker:function(){var a=arcgisonline.sharing.util.urlToObject(document.URL);a.query=a.query||{};if(a.query.marker){var c=decodeURIComponent(a.query.marker).split(";");1===c.length&&(c=decodeURIComponent(a.query.marker).split(","));var d={TITLE:"",DESCRIPTION:"",IMAGE_URL:null,IMAGE_LINK_URL:null},e={VISIBLE:1,TYPEID:0,OBJECTID:0};if(2<=c.length&&6>=c.length&&!isNaN(c[0])&&!isNaN(c[1])){var f=parseFloat(c[0]),h=parseFloat(c[1]),l=4326;3<=c.length&&c[2].length&&!isNaN(c[2])&&(l=parseInt(c[2]));
var g="";4<=c.length&&(g=c[3],d.TITLE=g);var m=null;5<=c.length&&0===c[4].indexOf("http")&&(m=c[4]);g=null;6===c.length&&(g=c[5]);var n=function(q,t){var v=0,u=0;null!=arcgisonline.map.main.mapLods&&a.query.level?(u=parseInt(a.query.level),v=arcgisonline.map.main.mapLods[u].resolution*arcgisonline.map.main.map.width/2,u=arcgisonline.map.main.mapLods[u].resolution*arcgisonline.map.main.map.height/2):a.query.resolution?(u=parseFloat(a.query.resolution),v=u*arcgisonline.map.main.map.width/2,u=u*arcgisonline.map.main.map.height/
2):(v=arcgisonline.map.main.defaultExtent.getWidth()/2,u=arcgisonline.map.main.defaultExtent.getHeight()/2);q=new esri.geometry.Extent(q-v,t-u,q+v,t+u,arcgisonline.map.main.map.spatialReference);arcgisonline.map.main.initialExtent=q;arcgisonline.map.main.map.setExtent(q)};c=new esri.geometry.Point(f,h,new esri.SpatialReference({wkid:l}));m=esri.symbol.fromJson({type:"esriPMS",url:m,contentType:"image/png"});var p=null;g&&(p=esri.symbol.fromJson({color:[0,0,0,255],type:"esriTS",verticalAlignment:"baseline",
horizontalAlignment:"left",angle:0,xoffset:0,yoffset:0,rotated:!1,kerning:!0,font:{size:12,style:"normal",weight:"bold",family:"Arial"},text:g}));arcgisonline.sharing.util.getJson(esriGeowConfig.restBaseUrl+"community/groups?q\x3d"+esriGeowConfig.layerTemplatesGroupQuery).then(b.hitch(this,function(q,t,v,u,B,N){arcgisonline.sharing.util.getJson(esriGeowConfig.restBaseUrl+"search?num\x3d50\x26q\x3dgroup:"+N.results[0].id+' AND type:"Feature Collection Template"').then(b.hitch(this,function(O,P,Q,R,
S,D){if(D.results&&0!==D.results.length){D.results.sort(function(w,E){return w.name==E.name?0:w.name<E.name?-1:1});arcgisonline.map.mapNotes.getMapNotesConfig(D.results[0].id,esri.i18nBundle.mapNotesDlg.mapNotes,!0);var W=b.connect(arcgisonline.map.main.map,"onLayersAddResult",b.hitch(this,function(w,E,T,U,V,L){for(var I=0;I<L.length;I++){var A=arcgisonline.map.main.getParameterList(L[I].layer);if(A.title===esri.i18nBundle.mapNotesDlg.mapNotes){b.disconnect(W);arcgisonline.map.main.projectPointToMapSpatialReference(w.x,
w.y,new esri.SpatialReference({wkid:w.spatialReference.wkid}),b.hitch(this,function(y,x,J,K,C){w=new esri.geometry.Point(C[0].x,C[0].y,C[0].spatialReference);y.url?arcgisonline.map.main.getPictureMarkerSize(y.url).then(function(F){y.width=F[0];y.height=F[1];A.layers[3].applyEdits([new esri.Graphic(w,y,J)]);x&&(x.xoffset=y.width/2,x.yoffset=y.height/2,A.layers[2].applyEdits([new esri.Graphic(new esri.geometry.Point(w.toJson()),x,K)]))},function(){var F=window.location.href.substring(0,window.location.href.indexOf(window.location.pathname)+
window.location.pathname.lastIndexOf("/"))+"/images/EsriBluePinCircle26.png";y=esri.symbol.fromJson({type:"esriPMS",url:F,imageData:"iVBORw0KGgoAAAANSUhEUgAAABoAAAAaCAYAAACpSkzOAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyRpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMy1jMDExIDY2LjE0NTY2MSwgMjAxMi8wMi8wNi0xNDo1NjoyNyAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNiAoTWFjaW50b3NoKSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDpDMjdDMDU2RTdEM0ExMUUzOTkyRUU3OTg1MDdCQzMzRSIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDpDMjdDMDU2RjdEM0ExMUUzOTkyRUU3OTg1MDdCQzMzRSI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkMyN0MwNTZDN0QzQTExRTM5OTJFRTc5ODUwN0JDMzNFIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOkMyN0MwNTZEN0QzQTExRTM5OTJFRTc5ODUwN0JDMzNFIi8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+aJP1/QAAAeNJREFUeNpi/P//PwM+IOdS4gCkEoA4AIj50aQ/AvEGIF7waE/PAXzmMOKzCGjJBGY2rnxeKQ0GNl5hBiAbRf7vr28Mvz6/Zfj87AaIPRFoWQHJFgEtKWDl4u8XVrNmYGRmRZH79uE1RDMTMwMLGzsDCysbw9tbRxl+f/tYCLRsAjbzmPD4toBfwRDDEmTw/99fht8/gL768Z0BpBakB5daFjwWybNyokYJLycLg6okN8PPLwwMN558YPj87TckCH//ZGAXEGVgYmaVJ8ciFOBjIs5Q6KvEwMMB0fLl+2+GjlWXGDYee0iUfiZiFBkp8TPUhqrBLQEBHk5WhpZ4YwZTNVG42L+/vymzKNJWGqdcrIsK9XyE7BN0wMvJSj2Lvvz4g1Pu8/ff1LNo+eGnOOUW77lDPYvO3fvI0Lz6ForPQKmuZuFZhtO3XhNlEdHJe8uZlwwHr76F5qOPKPmIqhZB4uMP2HewIogUwMRAJzBq0cBaxMjISJFFFz88OE/YAGYWBg4+YQao2ovkWOTw/e0jvJaBLGHnEWD4+PACA0gtSA/JFgGr5A/4LMNmCVQP6XGEyzJSLSHYCkJqqAgAqQOcwnL6AsC2AUgPKZYQbRG6ZSA+KZaQZBGyZbDEQqwlIAAQYACcTOWIFuSO8AAAAABJRU5ErkJggg\x3d\x3d",
width:26,height:26,yoffset:13,contentType:"image/png"});A.layers[3].applyEdits([new esri.Graphic(w,y,J)]);x&&(x.xoffset=13,x.yoffset=13,A.layers[2].applyEdits([new esri.Graphic(new esri.geometry.Point(w.toJson()),x,K)]))}):(C=window.location.href.substring(0,window.location.href.indexOf(window.location.pathname)+window.location.pathname.lastIndexOf("/"))+"/images/EsriBluePinCircle26.png",y=esri.symbol.fromJson({type:"esriPMS",url:C,imageData:"iVBORw0KGgoAAAANSUhEUgAAABoAAAAaCAYAAACpSkzOAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyRpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMy1jMDExIDY2LjE0NTY2MSwgMjAxMi8wMi8wNi0xNDo1NjoyNyAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNiAoTWFjaW50b3NoKSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDpDMjdDMDU2RTdEM0ExMUUzOTkyRUU3OTg1MDdCQzMzRSIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDpDMjdDMDU2RjdEM0ExMUUzOTkyRUU3OTg1MDdCQzMzRSI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkMyN0MwNTZDN0QzQTExRTM5OTJFRTc5ODUwN0JDMzNFIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOkMyN0MwNTZEN0QzQTExRTM5OTJFRTc5ODUwN0JDMzNFIi8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+aJP1/QAAAeNJREFUeNpi/P//PwM+IOdS4gCkEoA4AIj50aQ/AvEGIF7waE/PAXzmMOKzCGjJBGY2rnxeKQ0GNl5hBiAbRf7vr28Mvz6/Zfj87AaIPRFoWQHJFgEtKWDl4u8XVrNmYGRmRZH79uE1RDMTMwMLGzsDCysbw9tbRxl+f/tYCLRsAjbzmPD4toBfwRDDEmTw/99fht8/gL768Z0BpBakB5daFjwWybNyokYJLycLg6okN8PPLwwMN558YPj87TckCH//ZGAXEGVgYmaVJ8ciFOBjIs5Q6KvEwMMB0fLl+2+GjlWXGDYee0iUfiZiFBkp8TPUhqrBLQEBHk5WhpZ4YwZTNVG42L+/vymzKNJWGqdcrIsK9XyE7BN0wMvJSj2Lvvz4g1Pu8/ff1LNo+eGnOOUW77lDPYvO3fvI0Lz6ForPQKmuZuFZhtO3XhNlEdHJe8uZlwwHr76F5qOPKPmIqhZB4uMP2HewIogUwMRAJzBq0cBaxMjISJFFFz88OE/YAGYWBg4+YQao2ovkWOTw/e0jvJaBLGHnEWD4+PACA0gtSA/JFgGr5A/4LMNmCVQP6XGEyzJSLSHYCkJqqAgAqQOcwnL6AsC2AUgPKZYQbRG6ZSA+KZaQZBGyZbDEQqwlIAAQYACcTOWIFuSO8AAAAABJRU5ErkJggg\x3d\x3d",
width:26,height:26,yoffset:13,contentType:"image/png"}),A.layers[3].applyEdits([new esri.Graphic(w,y,J)]),x&&(x.xoffset=13,x.yoffset=13,A.layers[2].applyEdits([new esri.Graphic(new esri.geometry.Point(w.toJson()),x,K)])))},E,T,U,V));break}}},O,P,Q,R,S))}},q,t,v,u,B))},c,m,p,d,e));arcgisonline.map.main.sameSpatialReference(arcgisonline.map.main.map.spatialReference,new esri.SpatialReference({wkid:l}))?n(f,h):arcgisonline.map.main.projectPointToMapSpatialReference(f,h,new esri.SpatialReference({wkid:l}),
b.hitch(this,function(q,t){n(q[0].x,q[0].y)}),b.hitch(this,function(q,t){arcgisonline.map.main.map.setExtent(arcgisonline.map.main.defaultExtent,fitExtentCompletely)}))}}},cleanUpFailedServices:function(){for(var a=0;0<arcgisonline.map.main.mapLayers.length;){if(null==arcgisonline.map.main.mapLayers[a]){for(k=a;k<arcgisonline.map.main.mapLayers.length-1;k++)arcgisonline.map.main.mapLayers[k]=arcgisonline.map.main.mapLayers[k+1];--arcgisonline.map.main.mapLayers.length}if(a>=arcgisonline.map.main.mapLayers.length-
1)break;a++}},getNewMapExtent:function(a){var c=arcgisonline.map.main.map.getLayer(arcgisonline.map.main.currentBaseService),d=c?new esri.geometry.Extent(arcgisonline.map.main.map.extent.toJson()):arcgisonline.map.main.defaultExtent,e=a.intersects(d);if(e){var f=e.getWidth()*e.getHeight(),h=d.getWidth()*d.getHeight();f<h/200?e=!1:a.getWidth()*a.getHeight()<h/1E3&&(e=!1)}e&&arcgisonline.map.main.mapInitialized?a=arcgisonline.map.main.map.extent&&isNaN(arcgisonline.map.main.map.extent.xmin)?{extent:a,
zoomMap:!0}:{extent:d,zoomMap:!1}:(c?c=c.fullExtent:(e=arcgisonline.map.main.mapLayers[0],c=e.serviceInfo?arcgisonline.map.layer.parseServiceInfo(e.serviceInfo,e.url).extent:e.fullExtent),(e=a.intersects(c))?(arcgisonline.map.main.map&&arcgisonline.map.main.map.wrapAround180||(a.xmin<c.xmin&&(a=a.update(c.xmin,a.ymin,a.xmax,a.ymax,a.spatialReference)),a.xmax>c.xmax&&(a=a.update(a.xmin,a.ymin,c.xmax,a.ymax,a.spatialReference))),a.ymin<c.ymin&&(a=a.update(a.xmin,c.ymin,a.xmax,a.ymax,a.spatialReference)),
a.ymax>c.ymax&&(a=a.update(a.xmin,a.ymin,a.xmax,c.ymax,a.spatialReference)),a={extent:a,zoomMap:!0}):a={extent:d,zoomMap:!1});a.extent=arcgisonline.map.main.fitNewMapExtent(a.extent);return a},fitNewMapExtent:function(a){var c=[102113,102100,3857],d=a.spatialReference.wkid;if(4326!=d&&!b.indexOf(c,d))return a;var e=a;-1<b.indexOf(c,d)&&(e=arcgisonline.map.main.projectGeometries([a],a.spatialReference,new esri.SpatialReference({wkid:4326}))[0]);return-170>e.xmin&&170<e.xmax&&-80>e.ymin&&80<e.ymax?
(a=arcgisonline.map.main.adjustHeightToAspectRatio(a),arcgisonline.map.main.getExtentForNextTileLevel(a,arcgisonline.map.main.map.width,!0)):a},zoomMap:function(a,c,d,e){c=c?c:0;d=d?d:0;var f=b.connect(arcgisonline.map.main.map,"onExtentChange",b.hitch(this,function(){b.disconnect(f);e()})),h=arcgisonline.map.main.getScaleForExtent(a,arcgisonline.map.main.map.width);0<c&&h>c?(a=arcgisonline.map.main.adjustHeightToAspectRatio(a),c=arcgisonline.map.main.getExtentForScale(a,arcgisonline.map.main.map.width,
c),c.getWidth()<a.getWidth()&&(a=c),a=arcgisonline.map.main.getExtentForNextTileLevel(a,arcgisonline.map.main.map.width,!0)):0<d&&h<d&&(a=arcgisonline.map.main.adjustHeightToAspectRatio(a),c=arcgisonline.map.main.getExtentForScale(a,arcgisonline.map.main.map.width,d),c.getWidth()>a.getWidth()&&(a=c),a=arcgisonline.map.main.getExtentForNextTileLevel(a,arcgisonline.map.main.map.width,!1));c=arcgisonline.sharing.util.urlToObject(document.URL);c.query=c.query||{};if(!arcgisonline.map.main.mapInitialized)c.query.layers&&
(a=arcgisonline.map.main.getExtentForNextTileLevel(a,arcgisonline.map.main.map.width,!1)),arcgisonline.map.main.initMap(a);else if(arcgisonline.map.main.isMapFullyLoaded)arcgisonline.map.main.map.setExtent(a);else if(arcgisonline.map.main.isMapFullyLoaded||!c.query.center&&!c.query.extent)var l=0,g=setInterval(function(){arcgisonline.map.main.isMapFullyLoaded&&(clearInterval(g),arcgisonline.map.main.map.setExtent(a));l++;100<l&&clearInterval(g)},100)},projectToMapAndZoom:function(a,c,d,e){if(!a||
isNaN(a.xmin)||isNaN(a.ymin)||isNaN(a.xmax)||isNaN(a.ymax))arcgisonline.map.main.zoomMap(arcgisonline.map.main.defaultExtent,c,d,e);else{var f=arcgisonline.map.main.map.spatialReference;null==f&&(f=arcgisonline.map.main.defaultExtent.spatialReference);arcgisonline.map.main.sameSpatialReference(f,a.spatialReference)?(a=arcgisonline.map.main.getNewMapExtent(a),a.zoomMap?arcgisonline.map.main.zoomMap(a.extent,c,d,e):(arcgisonline.map.main.mapInitialized||arcgisonline.map.main.initMap(),e())):arcgisonline.map.main.projectToMapSpatialReference(a,
b.hitch(this,function(h,l){h=arcgisonline.map.main.getNewMapExtent(h[0]);h.zoomMap?arcgisonline.map.main.zoomMap(h.extent,c,d,e):(arcgisonline.map.main.mapInitialized||arcgisonline.map.main.initMap(),e())}),b.hitch(this,function(h,l){arcgisonline.map.main.zoomMap(arcgisonline.map.main.defaultExtent,c,d,e)}))}},adjustHeightToAspectRatio:function(a){var c=a.getWidth()*(arcgisonline.map.main.map.height/arcgisonline.map.main.map.width)/5;b.mixin(a,{ymin:a.getCenter().y-c,ymax:a.getCenter().y+c});return a},
getExtentForScale:function(a,c,d){var e=20015077/180,f=esri.config.defaults,h=esri.WKIDUnitConversion,l=a.spatialReference;if(l){var g=l.wkid;var m=l.wkt}l=null;g?l=h.values[h[g]]:m&&-1!==m.search(/^PROJCS/i)&&(h=/UNIT\[([^\]]+)\]\]$/i.exec(m))&&h[1]&&(l=parseFloat(h[1].split(",")[1]));return a.expand(d*c/(39.37*(l||e)*f.screenDPI)/a.getWidth())},getExtentFromCenter:function(a,c,d){a=new esri.geometry.Extent(a.x-1,a.y-.5,a.x+1,a.y+.5,a.spatialReference);return arcgisonline.map.main.getExtentForScale(a,
c,d)},getScaleForExtent:function(a,c){var d=20015077/180,e=esri.config.defaults,f=esri.WKIDUnitConversion,h=a.spatialReference;if(h){var l=h.wkid;var g=h.wkt}h=null;l?h=f.values[f[l]]:g&&-1!==g.search(/^PROJCS/i)&&(f=/UNIT\[([^\]]+)\]\]$/i.exec(g))&&f[1]&&(h=parseFloat(f[1].split(",")[1]));return a.getWidth()/c*(h||d)*39.37*e.screenDPI},getExtentForNextTileLevel:function(a,c,d){if(null!=arcgisonline.map.main.mapLods){c=a.getWidth()/c;for(var e=arcgisonline.map.main.mapLods,f=e[e.length-1].resolution,
h=0;h<e.length;h++)if(e[h].resolution<c){f=d?e[h].resolution:0==h?e[0].resolution:e[h-1].resolution;break}return a.expand(f/c*.9)}return a},getExtentForCloseTileLevel:function(a,c){if(null!=arcgisonline.map.main.mapLods){c=a.getWidth()/c;for(var d=arcgisonline.map.main.mapLods,e=0;e<d.length-1;e++)if(d[e].resolution>c&&d[e+1].resolution<c){var f=(d[e].resolution-d[e+1].resolution)/10;if(d[e].resolution<c+f)return a.expand(d[e].resolution/c*.9);if(d[e+1].resolution>c-f)return a.expand(d[e+1].resolution/
c*.9);break}}return a},getIntersectionPercent:function(a,c){var d=new b.Deferred;if(!c)return d.callback(0),d;if(c.spatialReference._isWrappable())esri.geometry.normalizeCentralMeridian([c],null,b.hitch(this,function(h){if(h[0].rings){var l=(new esri.geometry.Polygon(c.spatialReference)).addRing(h[0].rings[0]).getExtent();h=(new esri.geometry.Polygon(c.spatialReference)).addRing(h[0].rings[1]).getExtent();c=l.getWidth()>h.getWidth()?l:h}else c=h[0];(l=c.intersects(a))?(l=l.getWidth()*l.getHeight(),
h=c.getWidth()*c.getHeight(),d.callback(l/h*100)):d.callback(0)}),function(){d.callback(0)});else{var e=c.intersects(a);if(e){e=e.getWidth()*e.getHeight();var f=c.getWidth()*c.getHeight();d.callback(e/f*100)}else d.callback(0)}return d},zoomToLayerScale:function(a){if(a.layers){var c=-1*Number.MAX_VALUE,d=Number.MAX_VALUE;b.forEach(a.layers,b.hitch(this,function(e){var f=e.minScale||0;e=e.maxScale||0;c=0===c||0===f?0:Math.max(c,f);d=Math.min(d,e)}));arcgisonline.map.main.zoomToScale(c,d)}else a.layer&&
arcgisonline.map.main.zoomToScale(a.layer.minScale,a.layer.maxScale)},zoomToScale:function(a,c,d){var e=arcgisonline.map.main.map.getScale();0<a&&e>a?(a=arcgisonline.map.main.getScaleForNextTileLevel(a,!0),d?(c=arcgisonline.map.main.getExtentFromCenter(arcgisonline.map.main.map.extent.getCenter(),arcgisonline.map.main.map.width,a),(c=c.intersects(d))?arcgisonline.map.main.map.setScale(a):(c=arcgisonline.map.main.getExtentFromCenter(d.getCenter(),arcgisonline.map.main.map.width,a),arcgisonline.map.main.map.setExtent(c))):
arcgisonline.map.main.map.setScale(a)):e<c&&(a=arcgisonline.map.main.getScaleForNextTileLevel(c,!1),d?(c=arcgisonline.map.main.getExtentFromCenter(arcgisonline.map.main.map.extent.getCenter(),arcgisonline.map.main.map.width,a),(c=c.intersects(d))?arcgisonline.map.main.map.setScale(a):(c=arcgisonline.map.main.getExtentFromCenter(d.getCenter(),arcgisonline.map.main.map.width,a),arcgisonline.map.main.map.setExtent(c))):arcgisonline.map.main.map.setScale(a))},zoomMapConsiderScale:function(a,c,d){if(a.layers){var e=
-1*Number.MAX_VALUE;var f=Number.MAX_VALUE;b.forEach(a.layers,b.hitch(this,function(h){var l=h.minScale||0;h=h.maxScale||0;e=0===e||0===l?0:Math.max(e,l);f=Math.min(f,h)}))}else a.layer&&(e=a.layer.minScale||0,f=a.layer.maxScale||0,a.layer.dynamicLayerInfos&&arcgisonline.map.main.hasDynamicLayers(a)?(a=arcgisonline.map.dijit.toc.scale.mergeSubLayerScales(a.layer.dynamicLayerInfos,a.layer.layerInfos,a),a=arcgisonline.map.dijit.toc.scale.mergeScale(a.minScale,a.maxScale,e,f),e=a.minScale,f=a.maxScale):
a.layer.layerInfos&&a.layer.layerInfos.length&&(a.layer instanceof esri.layers.ArcGISDynamicMapServiceLayer||a.layer instanceof esri.layers.ArcGISTiledMapServiceLayer)?(a=arcgisonline.map.dijit.toc.scale.mergeSubLayerScales(a.layer.layerInfos,null,a),a=arcgisonline.map.dijit.toc.scale.mergeScale(a.minScale,a.maxScale,e,f),e=a.minScale,f=a.maxScale):a.layer.folders&&(a=arcgisonline.map.dijit.toc.scale.mergeSubLayerScales(a.layer.folders,null,a),a=arcgisonline.map.dijit.toc.scale.mergeScale(a.minScale,
a.maxScale,e,f),e=a.minScale,f=a.maxScale));a=arcgisonline.map.main.map.getScale();0<e&&a>e?(e=arcgisonline.map.main.getScaleForNextTileLevel(e,!0),d=arcgisonline.map.main.adjustHeightToAspectRatio(c),d=arcgisonline.map.main.getExtentForScale(d,arcgisonline.map.main.map.width,e),arcgisonline.map.main.map.setExtent(d)):a<f?(f=arcgisonline.map.main.getScaleForNextTileLevel(f,!1),d=arcgisonline.map.main.adjustHeightToAspectRatio(c),d=arcgisonline.map.main.getExtentForScale(c,arcgisonline.map.main.map.width,
f),arcgisonline.map.main.map.setExtent(d)):d?arcgisonline.map.main.zoomMap(c,e,f,function(){}):(a=arcgisonline.map.main.getNewMapExtent(c),a.zoomMap&&arcgisonline.map.main.zoomMap(c,e,f,function(){}))},getScaleForNextTileLevel:function(a,c){if(null!=arcgisonline.map.main.mapLods){var d=arcgisonline.map.main.mapLods;if(c){for(c=0;c<d.length;c++)if(d[c].scale<a)return d[c].scale-1;return d[d.length-1].scale-1}for(c=d.length-1;0<=c;c--)if(d[c].scale>a)return d[c].scale+1;return d[0].scale+1}return a},
checkSuggestedScaleRangeAndZoom:function(a){return arcgisonline.map.main.checkSuggestedScaleRange(a,!0)},checkSuggestedScaleRange:function(a,c){var d=new b.Deferred;if(a.layer)arcgisonline.map.main.checkSuggestedScaleRangePerLayer(a.layer,c).then(function(f){a.scaleChanged=!0;if(c){var h=arcgisonline.map.featColl.isFeatureCollection(a)?arcgisonline.map.featColl.getLayerFullExtent(a.layer):new esri.geometry.Extent(a.layer.fullExtent.toJson());arcgisonline.map.main.sameSpatialReference(arcgisonline.map.main.map.spatialReference,
h.spatialReference)?(f.scaleAtFullExtent&&(h=arcgisonline.map.main.getExtentFromCenter(h.getCenter(),arcgisonline.map.main.map.width,f.scaleAtFullExtent)),arcgisonline.map.main.map.setExtent(h)):arcgisonline.map.main.projectToMapSpatialReference(h,b.hitch(this,function(l,g){l&&0<l.length&&l[0]&&"extent"==l[0].type&&(h=l[0],f.scaleAtFullExtent&&(h=arcgisonline.map.main.getExtentFromCenter(h.getCenter(),arcgisonline.map.main.map.width,f.scaleAtFullExtent)),arcgisonline.map.main.map.setExtent(h))}))}d.resolve(f)},
function(){if(c){var f=arcgisonline.map.featColl.isFeatureCollection(a)?arcgisonline.map.featColl.getLayerFullExtent(a.layer):new esri.geometry.Extent(a.layer.fullExtent.toJson());arcgisonline.map.main.zoomMapConsiderScale(a,f)}d.resolve()});else if(a.layers){var e;b.forEach(a.layers,function(f,h){arcgisonline.map.main.checkSuggestedScaleRangePerLayer(f,c).then(function(l){a.scaleChanged=!0;l.scaleAtFullExtent&&(!esri.isDefined(e)||e<l.scaleAtFullExtent)&&(e=l.scaleAtFullExtent);if(h===a.layers.length-
1){if(l&&l.center){var g=arcgisonline.map.featColl.getFullExtent(a);esri.isDefined(e)&&(g=arcgisonline.map.main.getExtentFromCenter(g.getCenter(),arcgisonline.map.main.map.width,e));arcgisonline.map.main.map.setExtent(g)}else a.layer&&(g=arcgisonline.map.featColl.getLayerFullExtent(a.layer),arcgisonline.map.main.zoomMapConsiderScale(a,g));l.scaleAtFullExtent=e;d.resolve(l)}},function(){if(c&&0===h){var l=arcgisonline.map.featColl.getLayerFullExtent(a.layers[0]);arcgisonline.map.main.zoomMapConsiderScale(a,
l)}h===a.layers.length-1&&d.resolve()})})}return d},checkSuggestedScaleRangePerLayer:function(a,c){var d=new b.Deferred;if(!(a instanceof esri.layers.FeatureLayer)||a instanceof esri.layers.StreamLayer)d.reject();else return 0===a.minScale&&0===a.maxScale&&a.addPlugin("esri/plugins/FeatureLayerStatistics").then(b.hitch(this,function(){a.statisticsPlugin.getSuggestedScaleRange({map:arcgisonline.map.main.map}).then(function(e){a.setScaleRange(e.relaxedMinScale,e.maxScale);d.resolve(e)},function(e){d.reject()})})),
d},addLayerFromFile:function(){arcgisonline.map.main.isReadOnlyMode()||arcgisonline.sharing.dijit.dialog.AddLayerFromFileDlg.prototype.statics.getInstance().show()},addLayerFromUrl:function(){arcgisonline.map.main.isReadOnlyMode()||arcgisonline.sharing.dijit.dialog.AddLayerFromUrlDlg.prototype.statics.getInstance().show()},openLeftDefaultPanel:function(){arcgisonline.map.main.isReadOnlyMode()||(arcgisonline.sharing.util.isLoggedIn()&&esriGeowConfig.userRole&&!esriGeowConfig.userRole.canCreateItem()?
arcgisonline.map.leftPanel.openLeftAddContentPanel(null,{forceSection:"myOrganization"}):arcgisonline.map.leftPanel.openLeftAddContentPanel())},browseLayers:function(){arcgisonline.map.main.isReadOnlyMode()||arcgisonline.map.leftPanel.openLeftAddContentPanel(null,{forceSection:"livingAtlas"})},browseProvisionedListings:function(){arcgisonline.map.main.isReadOnlyMode()||arcgisonline.map.leftPanel.openLeftAddContentPanel(null,{forceSection:"subscription"})},requireAuthentication:function(a){if(1==arcgisonline.sharing.util.isLoggedIn())return!0;
arcgisonline.map.storage.saveMapInCookie(a,!0,null,null,b.hitch(this,function(){var c="";-1==esriGeowConfig.signin.indexOf("http")&&(c=esriGeowConfig.baseUrl,!1!==esriGeowConfig.useSSL&&(c=arcgisonline.sharing.util.getSecureUrl(c)));c+=esriGeowConfig.signin;c+="?error\x3d403\x26returnUrl\x3d"+esriGeowConfig.baseUrl+esriGeowConfig.webmapViewerPath+"?useExisting\x3d1";window.location=c}));return!1},signInWithPopup:function(){arcgisonline.map.main.signInWithOAuth().then(function(a){var c=a.reloadRequired,
d=a.oAuthInfo;c&&arcgisonline.map.main.mapHasChanged&&arcgisonline.map.role.isAllowed("tool_save")&&arcgisonline.map.main.appAccess?(arcgisonline.sharing.dijit.dialog.ChoiceDlg.prototype.statics.getInstance().show({title:esri.i18nBundle.viewer.webMap,message:esri.i18nBundle.viewer.main.unsavedChangesDoSave,choiceOneTitle:esri.i18nBundle.viewer.main.unsavedChangesYesBtn,choiceOneHandler:b.hitch(this,function(){var e=arcgisonline.sharing.util.getUser();null==arcgisonline.map.save_open.webMapInfo||arcgisonline.map.save_open.webMapInfo.owner!==
e.username&&"admin"!==arcgisonline.map.save_open.webMapInfo.itemControl&&"update"!==arcgisonline.map.save_open.webMapInfo.itemControl?arcgisonline.map.storage.canSaveWithBing()&&(e=arcgisonline.sharing.dijit.dialog.SaveWebMapDlg.prototype.statics.getInstance(),b.subscribe("onWebMapSave",null,b.hitch(arcgisonline.map.storage,"onWebMapSave")),e.addWebMapItem(arcgisonline.map.main.mapLayers,arcgisonline.map.main.map.extent,arcgisonline.map.save_open.folderId,arcgisonline.map.save_open.webMapInfo,function(f){arcgisonline.map.main.redirectToCustomURL(f,
!1,d)},function(){arcgisonline.map.main.redirectToCustomURL(null,!1,d)})):arcgisonline.map.storage.saveExistingWebMap(null,function(f){arcgisonline.map.main.redirectToCustomURL(f,!1,d)},function(){arcgisonline.map.main.redirectToCustomURL(null,!1,d)})}),choiceTwoTitle:esri.i18nBundle.viewer.main.unsavedChangesNoBtn,choiceTwoHandler:b.hitch(this,function(){arcgisonline.map.main.redirectToCustomURL(null,!1,d)})}),a=esri.i18nBundle.viewer.main.unsavedChangesYesBtn.length+esri.i18nBundle.viewer.main.unsavedChangesNoBtn.length,
b.style(b.byId("choice-dialog"),"width",Math.min(10*a+150,650)+"px")):c&&arcgisonline.map.main.redirectToCustomURL(null,!1,d)});return!1},signInWithPopupAndSave:function(a){if(arcgisonline.sharing.util.isLoggedIn())return arcgisonline.map.storage.saveWebMapClick(a),!0;arcgisonline.map.main.signInWithOAuth().then(b.hitch(this,function(c,d){var e=d.oAuthInfo;if(arcgisonline.map.main.appAccess)if(arcgisonline.map.role.isAllowed("tool_save"))arcgisonline.map.storage.saveWebMapClick(c,function(h){arcgisonline.map.main.redirectToCustomURL(h,
!0,e)},function(){arcgisonline.map.main.redirectToCustomURL(null,!1,e)});else{c=arcgisonline.sharing.dijit.dialog.GeneralDlg.prototype.statics.getInstance();c.show({title:esri.i18nBundle.generalDlg.errorDlgTitle,message:esri.i18nBundle.viewer.error.cannotSaveMap});var f=b.connect(c,"onHide",function(){b.disconnect(f);arcgisonline.map.main.redirectToCustomURL(null,!1,e)})}else arcgisonline.map.main.redirectToCustomURL(null,!1,e)},a));return!1},signInWithOAuth:function(a){var c=new b.Deferred;window.checkOAuthResponse=
b.hitch(arcgisonline.map.main,"checkOAuthResponse");var d=esriGeowConfig.restBaseUrl.substring(0,esriGeowConfig.restBaseUrl.indexOf("/",8)).replace("http://","https://");esriGeowConfig.self.portalHostname&&(d="https://"+esriGeowConfig.self.portalHostname);a=new esri.arcgis.OAuthInfo({appId:"arcgisonline",portalUrl:d,minTimeUntilExpiration:525949,forceLogin:!0,showSocialLogins:!0,locale:b.locale,flowType:"authorization-code",popup:!0,popupCallbackUrl:"viewer_oauth-callback.html",popupWindowFeatures:"height\x3d480,width\x3d800,resizable,scrollbars",
msg:esri.i18nBundle.viewer.main.oAuthSignInMsg});esri.id.registerOAuthInfos([a]);esri.id.useSignInPage=!1;esri.id.getCredential(d+"/sharing",{oAuthPopupConfirmation:!1}).then(function(e){var f=new esri.arcgis.Portal(d);f.signIn().then(function(h){arcgisonline.sharing.geow.Account.setupAfterSelf(f);esri.id.useSignInPage=!0;arcgisonline.sharing.util.parseUrl(d).host===arcgisonline.sharing.util.parseUrl(esriGeowConfig.restBaseUrl).host||esriGeowConfig.self.urlKey&&esriGeowConfig.self.customBaseUrl&&
arcgisonline.sharing.util.parseUrl(esriGeowConfig.restBaseUrl).host===esriGeowConfig.self.urlKey+"."+esriGeowConfig.self.customBaseUrl||(esriGeowConfig.restBaseUrl=esriGeowConfig.restBaseUrl.replace(arcgisonline.sharing.util.parseUrl(esriGeowConfig.restBaseUrl).host,arcgisonline.sharing.util.parseUrl(d).host));b.topic.publish("onSignIn",[esriGeowConfig.userInfo]);var l=!1;h=arcgisonline.sharing.util.parseUrl(document.location.href).host;var g=esriGeowConfig.self;!g.isPortal&&(h===g.portalHostname||
g.urlKey&&g.customBaseUrl&&h!==g.urlKey+"."+g.customBaseUrl||!g.urlKey&&h!==g.portalHostname)&&(g.urlKey&&g.customBaseUrl?-1===h.indexOf(g.urlKey+"."+g.customBaseUrl)&&(l=!0):g.urlKey||(l=!0));!esriGeowConfig.userInfo.token&&esriGeowConfig.userInfo.credential&&(esriGeowConfig.userInfo.token=esriGeowConfig.userInfo.credential.token);var m=function(p){arcgisonline.map.role.clearUserActions();arcgisonline.map.role.setupUserActions();arcgisonline.map.main.loggedIn();arcgisonline.map.main.updateHeaderLinks();
arcgisonline.map.role.updateUserActionWithWebmap();arcgisonline.map.save_open.webMapInfo||arcgisonline.map.save_open.itemCard||arcgisonline.map.leftPanel.recreateAboutStack();b.forEach(arcgisonline.map.main.mapLayers,function(t){t.layer&&t.serviceInfo&&t.serviceInfo.ownershipBasedAccessControlForFeatures&&!1===t.serviceInfo.ownershipBasedAccessControlForFeatures.allowOthersToQuery&&arcgisonline.map.main.reloadFeatureLayer(t)});var q=arcgisonline.sharing.util.getUser();arcgisonline.map.save_open.webMapInfo&&
arcgisonline.map.save_open.webMapInfo.owner!==q.username?arcgisonline.sharing.util.getJson(esriGeowConfig.restBaseUrl+"content/items/"+arcgisonline.map.save_open.webMapInfo.id,b.hitch(this,function(t,v){arcgisonline.map.save_open.webMapItemCard=t;arcgisonline.map.save_open.webMapInfo.itemControl=t.itemControl;arcgisonline.map.role.updateUserActionAfterOAuth();p.callback({reloadRequired:l,oAuthInfo:e})}),b.hitch(this,function(t,v){p.callback({reloadRequired:l,oAuthInfo:e})})):(l||("contentStack"==
arcgisonline.map.leftPanel.getLeftContentPanelStack()?leftPanel.reloadVisibleTOC():leftPanel.deleteContentStack()),p.callback({reloadRequired:l,oAuthInfo:e}))},n=arcgisonline.sharing.util.getUser();n.accountId?arcgisonline.map.main.checkAppAccess().then(b.hitch(this,function(){m(c)}),b.hitch(this,function(){if(l)c.callback({reloadRequired:l,oAuthInfo:e});else{arcgisonline.map.main.loggedIn();arcgisonline.map.main.updateHeaderLinks();var p=arcgisonline.sharing.dijit.dialog.GeneralDlg.prototype.statics.getInstance();
p.show({title:esri.i18nBundle.viewer.error.notLicensedTitle,message:b.string.substitute(esri.i18nBundle.viewer.error.notLicensed,{username:n.username})});var q=b.aspect.before(p._dialog,"hide",b.hitch(this,function(){q.remove();c.callback({reloadRequired:l,oAuthInfo:e})}))}})):m(c)}).otherwise(function(h){arcgisonline.sharing.dijit.dialog.GeneralDlg.prototype.statics.getInstance().show({title:esri.i18nBundle.generalDlg.errorDlgTitle,message:esri.i18nBundle.viewer.error.cannotSignInOAuth});esri.id.useSignInPage=
!0;c.errback()})}).otherwise(function(e){-1<e.message.indexOf("sufficient user license type")?(e=arcgisonline.sharing.dijit.dialog.GeneralDlg.prototype.statics.getInstance(),e.show({title:esri.i18nBundle.viewer.error.notLicensedTitle,message:esri.i18nBundle.viewer.error.notLicensedMsg}),c.errback()):"ABORTED"!==e.message&&(e=arcgisonline.sharing.dijit.dialog.GeneralDlg.prototype.statics.getInstance(),e.show({title:esri.i18nBundle.generalDlg.errorDlgTitle,message:esri.i18nBundle.viewer.error.cannotSignInOAuth}),
c.errback())});return c},checkOAuthResponse:function(a){},redirectToCustomURL:function(a,c,d){d=esriGeowConfig.self;c=document.location.href;a?c=esriGeowConfig.baseUrl+esriGeowConfig.webmapViewerPath+"?webmap\x3d"+a:-1<c.indexOf("useExisting\x3d1")&&(a=arcgisonline.map.save_open.webMapInfo?arcgisonline.map.save_open.webMapInfo.id:null)&&(c=esriGeowConfig.baseUrl+esriGeowConfig.webmapViewerPath+"?webmap\x3d"+a);a=arcgisonline.sharing.util.parseUrl(c).host;!d.isPortal&&(a===d.portalHostname||d.urlKey&&
d.customBaseUrl&&a!==d.urlKey+"."+d.customBaseUrl||!d.urlKey&&a!==d.portalHostname)&&(d.urlKey&&d.customBaseUrl?-1===a.indexOf(d.urlKey+"."+d.customBaseUrl)&&(arcgisonline.map.storage.deleteMapStorageNoFeedback(),c=c.replace(a,d.urlKey+"."+d.customBaseUrl)):d.urlKey||(arcgisonline.map.storage.deleteMapStorageNoFeedback(),c=c.replace(a,d.portalHostname)));c=d.allSSL?c.replace("http:","https:"):c;a=esriGeowConfig.self.user.culture&&b.locale!==esriGeowConfig.self.user.culture;if(c!==document.location.href||
a)arcgisonline.sharing.util.parseUrl(c).host!==arcgisonline.sharing.util.parseUrl(document.location.href).host||a?window.location=c:"undefined"!==typeof history.pushState?window.history.pushState(null,null,c):window.location.href!==c&&(window.location=c)},checkAppAccess:function(){var a=new b.Deferred;isEmbedded?(arcgisonline.map.main.appAccess=!0,a.callback()):esri.isDefined(arcgisonline.map.main.appAccess)?arcgisonline.map.main.appAccess?a.callback():a.errback():esri.id.checkAppAccess(esriGeowConfig.restBaseUrl,
"arcgisWebApps").then(b.hitch(this,function(){arcgisonline.map.main.appAccess=!0;a.callback()}),b.hitch(this,function(){arcgisonline.map.main.appAccess=!1;a.errback()}));return a},checkAccessToViewer:function(){var a=arcgisonline.sharing.util.getUser();if(a&&a.accountId){var c=arcgisonline.sharing.util.urlToObject(document.URL);!c.query||c.query.layers||c.query.webmap?esri.isDefined(arcgisonline.map.main.appAccess)||arcgisonline.map.main.checkAppAccess():arcgisonline.map.main.checkAppAccess().then(b.hitch(this,
function(){}),b.hitch(this,function(){arcgisonline.sharing.dijit.dialog.GeneralDlg.prototype.statics.getInstance().show({title:esri.i18nBundle.viewer.error.notLicensedTitle,message:b.string.substitute(esri.i18nBundle.viewer.error.notLicensed,{username:a.username})})}))}else arcgisonline.map.main.appAccess=!0},linkToMap:function(a){arcgisonline.map.main.onShareStatusChangeHandler||(arcgisonline.map.main.onShareStatusChangeHandler=b.subscribe("onShareStatusChange",b.hitch(this,function(h){arcgisonline.map.save_open.webMapItemCard.access=
h.access})));if(null==arcgisonline.map.save_open.webMapInfo){var c=arcgisonline.sharing.dijit.dialog.GeneralDlg.prototype.statics.getInstance();c.show({title:esri.i18nBundle.sharingDlg.sharingDlgTitle,message:esri.i18nBundle.viewer.error.cantShare})}else{var d=!1;arcgisonline.map.main.mapLayers[0].layer instanceof esri.virtualearth.VETiledLayer&&(d=!0);var e=!1;arcgisonline.map.save_open.openedWebMap&&arcgisonline.map.save_open.openedWebMap.presentation&&arcgisonline.map.save_open.openedWebMap.presentation.slides&&
0<arcgisonline.map.save_open.openedWebMap.presentation.slides.length&&(e=!0);var f=!1;b.forEach(arcgisonline.map.main.mapLayers,function(h){h.itemCard&&(-1<b.indexOf(h.itemCard.typeKeywords,"Requires Credits")||-1<b.indexOf(h.itemCard.typeKeywords,"Requires Subscription"))&&(f=!0)});c=arcgisonline.sharing.util.getUser();!c||arcgisonline.map.save_open.webMapInfo.owner!==c.username&&"admin"!==arcgisonline.map.save_open.webMapInfo.itemControl&&"update"!==arcgisonline.map.save_open.webMapInfo.itemControl?
(c=arcgisonline.sharing.dijit.dialog.ShareMapDlg.prototype.statics.getInstance(),c.show(arcgisonline.map.save_open.webMapInfo.id,arcgisonline.map.save_open.webMapInfo.owner,arcgisonline.map.save_open.folderId,arcgisonline.map.save_open.webMapInfo.title,d,e,a,f)):null==arcgisonline.map.save_open.folderTitle?arcgisonline.map.storage.getItemFolder(b.hitch(this,function(h,l){arcgisonline.sharing.dijit.dialog.ShareMapDlg.prototype.statics.getInstance().show(arcgisonline.map.save_open.webMapInfo.id,arcgisonline.map.save_open.webMapInfo.owner,
arcgisonline.map.save_open.folderId,arcgisonline.map.save_open.webMapInfo.title,d,e,a,f)})):(c=arcgisonline.sharing.dijit.dialog.ShareMapDlg.prototype.statics.getInstance(),c.show(arcgisonline.map.save_open.webMapInfo.id,arcgisonline.map.save_open.webMapInfo.owner,arcgisonline.map.save_open.folderId,arcgisonline.map.save_open.webMapInfo.title,d,e,a,f))}},projectToMapSpatialReference:function(a,c,d){var e=arcgisonline.map.main.map.spatialReference;null==e&&(e=arcgisonline.map.main.defaultExtent.spatialReference);
arcgisonline.map.main.projectExtent(a,e,c,d)},projectWrapAroundExtent:function(a,c,d,e){var f=a.spatialReference.wkid,h=c.wkid;(f||h)&&f!==h||arcgisonline.map.main.doProject(a,c,d,e);var l=f&&4326==f,g=h&&4326==h,m=[102113,102100,3857];f=f&&arcgisonline.map.main.contains(m,f);h=h&&arcgisonline.map.main.contains(m,h);l||f||!g&&!h?arcgisonline.map.main.doProject(a,c,d,e):arcgisonline.map.main.doProjectWrapAround(a,c,d,e)},doProjectWrapAround:function(a,c,d,e){arcgisonline.map.main.geometryService||
(arcgisonline.map.main.geometryService=new esri.tasks.GeometryService(esriGeowConfig.self.helperServices.geometry.url));var f=new esri.geometry.Polygon(a.spatialReference.toJson());f.addRing([[a.xmin,a.ymin],[a.xmin,a.ymax],[a.xmax,a.ymax],[a.xmax,a.ymin],[a.xmin,a.ymin]]);arcgisonline.map.main.geometryService.project([f],c,function(h,l){var g=h[0];g.rings&&2!==g.rings.length?d([g.getExtent()],l):g.rings&&2==g.rings.length?(h=new esri.geometry.Polygon(g.toJson()),g.removeRing(1),h.removeRing(0),g=
g.getExtent(),h=h.getExtent(),g.getWidth()>h.getWidth()?(g.xmin<h.xmin?g.xmin-=h.getWidth():g.xmax+=h.getWidth(),d([g],l)):(h.xmin<g.xmin?h.xmin-=g.getWidth():h.xmax+=g.getWidth(),d([h],l))):e&&e()},e)},projectExtent:function(a,c,d,e){arcgisonline.map.main.doProject(a,c,d,e)},projectPointToMapSpatialReference:function(a,c,d,e,f){var h=arcgisonline.map.main.map.spatialReference;null==h&&(h=arcgisonline.map.main.defaultExtent.spatialReference);a=new esri.geometry.Point(a,c,d);arcgisonline.map.main.doProject(a,
h,e,f)},doProject:function(a,c,d,e){var f=[102113,102100,3857];if(a.spatialReference.wkid===c.wkid)d([a],null);else if(null!=a.spatialReference.wkid&&4326==a.spatialReference.wkid&&null!=c.wkid&&arcgisonline.map.main.contains(f,c.wkid)){a.ymin=Math.max(a.ymin,-89.99);a.ymax=Math.min(a.ymax,89.99);a=esri.geometry.geographicToWebMercator(a);if((f=a.spatialReference._getInfo())&&a.xmin>a.xmax){var h=f.valid[1]-a.xmin,l=a.xmax-f.valid[0];h>l?a.xmax=f.valid[1]+l:a.xmin=f.valid[0]-h}a.spatialReference.wkid=
c.wkid;d([a],null)}else if(null!=a.spatialReference.wkid&&arcgisonline.map.main.contains(f,a.spatialReference.wkid)&&null!=c.wkid&&4326==c.wkid)a=esri.geometry.webMercatorToGeographic(a),(f=a.spatialReference._getInfo())&&a.xmin>a.xmax&&(h=f.valid[1]-a.xmin,l=a.xmax-f.valid[0],h>l?a.xmax=f.valid[1]+l:a.xmin=f.valid[0]-h),d([a],null);else{arcgisonline.map.main.geometryService||(arcgisonline.map.main.geometryService=new esri.tasks.GeometryService(esriGeowConfig.self.helperServices.geometry.url));if(arcgisonline.map.main.map&&
arcgisonline.map.main.map.wrapAround180&&"extent"===a.type){var g=a;a=esri.geometry.Polygon.fromExtent(a)}arcgisonline.map.main.geometryService.project([a],c,function(m,n){if(!(m&&0<m.length&&m[0]&&"extent"==m[0].type)||isNaN(m[0].xmin)||isNaN(m[0].ymin)||isNaN(m[0].xmax)||isNaN(m[0].ymax))if(m&&0<m.length&&m[0]&&"point"==m[0].type&&!isNaN(m[0].x)&&!isNaN(m[0].y))d(m,n);else if(g&&"polygon"===m[0].type&&0<m[0].rings.length&&m[0].rings[0]){if(1===m[0].rings.length)m[0]=new esri.geometry.Extent(m[0].getExtent());
else{var p=(new esri.geometry.Polygon(m[0].spatialReference.toJson())).addRing(m[0].rings[0]).getExtent(),q=(new esri.geometry.Polygon(m[0].spatialReference.toJson())).addRing(m[0].rings[1]).getExtent();m[0]=q;m[0].xmin=q.xmin-p.getWidth();m[0].ymin=Math.min(q.ymin,p.ymin);m[0].ymax=Math.max(q.ymax,p.ymax)}d(m,n)}else"polygon"===m[0].type&&0<m[0].rings.length&&m[0].rings[0]?d(m,n):e&&e();else d(m,n)},e)}},projectJsonGeometries:function(a,c,d,e,f,h){0===a.length&&f(null);var l=esri.geometry.getGeometryType(c),
g=[];b.forEach(a,function(m){m=new l(m);m.spatialReference=d;g.push(m)},this);c=[102113,102100,3857];d.wkid&&4326==d.wkid&&e.wkid&&arcgisonline.map.main.contains(c,e.wkid)?(b.forEach(g,function(m){m.xmin?(m.xmin=Math.max(m.xmin,-180),m.xmax=Math.min(m.xmax,180),m.ymin=Math.max(m.ymin,-89.99),m.ymax=Math.min(m.ymax,89.99)):m.rings?b.forEach(m.rings,function(n){b.forEach(n,function(p){p[0]=Math.min(Math.max(p[0],-180),180);p[1]=Math.min(Math.max(p[1],-89.99),89.99)},this)},this):m.paths?b.forEach(m.paths,
function(n){b.forEach(n,function(p){p[0]=Math.min(Math.max(p[0],-180),180);p[1]=Math.min(Math.max(p[1],-89.99),89.99)},this)},this):m.x&&(m.x=Math.min(Math.max(m.x,-180),180),m.y=Math.min(Math.max(m.y,-89.99),89.99))},this),a=[],b.forEach(g,function(m){m=esri.geometry.geographicToWebMercator(m);102100!==e.wkid&&(m.spatialReference=e);a.push(m.toJson())},this),f(a)):null!=d.wkid&&arcgisonline.map.main.contains(c,d.wkid)&&null!=e.wkid&&4326==e.wkid?(a=[],b.forEach(g,function(m){a.push(esri.geometry.webMercatorToGeographic(m).toJson())},
this),f(a)):(arcgisonline.map.main.geometryService||(arcgisonline.map.main.geometryService=new esri.tasks.GeometryService(esriGeowConfig.self.helperServices.geometry.url)),arcgisonline.map.main.geometryService.project(g,e,b.hitch(this,function(m,n){m&&m.length===a.length?(a=[],b.forEach(m,function(p){p&&(p.rings&&0<p.rings.length&&0<p.rings[0].length&&0<p.rings[0][0].length&&!isNaN(p.rings[0][0][0])&&!isNaN(p.rings[0][0][1])||p.paths&&0<p.paths.length&&0<p.paths[0].length&&0<p.paths[0][0].length&&
!isNaN(p.paths[0][0][0])&&!isNaN(p.paths[0][0][1])||p.xmin&&!isNaN(p.xmin)&&p.ymin&&!isNaN(p.ymin)||p.x&&!isNaN(p.x)&&p.y&&!isNaN(p.y))?a.push(p.toJson()):a.push(null)},this),f(a)):h&&h(m,n)}),h))},projectGeometries:function(a,c,d,e,f){if(0===a.length)if(e)e(null);else return null;var h=[102113,102100,3857];if(c.wkid&&4326==c.wkid&&d.wkid&&arcgisonline.map.main.contains(h,d.wkid)){b.forEach(a,function(g){g.xmin?(g.xmin=Math.max(g.xmin,-180),g.xmax=Math.min(g.xmax,180),g.ymin=Math.max(g.ymin,-89.99),
g.ymax=Math.min(g.ymax,89.99)):g.rings?b.forEach(g.rings,function(m){b.forEach(m,function(n){n[0]=Math.min(Math.max(n[0],-180),180);n[1]=Math.min(Math.max(n[1],-89.99),89.99)},this)},this):g.paths?b.forEach(g.paths,function(m){b.forEach(m,function(n){n[0]=Math.min(Math.max(n[0],-180),180);n[1]=Math.min(Math.max(n[1],-89.99),89.99)},this)},this):g.x&&(g.x=Math.min(Math.max(g.x,-180),180),g.y=Math.min(Math.max(g.y,-89.99),89.99))},this);var l=[];b.forEach(a,function(g){g=esri.geometry.geographicToWebMercator(g);
102100!==d.wkid&&(g.spatialReference=d);l.push(g)},this);if(e)e(l);else return l}else if(null!=c.wkid&&arcgisonline.map.main.contains(h,c.wkid)&&null!=d.wkid&&4326==d.wkid)if(l=[],b.forEach(a,function(g){l.push(esri.geometry.webMercatorToGeographic(g))},this),e)e(l);else return l;else arcgisonline.map.main.geometryService||(arcgisonline.map.main.geometryService=new esri.tasks.GeometryService(esriGeowConfig.self.helperServices.geometry.url)),arcgisonline.map.main.geometryService.project(a,d,b.hitch(this,
function(g,m,n){if(m&&m.length===g.length){var p=[];b.forEach(m,function(q){q&&(q.rings&&0<q.rings.length&&0<q.rings[0].length&&0<q.rings[0][0].length&&!isNaN(q.rings[0][0][0])&&!isNaN(q.rings[0][0][1])||q.paths&&0<q.paths.length&&0<q.paths[0].length&&0<q.paths[0][0].length&&!isNaN(q.paths[0][0][0])&&!isNaN(q.paths[0][0][1])||q.xmin&&!isNaN(q.xmin)&&q.ymin&&!isNaN(q.ymin)||q.x&&!isNaN(q.x)&&q.y&&!isNaN(q.y))?p.push(q):p.push(null)},this);e&&e(p)}else f&&f&&f(m,n)},a),f)},clipOnHorizon:function(a){arcgisonline.map.main.contains([102113,
102100,3857],a.spatialReference.wkid)&&(a.xmin=Math.max(a.xmin,-20037507),a.xmax=Math.min(a.xmax,20037507),a.ymin=Math.max(a.ymin,-19971868),a.ymax=Math.min(a.ymax,19971868));return a},sameSpatialReference:function(a,c){var d=[102113,102100,3857];return a&&c&&esri.isDefined(a.wkid)&&esri.isDefined(c.wkid)&&arcgisonline.map.main.contains(d,a.wkid)&&arcgisonline.map.main.contains(d,c.wkid)||a&&c&&(esri.isDefined(a.wkid)&&esri.isDefined(c.wkid)&&a.wkid==c.wkid||esri.isDefined(a.latestWkid)&&esri.isDefined(c.wkid)&&
a.latestWkid==c.wkid||esri.isDefined(a.wkid)&&esri.isDefined(c.latestWkid)&&a.wkid==c.latestWkid||esri.isDefined(a.latestWkid)&&esri.isDefined(c.latestWkid)&&a.latestWkid==c.latestWkid)||a&&c&&esri.isDefined(a.wkt)&&esri.isDefined(c.wkt)&&a.wkt===c.wkt?!0:!1},sameTilingScheme:function(a,c){var d=arcgisonline.map.main.map;d=d.width>d.height?d.width:d.height;for(var e=!1,f=!1,h=0;h<a.lods.length;h++){var l=a.lods[h].scale;a.dpi!==c.dpi&&(l=a.lods[h].scale/a.dpi);for(var g=0;g<c.lods.length;g++){var m=
c.lods[g].scale;a.dpi!==c.dpi&&(m=c.lods[g].scale/c.dpi);if(Math.abs(m-l)/m<1/d)if(e){f=!0;break}else e=!0;if(m<l)break}if(f)break}return f||e&&(1===a.lods.length||1===c.lods.length)?!0:!1},sameTilingSchemeUseResolution:function(a,c){for(var d=!1,e=!1,f=0;f<a.lods.length;f++){for(var h=a.lods[f].resolution,l=0;l<c.lods.length;l++){var g=c.lods[l].resolution;if(.01>Math.abs(g-h)/g)if(d){e=!0;break}else d=!0}if(e)break}return e||d&&(1===a.lods.length||1===c.lods.length)?!0:!1},checkMapSpatialReference:function(){var a=
!1,c=!1;if(arcgisonline.map.main.map)var d=arcgisonline.map.main.map.spatialReference;else d=new esri.SpatialReference({wkid:102100}),(a=esriGeowConfig.defaultBasemap.baseMapLayers)&&a.resourceInfo&&a.resourceInfo.spatialReference&&(d=new esri.SpatialReference(a.resourceInfo.spatialReference));a=b.some(arcgisonline.map.wms._WEB_MERCATOR,function(e){return e===d.wkid});c=4326===d.wkid;return{mapIsWebMercator:a,mapIsGCS:c,mapSR:d}},updateTilingScheme:function(a,c){if(a.dpi===c)return a;for(var d=0;d<
a.lods.length;d++)a.lods[d].scale=a.lods[d].scale/a.dpi*c;a.dpi=c;return a},markMapAsChanged:function(a){arcgisonline.map.main.mapHasChanged=!0},markMapAsChangedIfOwner:function(a){a=arcgisonline.sharing.util.getUser();var c=arcgisonline.map.save_open.webMapInfo;a&&c&&(c.owner===a.username||"admin"===c.itemControl||"update"===c.itemControl)&&(arcgisonline.map.main.mapHasChanged=!0)},unmarkMapAsChanged:function(){arcgisonline.map.main.mapHasChanged=!1},signIn:function(a){a&&a.preventDefault();arcgisonline.map.storage.saveMapInCookie(null,
!0,null,null,function(){arcgisonline.map.main.signInWithPopup()})},loggedOut:function(){var a=arcgisonline.sharing.util.getUser();esriGeowConfig.self&&esriGeowConfig.self.isWebTierAuth?a||"7443"===location.port||b.style(b.byId("header_map_signin"),"display","none"):(b.removeClass(b.byId("logged-out-navigation"),"hide"),b.addClass(b.byId("logged-in-navigation"),"hide"),b.connect(b.byId("login-link"),"onclick",b.hitch(arcgisonline.map.main,"signIn")),b.query(".menu-logged-in",this.domNode).style("display",
"none"))},loggedIn:function(){var a=arcgisonline.sharing.util.getUser();esriGeowConfig.self&&esriGeowConfig.self.isWebTierAuth&&(b.style(b.byId("logged-in-signOut"),"display","none"),a&&(a.username=a.username||a.email));if(arcgisonline.sharing.util.isLoggedIn()){if(a){b.addClass(b.byId("logged-out-navigation"),"hide");b.removeClass(b.byId("logged-in-navigation"),"hide");b.attr(b.byId("username"),"innerHTML",arcgisonline.sharing.util.getUserDisplayName(a));b.attr(b.byId("username"),"title",a.fullName);
b.byId("logged-in-myProfile").innerHTML=esri.i18nBundle.siteHeader.myProfile+"\x3cbr/\x3e"+a.username;b.attr("logged-in-myProfile","title",a.fullName);a=this.allSSL||arcgisonline.sharing.util.usePortalSSL()?arcgisonline.sharing.util.getSecureUrl(esriGeowConfig.restBaseUrl):esriGeowConfig.restBaseUrl;var c=esriGeowConfig.userInfo.credential&&esriGeowConfig.userInfo.credential.token||esriGeowConfig.userInfo.token;a=esriGeowConfig.userInfo.thumbnail?a+"community/users/"+esriGeowConfig.userInfo.username+
"/info/"+esriGeowConfig.userInfo.thumbnail+"?token\x3d"+c:arcgisonline.sharing.util.relativeToExplicitUrl("js/arcgisonline/css/images/no-user-thumb.jpg");b.attr("dropdown-image","src",a);b.attr("profileImgSmall","src",a);b.query(".menu-logged-in").style("visibility","visible")}else arcgisonline.map.main.loggedOut();arcgisonline.map.main.checkTitleDiv()}else arcgisonline.map.main.loggedOut()},logOut:function(){if(arcgisonline.sharing.util.isPortal()){var a=esriGeowConfig.baseUrl+"index.html";arcgisonline.sharing.geow.Geow.signout(a)}else a=
esriGeowConfig.baseUrl+"pages/Account/manage_accounts.html#client_id\x3darcgisonline\x26signout\x3dtrue",window.location=a},openHelp:function(){var a=esriGeowConfig.help;arcgisonline.sharing.util.isPortal()&&!arcgisonline.sharing.util.isArcGISEnterpriseOnKubernetes()&&(a+="portal/");window.open(a,"_blank")},openNewMap:function(a){a&&a.preventDefault();a=esriGeowConfig.baseUrl+"webmap/viewer.html";1==arcgisonline.map.main.mapHasChanged?arcgisonline.sharing.dijit.dialog.OpenMapDlg.prototype.statics.getInstance().show(a,
null,arcgisonline.map.main.mapLayers,arcgisonline.map.main.mapTables,arcgisonline.map.save_open.webMapInfo?arcgisonline.map.save_open.webMapInfo.title:null):window.location=a},openMap:function(a){a&&a.preventDefault();a=esriGeowConfig.baseUrl+"webmap/viewer.html";1==arcgisonline.map.main.mapHasChanged?arcgisonline.sharing.dijit.dialog.OpenMapDlg.prototype.statics.getInstance().show(a,null,arcgisonline.map.main.mapLayers,arcgisonline.map.main.mapTables,arcgisonline.map.save_open.webMapInfo?arcgisonline.map.save_open.webMapInfo.title:
null):window.location=a},goToPage:function(a){arcgisonline.map.edit.editActivated&&arcgisonline.map.edit.stopEdit();arcgisonline.map.storage.saveMapInCookie(null,!0,null,null,b.hitch(this,function(){"undefined"!==typeof history.pushState&&window.history.pushState(null,null,"?useExisting\x3d1");window.location=a}))},updateHeaderPresentationLink:function(){},checkReadOnly:function(){arcgisonline.map.main.isReadOnlyMode()&&(r.byId("webmap-analysis").dropDown?(b.connect(r.byId("webmap-analysis"),"onClick",
b.hitch(arcgisonline.map.main,"readOnlyDontAllow")),b.connect(r.byId("webmap-analysis-analysis"),"onClick",b.hitch(arcgisonline.map.main,"readOnlyDontAllow")),b.connect(r.byId("webmap-analysis-history"),"onClick",b.hitch(arcgisonline.map.main,"readOnlyDontAllow"))):b.connect(r.byId("webmap-analysis"),"onMouseDown",b.hitch(arcgisonline.map.main,"readOnlyDontAllow")),b.connect(r.byId("webmap-edit"),"onClick",b.hitch(arcgisonline.map.main,"readOnlyDontAllow")),b.connect(r.byId("webmap-save"),"onClick",
b.hitch(arcgisonline.map.main,"readOnlyDontAllow")),b.connect(r.byId("webmap-save-save"),"onClick",b.hitch(arcgisonline.map.main,"readOnlyDontAllow")),b.connect(r.byId("webmap-save-saveas"),"onClick",b.hitch(arcgisonline.map.main,"readOnlyDontAllow")),b.connect(r.byId("webmap-share"),"onMouseDown",b.hitch(arcgisonline.map.main,"readOnlyDontAllow")),b.connect(r.byId("webmap-add"),"onClick",b.hitch(arcgisonline.map.main,"readOnlyDontAllow")),b.connect(r.byId("webmap-search-layers"),"onClick",b.hitch(arcgisonline.map.main,
"readOnlyDontAllow")),b.connect(r.byId("webmap-add-esri-maplayers"),"onClick",b.hitch(arcgisonline.map.main,"readOnlyDontAllow")),b.connect(r.byId("webmap-add-provisionedListings"),"onClick",b.hitch(arcgisonline.map.main,"readOnlyDontAllow")),b.connect(r.byId("webmap-add-layer-url"),"onClick",b.hitch(arcgisonline.map.main,"readOnlyDontAllow")),b.connect(r.byId("webmap-add-layer-file"),"onClick",b.hitch(arcgisonline.map.main,"readOnlyDontAllow")),b.connect(r.byId("webmap-add-mapnotes"),"onClick",b.hitch(arcgisonline.map.main,
"readOnlyDontAllow")),b.connect(r.byId("webmap-directions"),"onMouseDown",b.hitch(arcgisonline.map.main,"readOnlyDontAllow")))},readOnlyDontAllow:function(a){a.stopImmediatePropagation&&a.stopImmediatePropagation();a.stopPropagation&&a.stopPropagation();arcgisonline.sharing.dijit.dialog.GeneralDlg.prototype.statics.getInstance().show({title:esri.i18nBundle.generalDlg.errorDlgTitle,message:esriGeowConfig.self.isPortal?esri.i18nBundle.common.errors.portalInReadOnlyModeMsg:esri.i18nBundle.common.errors.onlineInReadOnlyModeMsg})},
isReadOnlyMode:function(){return!0===esriGeowConfig.self.isReadOnly},checkMinWidthOfPage:function(){r.byId("webmap-save").set("label",esri.i18nBundle.viewer.saveBtn);r.byId("webmap-print").set("label",esri.i18nBundle.viewer.printBtn);r.byId("webmap-print-templates").set("label",esri.i18nBundle.viewer.printBtn);r.byId("webmap-measure").set("label",esri.i18nBundle.viewer.measureBtn);r.byId("webmap-bookmarks").set("label",esri.i18nBundle.viewer.bookmarksBtn);r.byId("webmap-directions").set("label",esri.i18nBundle.viewer.directionsBtn);
r.byId("webmap-share").set("label",esri.i18nBundle.viewer.shareBtn);r.byId("webmap-basemap").set("label",esri.i18nBundle.viewer.basemapBtn);r.byId("webmap-add").set("label",esri.i18nBundle.viewer.addBtn);r.byId("webmap-details").set("label",esri.i18nBundle.viewer.detailsBtn);r.byId("webmap-edit").set("label",esri.i18nBundle.viewer.editBtn);r.byId("webmap-analysis").set("label",esri.i18nBundle.viewer.analysisBtn);r.byId("webmap-analysis").set("title",esri.i18nBundle.viewer.analysisBtnHover);esriGeowConfig.showAnalysisHistory&&
(r.byId("webmap-analysis-analysis").set("label",esri.i18nBundle.viewer.analysisBtn),r.byId("webmap-analysis-history").set("label",esri.i18nBundle.viewer.analysisHistory));if(!b.isIE||9<=b.isIE)b.byId("webmap-save_label").style.removeProperty("padding"),b.byId("webmap-add_label").style.removeProperty("padding"),b.byId("webmap-print-templates_label").style.removeProperty("padding");var a=function(){var h=b.coords(b.byId("webmap-toolbar-leftCorner")).w,l=b.coords(b.byId("webmap-toolbar-rightCorner")).w,
g=b.coords(b.byId("webmap-toolbar-right")).w,m=b.coords(b.byId("webmap-toolbar-left")).w,n=b.style(b.byId("webmap-save"),"width"),p=b.style(b.byId("webmap-share"),"width");var q="none"!==b.style(r.byId("webmap-print").domNode,"display")?b.style(b.byId("webmap-print"),"width"):b.style(b.byId("webmap-print-templates"),"width");var t=b.style(b.byId("webmap-directions"),"width"),v=b.style(b.byId("webmap-measure"),"width"),u=b.style(b.byId("webmap-bookmarks"),"width");n=n+p+q+t+v+u+75;p=b.style(b.byId("toolbar"),
esriGeowConfig.isRightToLeft?"right":"left");q=0;"auto"!==b.style(b.byId("toolbar"),esriGeowConfig.isRightToLeft?"left":"right")&&(esriGeowConfig.isRightToLeft?p=parseInt(b.style(b.byId("toolbar"),"left")):q=parseInt(b.style(b.byId("toolbar"),"right")));return Math.max(400,p+h+m+n+g+l+q)+15},c=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth||600,d=56;arcgisonline.map.geocode.geocoder&&arcgisonline.map.geocode.geocoder.sources&&1<arcgisonline.map.geocode.geocoder.sources.length&&
(d+=26);if(b.query(".searchGroup","locationDiv").length){var e=250,f=b.query(".searchGroup","locationDiv")[0];b.style(b.query(".searchGroup input","locationDiv")[0],"width",e-d+"px");b.style(f,"width",e+"px");b.style(b.query(".webmapToolbarRight")[0],"width",e+10+"px");f.style.display="none";f.offsetHeight;f.style.display="block"}e=function(h){9>b.isIE&&(h=b.create("div",{innerHTML:"x",style:"visibility: hidden; height: 1px;"}),b.place(h,"webmap-toolbar-center","first"),setTimeout(b.hitch(this,function(l){b.byId("webmap-toolbar-center").removeChild(l)},
h),1))};f=a();c<f&&("none"!==b.style(r.byId("webmap-print").domNode,"display")?(r.byId("webmap-print").set("label",""),e("webmap-print")):(r.byId("webmap-print-templates").set("label",""),b.style(b.byId("webmap-print-templates_label"),"padding",0),e("webmap-print-templates")),f=a(),c<f&&(r.byId("webmap-save").set("label",""),b.style(b.byId("webmap-save_label"),"padding",0),e("webmap-save"),f=a(),c<f&&(r.byId("webmap-measure").set("label",""),e("webmap-measure"),f=a(),c<f&&(r.byId("webmap-bookmarks").set("label",
""),e("webmap-bookmarks"),f=a(),c<f&&(r.byId("webmap-directions").set("label",""),e("webmap-directions"),f=a(),c<f&&(r.byId("webmap-share").set("label",""),e("webmap-share"),f=a(),c<f&&(r.byId("webmap-basemap").set("label",""),e("webmap-basemap"),f=a(),c<f&&(r.byId("webmap-add").set("label",""),b.style(b.byId("webmap-add_label"),"padding",0),e("webmap-add"),f=a(),c<f&&(r.byId("webmap-details").set("label",""),e("webmap-details"),f=a(),c<f&&(r.byId("webmap-edit").set("label",""),e("webmap-edit"),f=
a(),c<f&&(r.byId("webmap-analysis").set("label",""),e("webmap-analysis"),f=a())))))))))));b.query(".searchGroup","locationDiv").length&&(e=250,150<c-f?e=400:100<c-f?e=350:50<c-f&&(e=300),b.style(b.query(".searchGroup input","locationDiv")[0],"width",e-d+"px"),b.style(b.query(".searchGroup","locationDiv")[0],"width",e+"px"),b.style(b.query(".webmapToolbarRight")[0],"width",e+10+"px"),f=a());b.style(b.byId("page-border"),"minWidth")!=f&&b.style(b.byId("page-border"),"minWidth",f+"px");b.style(b.byId("webmap-toolbar-center"),
"visibility","visible");arcgisonline.map.leftPanel.calculateLeftPanelDefaultWidth();b.style(b.byId("main-content"),"width",c+"px");r.byId("page-border").resize();arcgisonline.map.main.checkTitleDiv()},checkUnsupportedRendererType:function(a){var c={type:"simple",symbol:{color:[77,77,77,255],size:6,angle:0,xoffset:0,yoffset:0,type:"esriSMS",style:"esriSMSCircle",outline:{color:[255,255,255,255],width:.75,type:"esriSLS",style:"esriSLSSolid"}}};9>b.isIE&&(a.layerDefinition&&a.layerDefinition.drawingInfo&&
a.layerDefinition.drawingInfo.renderer&&"heatmap"===a.layerDefinition.drawingInfo.renderer.type?a.layerDefinition.drawingInfo.renderer=c:!(a.layerDefinition&&a.layerDefinition.drawingInfo&&a.layerDefinition.drawingInfo.renderer)&&a.serviceInfo&&a.serviceInfo.drawingInfo&&a.serviceInfo.drawingInfo.renderer&&"heatmap"===a.serviceInfo.drawingInfo.renderer.type&&(a.serviceInfo.drawingInfo.renderer=c))},isNewRendererType_2_1:function(a){if(a.layer&&a.layer.renderer){var c=a.layer.renderer;if("esri.renderer.UniqueValueRenderer"==
c.declaredClass&&a.layer.fields&&c.attributeField){a=a.layer.fields;for(var d=0;d<a.length;d++)if(a[d].name===c.attributeField)if("esriFieldTypeDate"!==a[d].type&&(!c.visualVariables||c.visualVariables&&1===c.visualVariables.length&&"sizeInfo"===c.visualVariables[0].type&&"outline"===c.visualVariables[0].target))break;else return!0}else if("esri.renderer.HeatmapRenderer"==c.declaredClass||c.visualVariables)return"esri.renderer.HeatmapRenderer"!==c.declaredClass&&1===c.visualVariables.length&&"sizeInfo"===
c.visualVariables[0].type&&"outline"===c.visualVariables[0].target?!1:!0}return!1},reloadViewerSecureIdMgr:function(a){arcgisonline.map.main.reloadViewerSecure(a.resourceUrl,esri.i18nBundle.viewer.main.reloadForSSLLogin)},reloadViewerSecureSSL:function(a){arcgisonline.map.main.reloadViewerSecure(a,esri.i18nBundle.viewer.main.reloadForSSL)},reloadViewerSecure:function(a,c){if(arcgisonline.map.main.mapHasChanged){var d=function(){window.location=esriGeowConfig.baseUrl.replace("http://","https://")+
esriGeowConfig.webmapViewerPath+"?useExisting\x3d1"};a=function(){arcgisonline.map.storage.saveMapInCookie(null,!0,null,null,b.hitch(this,d))};var e=arcgisonline.sharing.dijit.dialog.ChoiceDlg.prototype.statics.getInstance();e.show({title:esri.i18nBundle.viewer.main.reload,message:c,choiceOneTitle:esri.i18nBundle.common.yesLabel,choiceOneHandler:b.hitch(this,a),choiceTwoTitle:esri.i18nBundle.common.noLabel,choiceTwoHandler:function(){}})}else a=arcgisonline.sharing.util.urlToObject(document.URL),
a.query=a.query||{},a.query.webmap||a.query.layers||a.query.services||a.query.featurecollection||a.query.url||a.query.urls||a.query.basemapUrl?window.location=window.location.href.replace("http://","https://"):(a=function(){window.location=document.URL.replace("http://","https://")},e=arcgisonline.sharing.dijit.dialog.ChoiceDlg.prototype.statics.getInstance(),e.show({title:esri.i18nBundle.viewer.main.reload,message:c,choiceOneTitle:esri.i18nBundle.common.yesLabel,choiceOneHandler:b.hitch(this,a),
choiceTwoTitle:esri.i18nBundle.common.noLabel,choiceTwoHandler:function(){}}))},showBasemapGallery:function(){arcgisonline.map.main.hideDropdowns("basemapGallery");r.byId("basemap-gallery").groupQuery=esriGeowConfig.self.useVectorBasemaps?encodeURIComponent(esriGeowConfig.self.vectorBasemapGalleryGroupQuery):encodeURIComponent(esriGeowConfig.basemapGalleryGroupQuery);r.byId("basemap-gallery").open()},showMeasureTool:function(){arcgisonline.map.popup.disablePopupHandler();b.byId("measureToolDiv")||
b.place(b.create("div",{id:"measureToolDiv"}),"measureDiv","last");if("block"==b.style(b.byId("measureDiv"),"display"))arcgisonline.map.main.hideMeasureTool();else{arcgisonline.map.main.hideDropdowns();arcgisonline.map.main.map.infoWindow.hide();var a=b.coords(b.byId("webmap-measure"));esriGeowConfig.isRightToLeft?b.style(b.byId("measureDiv"),"left",a.x+a.w-318+"px"):b.style(b.byId("measureDiv"),"left",a.x-4+"px");b.style(b.byId("measureDiv"),"display","block");b.style(b.byId("measureDiv"),"top",
a.y+a.h+3+"px");arcgisonline.map.main.measureTool||(a=esri.symbol.fromJson({name:"Circle",type:"esriSMS",style:"esriSMSCircle",color:[255,255,255,204],size:6,outline:{color:[102,102,102,255],width:1}}),arcgisonline.map.main.measureTool=new esri.dijit.Measurement({map:arcgisonline.map.main.map,id:"measureTool",pointSymbol:a,defaultAreaUnit:"english"===arcgisonline.map.main.scaleBarUnits?esri.Units.SQUARE_MILES:esri.Units.SQUARE_KILOMETERS,defaultLengthUnit:"english"===arcgisonline.map.main.scaleBarUnits?
esri.Units.MILES:esri.Units.KILOMETERS},"measureToolDiv"),arcgisonline.map.main.measureTool.startup());arcgisonline.map.main.measureTool.setTool("area",!0);arcgisonline.map.main.measureActivated=!0;arcgisonline.map.geocodeReview.geocodeMatchWidget&&arcgisonline.map.geocodeReview.geocodeMatchWidget.pauseMapEvents();arcgisonline.map.main.map.activeDirectionsWidget&&arcgisonline.map.main.map.activeDirectionsWidget.active?(arcgisonline.map.main.activeDirectionsWidgetIsActive=!0,arcgisonline.map.main.map.activeDirectionsWidget.deactivate()):
arcgisonline.map.main.activeDirectionsWidgetIsActive=!1}},hideMeasureTool:function(a){arcgisonline.map.main.measureTool&&(arcgisonline.map.main.measureTool.clearResult(),b.style(b.byId("measureDiv"),"display","none"),arcgisonline.map.main.measureTool.activeTool&&arcgisonline.map.main.measureTool.setTool(arcgisonline.map.main.measureTool.activeTool,!1),arcgisonline.map.main.measureActivated=!1,arcgisonline.map.popup.setupPopupHandler(),arcgisonline.map.geocodeReview.geocodeMatchWidget&&"geocodeStack"===
arcgisonline.map.leftPanel.getLeftContentPanelStack()&&arcgisonline.map.geocodeReview.geocodeMatchWidget.resumeMapEvents(),arcgisonline.map.main.map.activeDirectionsWidget&&"directionsStack"==arcgisonline.map.leftPanel.getLeftContentPanelStack()&&arcgisonline.map.main.activeDirectionsWidgetIsActive&&arcgisonline.map.main.map.activeDirectionsWidget.activate(),"closeIcon"!==a&&"onOtherOpen"!==a||r.byId("webmap-measure").set("checked",!1))},destroyMeasureTool:function(a){arcgisonline.map.main.measureTool&&
(arcgisonline.map.main.measureTool.destroy(),arcgisonline.map.main.measureTool=null)},initBookmarks:function(){if(!arcgisonline.map.main.bookmarksTool){var a=[];arcgisonline.map.save_open.openedWebMap&&arcgisonline.map.save_open.openedWebMap.bookmarks&&(a=arcgisonline.map.save_open.openedWebMap.bookmarks);arcgisonline.map.main.bookmarksTool=new esri.dijit.Bookmarks({map:arcgisonline.map.main.map,bookmarks:a,editable:!0,id:"bookmarksTool"},"bookmarksToolDiv");arcgisonline.map.role.checkBookmarksToolOptions();
b.connect(arcgisonline.map.main.bookmarksTool,"onClick",b.hitch(this,arcgisonline.map.main.hideBookmarksTool,"onBookmarkClick"));b.connect(arcgisonline.map.main.bookmarksTool,"onEdit",function(){arcgisonline.map.main.markMapAsChanged("onBookmarkEdit")});b.connect(arcgisonline.map.main.bookmarksTool,"onRemove",function(){arcgisonline.map.main.markMapAsChanged("onBookmarkRemove")})}},showBookmarksTool:function(){if("block"==b.style(b.byId("bookmarksDiv"),"display"))arcgisonline.map.main.hideBookmarksTool();
else{arcgisonline.map.main.hideDropdowns();var a=b.coords(b.byId("webmap-bookmarks"));esriGeowConfig.isRightToLeft?b.style(b.byId("bookmarksDiv"),"left",a.x+a.w-242+"px"):b.style(b.byId("bookmarksDiv"),"left",a.x-4+"px");b.style(b.byId("bookmarksDiv"),"display","block");b.style(b.byId("bookmarksDiv"),"top",a.y+a.h+3+"px")}},hideBookmarksTool:function(a){b.style(b.byId("bookmarksDiv"),"display","none");"closeIcon"!==a&&"onBookmarkClick"!==a&&"onOtherOpen"!==a||r.byId("webmap-bookmarks").set("checked",
!1)},projectBookmarks:function(){if(arcgisonline.map.main.bookmarksTool&&0<arcgisonline.map.main.bookmarksTool.bookmarks.length){var a=arcgisonline.map.main.map.extent.spatialReference,c=arcgisonline.map.main.bookmarksTool.bookmarks[0].extent.spatialReference;if(!arcgisonline.map.main.sameSpatialReference(a,c)){var d=function(h){var l=[];b.forEach(arcgisonline.map.main.bookmarksTool.bookmarks,function(n,p){null!==h[p]&&(n=new esri.dijit.BookmarkItem({name:n.name,extent:h[p]}),l.push(n))});for(var g=
arcgisonline.map.main.bookmarksTool.bookmarks.length-1;0<=g;g--){var m=arcgisonline.map.main.bookmarksTool.bookmarks[g];m&&arcgisonline.map.main.bookmarksTool.removeBookmark(m.name)}b.forEach(l,function(n){arcgisonline.map.main.bookmarksTool.addBookmark(n)})},e=function(h,l){},f=[];b.forEach(arcgisonline.map.main.bookmarksTool.bookmarks,function(h){f.push(h.extent)});arcgisonline.map.main.projectGeometries(f,c,a,b.hitch(this,d),b.hitch(this,function(h,l,g,m,n){arcgisonline.map.main.projectGeometries(h,
l,g,b.hitch(this,d),b.hitch(this,e))},f,c,a))}}},hideDropdowns:function(a){"basemapGallery"!=a&&r.byId("basemap-gallery").hide();"block"==b.style(b.byId("bookmarksDiv"),"display")&&arcgisonline.map.main.hideBookmarksTool("onOtherOpen");"block"==b.style(b.byId("measureDiv"),"display")&&arcgisonline.map.main.hideMeasureTool("onOtherOpen")},truncate:function(a){return Math.round(1E4*a)/1E4},getValue:function(a,c){var d=a.indexOf("\x26"+c+"\x3d",0);-1==d&&(d=a.indexOf("?"+c+"\x3d",0));if(-1==d)return-1;
var e=a.indexOf("\x26",d+2);-1==e&&(e=a.length);return a.substring(d+c.length+2,e)},showObjectProperties:function(a){var c="",d;for(d in a)c+=d+":"+a[d]+"\n";alert(""+c)},getGCSString:function(){var a=new b.Deferred,c=arcgisonline.map.main.map.extent;c.spatialReference._isWrappable()?esri.geometry.normalizeCentralMeridian([c],null,b.hitch(this,function(d){if(d[0].rings){var e=(new esri.geometry.Polygon(c.spatialReference)).addRing(d[0].rings[0]).getExtent();d=(new esri.geometry.Polygon(c.spatialReference)).addRing(d[0].rings[1]).getExtent();
c=e.getWidth()>d.getWidth()?e:d}else c=d[0];arcgisonline.map.main.extentToGCSString(c,function(f){a.callback(f)})})):arcgisonline.map.main.mapExtentToGCSString(function(d){a.callback(d)});return a},mapExtentToGCSString:function(a){arcgisonline.map.main.extentToGCSString(arcgisonline.map.main.map.extent,a)},extentToGCSString:function(a,c){arcgisonline.map.main.sameSpatialReference(a.spatialReference,new esri.SpatialReference({wkid:4326}))?c(arcgisonline.map.main.extentToString(a)):arcgisonline.map.main.projectExtent(a,
new esri.SpatialReference({wkid:4326}),b.hitch(this,function(d,e){if(-180===d[0].xmin&&180===d[0].xmax)if(e=arcgisonline.map.main.checkMapSpatialReference(),e.mapIsWebMercator||e.mapIsGCS)c(arcgisonline.map.main.extentToString(d[0]));else if(a.spatialReference.wkid&&-1<b.indexOf([5936,3031],a.spatialReference.wkid))c(arcgisonline.map.main.extentToString(d[0]));else{e=(d[0].ymin+d[0].ymax)/2;var f=[];f.push(new esri.geometry.Point(-180,e,new esri.SpatialReference({wkid:4326})));f.push(new esri.geometry.Point(180,
e,new esri.SpatialReference({wkid:4326})));var h=function(l,g){c(arcgisonline.map.main.extentToString(d[0]))};arcgisonline.map.main.projectJsonGeometries(f,"esriGeometryPoint",new esri.SpatialReference({wkid:4326}),a.spatialReference,b.hitch(this,function(l,g){if(.001>Math.abs(l[0].x-l[1].x)){var m=l[0].x-arcgisonline.map.main.map.extent.xmin,n=arcgisonline.map.main.map.extent.xmax-l[0].x;l=(a.ymin+a.ymax)/2;f=[];f.push(new esri.geometry.Point(a.xmin,l,a.spatialReference));f.push(new esri.geometry.Point(a.xmax,
l,a.spatialReference));arcgisonline.map.main.projectJsonGeometries(f,"esriGeometryPoint",a.spatialReference,new esri.SpatialReference({wkid:4326}),b.hitch(this,function(p,q){p=m>n?new esri.geometry.Extent(p[0].x,d[0].ymin,d[0].xmax,d[0].ymax,new esri.SpatialReference({wkid:4326})):new esri.geometry.Extent(d[0].xmin,d[0].ymin,p[1].x,d[0].ymax,new esri.SpatialReference({wkid:4326}));c(arcgisonline.map.main.extentToString(p))}),b.hitch(this,h))}else c(arcgisonline.map.main.extentToString(d[0]))}),b.hitch(this,
h))}else c(arcgisonline.map.main.extentToString(d[0]))}),b.hitch(this,function(d,e){c(null)}))},extentToString:function(a){return arcgisonline.map.main.extentToString2(a,1E4)},extentToString2:function(a,c){return null!=a?arcgisonline.map.main.roundValue(a.xmin,c)+","+arcgisonline.map.main.roundValue(a.ymin,c)+","+arcgisonline.map.main.roundValue(a.xmax,c)+","+arcgisonline.map.main.roundValue(a.ymax,c):""},roundExtent:function(a,c){return new esri.geometry.Extent(arcgisonline.map.main.roundValue(a.xmin,
c),arcgisonline.map.main.roundValue(a.ymin,c),arcgisonline.map.main.roundValue(a.xmax,c),arcgisonline.map.main.roundValue(a.ymax,c),new esri.SpatialReference(a.spatialReference.toJson()))},buildExportCall:function(a,c,d,e,f,h,l,g,m){if(!g&&-1<a.indexOf("/MapServer/")){h=a.indexOf("/MapServer/");g=a.indexOf("?");if(-1<g){var n=a.substring(h+11,g);a=a.substring(0,h+10)+a.substring(g)}else n=a.substring(h+11),a=a.substring(0,h+10);g=n}n=-1<a.indexOf("/MapServer");!n&&m&&(n=m.capabilities?-1<m.capabilities.toLowerCase().indexOf("map"):
m.supportedImageFormatTypes);h=a.indexOf("?");if(-1==h)if(n)a+="/export?";else{if("undefined"!==typeof m.currentVersion&&10.1<=m.currentVersion)return a+"/info/thumbnail";a+="/exportImage?"}else if(n)a=a.substring(0,h)+"/export"+a.substring(h,a.length)+"\x26";else{if("undefined"!==typeof m.currentVersion&&10.1<=m.currentVersion)return a=a.substring(0,h)+"/info/thumbnail"+a.substring(h,a.length);a=a.substring(0,h)+"/exportImage"+a.substring(h,a.length)+"\x26"}a+="size\x3d"+f+"\x26bbox\x3d"+c;null!==
d&&0<d.length&&(a+="\x26bboxSR\x3d"+d);null!==e&&0<e.length&&(a+="\x26imageSR\x3d"+e);a=n&&m&&m.supportedImageFormatTypes&&-1<m.supportedImageFormatTypes.indexOf("PNG32")?a+("\x26format\x3dpng32\x26f\x3d"+l):n?a+("\x26format\x3dpng24\x26f\x3d"+l):a+("\x26format\x3djpgpng\x26f\x3d"+l);n?null!==g&&0<g.length&&(a+="\x26layers\x3dshow:"+g):a+="\x26interpolation\x3dRSP_NearestNeighbor\x26bandIds\x3dnull";return a},getPrintExtra:function(a,c,d,e){a=-1<a.indexOf("/MapServer");!a&&e&&(a=e.capabilities?-1<
e.capabilities.toLowerCase().indexOf("map"):e.supportedImageFormatTypes);var f="";a?null!=d&&0<d.length&&(f+="\x26layers\x3dshow:"+d):(f+="\x26pixelType\x3dU8\x26interpolation\x3dRSP_NearestNeighbor",null!=c?f+="\x26bandIds\x3d"+c.toString():e&&e.bandCount&&3<parseInt(e.bandCount)&&(f+="\x26bandIds\x3d0,1,2"));return f},buildExportLayers:function(a){var c=a.layer.layerInfos;arcgisonline.map.main.hasDynamicLayers(a)&&(c=a.itemLayers);return arcgisonline.map.main.filterSubLayers(c,a.visibleLayers)},
buildExportLayersByServiceInfo:function(a,c){return arcgisonline.map.main.filterSubLayers(a.layers,c)},filterSubLayers:function(a,c){if(null==a||null==c||0==c.length)return[];c=","+c+",";for(var d=[],e=",",f=0;f<a.length;f++)if(null!=a[f].subLayerIds){if(-1==c.indexOf(","+a[f].id+",")||-1<e.indexOf(","+a[f].id+","))e+=a[f].subLayerIds.toString()+","}else-1<c.indexOf(","+a[f].id+",")&&-1==e.indexOf(","+a[f].id+",")&&d.push(a[f].id);return d},addGroupLayers:function(a,c){if(null==a||null==c||0==c.length)return[];
var d=function(g,m){for(var n=0;n<g.length;n++)if(g[n].id===m)return{parentLayerId:g[n].parentLayerId,subLayerIds:g[n].subLayerIds};return{parentLayerId:-1,subLayerIds:null}},e=[];""!==c&&(e=c.split(","));e=b.map(e,function(g){return parseInt(g)});c=[];for(var f=0;f<e.length;f++){var h=e[f];-1==b.indexOf(c,h)&&c.push(h);h=d(a,h);for(var l=h.parentLayerId;-1<l;)-1==b.indexOf(c,l)&&c.push(l),l=d(a,l).parentLayerId;(h=h.subLayerIds)&&h.length&&b.forEach(h,function(g){-1==b.indexOf(e,g)&&e.push(g)})}c=
c.sort(function(g,m){return g==m?0:g<m?-1:1});return c.toString()},getParameterList:function(a){for(var c=0;c<arcgisonline.map.main.mapLayers.length;c++){var d=arcgisonline.map.main.mapLayers[c];if(d.layers)for(var e=0;e<d.layers.length;e++){if(a.id==d.layers[e].id)return d}else{if(a.id==d.id)return d;if(d.layer instanceof esri.layers.GeoRSSLayer){var f=d.layer.getFeatureLayers();for(e=0;e<f.length;e++)if(a.id==f[e].id)return d}}}return null},getParameterListById:function(a){for(var c=0;c<arcgisonline.map.main.mapLayers.length;c++){var d=
arcgisonline.map.main.mapLayers[c];if(a==d.id)return d}for(c=0;c<arcgisonline.map.main.mapTables.length;c++)if(d=arcgisonline.map.main.mapTables[c],a==d.id)return d;return null},getParameterListsByUrl:function(a){for(var c=[],d=0;d<arcgisonline.map.main.mapLayers.length;d++){var e=arcgisonline.map.main.mapLayers[d];a==e.url&&c.push(e)}for(d=0;d<arcgisonline.map.main.mapTables.length;d++)e=arcgisonline.map.main.mapTables[d],a==e.url&&c.push(e);return c.length?c:null},isWebMapLayer:function(a){var c=
!1,d=arcgisonline.map.save_open.openedWebMap;d&&(b.forEach(d.operationalLayers,function(e){e.id===a.id&&(c=!0)}),b.forEach(d.baseMap.baseMapLayers,function(e){e.id===a.id&&(c=!0)}));return c},hasMSForFS:function(a){if(!a.url)return!1;var c=a.url,d=c.indexOf("/FeatureServer");if(-1<d&&a.serviceInfo.capabilities&&-1<a.serviceInfo.capabilities.toLowerCase().indexOf("editing")&&(!a.serviceInfo.advancedQueryCapabilities||!a.serviceInfo.advancedQueryCapabilities.supportsLod))for(c=c.substring(0,d+1),d=
0;d<arcgisonline.map.main.mapLayers.length;d++){var e=arcgisonline.map.main.mapLayers[d];if(e.url&&-1<e.url.indexOf(c)&&-1<e.url.indexOf("/MapServer")&&e.layer instanceof esri.layers.ArcGISDynamicMapServiceLayer)return a.showLegend=!1,!0}return!1},getMSForFS:function(a){if(a.url){var c=a.url,d=c.indexOf("/FeatureServer");if(-1<d&&a.serviceInfo.capabilities&&-1<a.serviceInfo.capabilities.toLowerCase().indexOf("editing")&&(!a.serviceInfo.advancedQueryCapabilities||!a.serviceInfo.advancedQueryCapabilities.supportsLod))for(a=
c.substring(0,d+1),c=0;c<arcgisonline.map.main.mapLayers.length;c++)if(d=arcgisonline.map.main.mapLayers[c],d.url&&-1<d.url.indexOf(a)&&-1<d.url.indexOf("/MapServer")&&d.layer instanceof esri.layers.ArcGISDynamicMapServiceLayer)return d}},recreateFLsForMS:function(a,c){if(a.url){a=a.url;var d=a.indexOf("/MapServer");if(-1<d)for(a=a.substring(0,d+1),d=0;d<arcgisonline.map.main.mapLayers.length;d++){var e=arcgisonline.map.main.mapLayers[d];!(e.url&&-1<e.url.indexOf(a)&&-1<e.url.indexOf("/FeatureServer/")&&
e.layer&&e.layer.isEditable())||e.serviceInfo.advancedQueryCapabilities&&e.serviceInfo.advancedQueryCapabilities.supportsLod||e.layer.mode===c||(arcgisonline.map.layer.recreateFL(e,c),c===esri.layers.FeatureLayer.MODE_SELECTION?e.showLegend=!1:delete e.showLegend)}}},switchFlsForMS:function(a){if(a.url){var c=a.url,d=c.indexOf("/MapServer");if(-1<d&&a.layer instanceof esri.layers.ArcGISDynamicMapServiceLayer){c=c.substring(0,d+1);for(var e=0;e<arcgisonline.map.main.mapLayers.length;e++){var f=arcgisonline.map.main.mapLayers[e];
if(f.url&&-1<f.url.indexOf(c)&&-1<f.url.indexOf("/FeatureServer/")&&f.layer&&f.layer instanceof esri.layers.FeatureLayer&&f.layer.mode===esri.layers.FeatureLayer.MODE_SELECTION)if(a.layer.visible){d=f.url.indexOf("/FeatureServer/");var h=f.url.indexOf("?");-1==h&&(h=f.url.lengthl);d=f.url.substring(d+15,h);-1<b.indexOf(a.layer.visibleLayers,d)?f.layer.show():f.layer.hide()}else f.layer.hide()}}}},getFlForMSL:function(a,c){if(a.url){var d=a.url,e=d.indexOf("/MapServer");if(-1<e&&a.layer instanceof
esri.layers.ArcGISDynamicMapServiceLayer)for(a=d.substring(0,e+1),d=0;d<arcgisonline.map.main.mapLayers.length;d++)if(e=arcgisonline.map.main.mapLayers[d],e.url&&-1<e.url.indexOf(a+"FeatureServer/"+c)&&e.layer&&e.layer.mode===esri.layers.FeatureLayer.MODE_SELECTION)return e;return null}},hasMSaFl:function(a){if(a.url){var c=a.url,d=c.indexOf("/MapServer");if(-1<d&&a.layer instanceof esri.layers.ArcGISDynamicMapServiceLayer)for(a=c.substring(0,d+1),c=0;c<arcgisonline.map.main.mapLayers.length;c++)if(d=
arcgisonline.map.main.mapLayers[c],d.url&&-1<d.url.indexOf(a)&&-1<d.url.indexOf("/FeatureServer/")&&d.layer&&d.layer.mode===esri.layers.FeatureLayer.MODE_SELECTION)return!0;return!1}},containsLayerInfo:function(a,c){for(var d=0;d<a.layers.length;d++)if(a.layers[d]&&a.layers[d].id===c)return a.layers[d];return null},getLayerInfoForQuery:function(a,c,d){var e=new b.Deferred;if(arcgisonline.map.featColl.isFeatureCollection(a)&&a.layer instanceof esri.layers.WMSLayer)return e.errback(),e;var f=!1;if(a.queryServiceUrl)if(a.queryLayersInfo)if("Table"===
a.layer.type){var h=a.url.toLowerCase().indexOf("/mapserver/");-1<h&&(c=parseInt(a.url.substring(h+11)));b.forEach(a.queryLayersInfo.tables,function(m){m.id===c&&(m.url=a.queryServiceUrl,e.callback(m))})}else b.forEach(a.queryLayersInfo.layers,function(m){m.id===c&&(m.url=a.queryServiceUrl,e.callback(m))});else h=function(m,n){"Table"===a.layer.type?(m=a.url.toLowerCase().indexOf("/mapserver/"),-1<m&&(c=parseInt(a.url.substring(m+11))),b.forEach(a.queryLayersInfo.tables,function(p){p.id===c&&(p.url=
a.queryServiceUrl,e.callback(p))})):b.forEach(a.queryLayersInfo.layers,function(p){p.id===c&&(p.url=a.queryServiceUrl,e.callback(p))})},arcgisonline.map.main.getQueryLayersInfo(a,b.hitch(this,h));else!a.identify&&a.layer instanceof esri.layers.ArcGISTiledMapServiceLayer&&a.itemLayers&&b.forEach(a.itemLayers,function(m){if(m.id===c)if(m._layerInfo)f=!0,a.layersInfo=a.layersInfo||{},a.layersInfo.layers=a.layersInfo.layers||[],a.layersInfo.layers[c]||(a.layersInfo.layers[c]=m._layerInfo),m._layerInfo.url=
m.layerUrl,e.callback(m._layerInfo);else if(m.layerUrl){f=!0;var n=!1,p;a.layersInfo&&a.layersInfo.layers&&(n=b.some(a.layersInfo.layers,function(q){p=q;return q.id===m.id}));n?(p.url=m.layerUrl,e.callback(p)):arcgisonline.map.main.getJson(m.layerUrl,b.hitch(this,function(q,t){a.layersInfo=a.layersInfo||{};a.layersInfo.layers=a.layersInfo.layers||[];m._layerInfo=q;q.tileSvcLayerId=m.id;a.layersInfo.layers.push(q);q.url=m.layerUrl;e.callback(q)}),b.hitch(this,function(q,t){e.errback()}))}},this);if(!a.queryServiceUrl&&
!f)if(a.layer){h=!1;var l=arcgisonline.map.main.getFlForMSL(a,c);if(l)return h=!0,g=l.serviceInfo,g.url=l.layer.url,e.callback(g),e;if(a.layersInfo&&(a.layersInfo.layers||a.layersInfo.tables)){var g=arcgisonline.map.main.containsLayerInfo(a.layersInfo,c);g&&(h=!0,g.url=a.layer.url,e.callback(g))}h||(10.01<=a.layer.version&&a.itemId&&(a.layer instanceof esri.layers.ArcGISTiledMapServiceLayer||a.layer instanceof esri.layers.FeatureLayer&&"Table"===a.layer.type)&&(arcgisonline.sharing.util.isHostedService(a.url)||
arcgisonline.sharing.util.portalSupportsHostedServices()&&-1<b.indexOf(a.itemCard.typeKeywords,"Hosted Service"))?arcgisonline.map.main.getServiceToServiceFS(a,function(){var m=function(n,p){"Table"===a.layer.type?(n=a.url.toLowerCase().indexOf("/mapserver/"),-1<n&&(c=parseInt(a.url.substring(n+11))),b.forEach(a.queryLayersInfo.tables,function(q){q.id===c&&(q.url=a.layer.url,e.callback(q))})):b.forEach(a.queryLayersInfo.layers,function(q){q.id===c&&(q.url=a.layer.url,e.callback(q))})};a.queryLayersInfo?
m():arcgisonline.map.main.getQueryLayersInfo(a,b.hitch(this,m),b.hitch(this,function(){e.errback()}))},function(){e.errback()}):10<=a.layer.version?a.layersInfo||a.thematicGroup?(d=function(m,n,p){b.filter(a.layersInfo.layers,function(q){return q.id===c}).length||a.layersInfo.layers.push(n);n.url=m;e.callback(n)},l=function(m,n){e.errback()},g=a.url,h=g.indexOf("?"),g=-1==h?g+("/"+c):g.substring(0,h)+"/"+c+layersUrl.substring(h,layersUrl.length),arcgisonline.map.main.getJson(g,b.hitch(this,d,g),b.hitch(this,
l))):a.layer.capabilities.toLowerCase&&-1===a.layer.capabilities.toLowerCase().indexOf("query")?(a.layersInfo={},a.layersInfo.layers=[],e.errback()):(h=function(m,n){b.forEach(a.layersInfo.layers,function(p){p.id===c&&(p.url=a.layer.url,e.callback(p))})},arcgisonline.map.main.getLayersInfo(a,b.hitch(this,h))):!a.identify||d?e.errback():(d=function(m,n,p){a.layersInfo=a.layersInfo||{};a.layersInfo.layers=a.layersInfo.layers||[];a.layersInfo.layers.push(n);b.forEach(a.layersInfo.layers,function(q){q.id===
c&&(q.url=m,e.callback(q))})},l=function(m,n){e.errback()},g=a.url,h=g.indexOf("?"),g=-1==h?g+("/"+c):g.substring(0,h)+"/"+c+layersUrl.substring(h,layersUrl.length),arcgisonline.map.main.getJson(g,b.hitch(this,d,g),b.hitch(this,l))))}else e.errback();return e},getLayerInfoForQueryFromUrl:function(a,c,d,e){if(c&&c.capabilities&&-1<c.capabilities.toLowerCase().indexOf("map"))if(-1===c.capabilities.toLowerCase().indexOf("query"))e({layers:[]});else{var f=a;a=f.indexOf("?");f=-1==a?f+"/layers":f.substring(0,
a)+"/layers"+f.substring(a,f.length);arcgisonline.map.main.getJson(f,b.hitch(this,function(h,l){e(h)}))}else c=a,a=c.indexOf("?"),c=-1==a?c+("/"+d):c.substring(0,a)+"/"+d+f.substring(a,f.length),arcgisonline.map.main.getJson(c,b.hitch(this,function(h,l){l={layers:[]};l.layers.push(h);e&&e(l)}),b.hitch(this,function(h,l){e({layers:[]})}))},getLayersInfo:function(a,c){if(a.layersInfo)c(a.layersInfo);else if(!a.layer||10>a.layer.version||a.thematicGroup)a.layersInfo={layers:[]},c(a.layersInfo);else if(a.layersInfoInProgress)setTimeout(b.hitch(this,
function(f,h){arcgisonline.map.main.getLayersInfo(f,h)},a,c),500);else{a.layersInfoInProgress=!0;var d=a.url,e=d.indexOf("?");d=-1==e?d+"/layers":d.substring(0,e)+"/layers"+d.substring(e,d.length);arcgisonline.map.main.getJson(d,b.hitch(this,function(f,h){delete a.layersInfoInProgress;a.layersInfo=f;c(f)}),b.hitch(this,function(){delete a.layersInfoInProgress;a.layersInfo={layers:[]};c(a.layersInfo)}))}},getQueryLayersInfo:function(a,c,d){d=function(h,l){d()};var e=a.queryServiceUrl,f=e.indexOf("?");
e=-1==f?e+"/layers":e.substring(0,f)+"/layers"+e.substring(f,e.length);arcgisonline.map.main.getJson(e,b.hitch(this,function(h,l){a.queryLayersInfo=h;c(h,l)}),b.hitch(this,d))},getLayerInfo:function(a,c){var d=new b.Deferred,e=null;a.itemLayers&&b.forEach(a.itemLayers,function(n){n.id===c&&n.layerUrl&&(e=n)});if(e){var f=function(n,p,q){a.layersInfo=a.layersInfo||{};a.layersInfo.layers=a.layersInfo.layers||[];a.layersInfo.layers.push(q);n._layerInfo=q;p.callback(q)},h=function(n,p){delete e.layerUrl;
n.errback(Error("Query layer not accessible."))},l=!1;arcgisonline.sharing.util.getUser()||(l=!0);arcgisonline.map.layer.getServiceInfo(e.layerUrl,null,b.hitch(this,f,e,d),b.hitch(this,h,d),l)}else if(a.layersInfo&&a.layersInfo.layers&&!arcgisonline.sharing.util.isHostedService(a.url)){var g=!1;b.forEach(a.layersInfo.layers,function(n){n.id===c&&(d.callback(n),g=!0)});if(!g){f=function(n,p){a.layersInfo=a.layersInfo||{layers:[]};b.filter(a.layersInfo.layers,function(q){return q.id===c}).length||a.layersInfo.layers.push(p);
n.callback(p)};h=function(n,p){n.errback(p)};l=a.url;var m=l.indexOf("?");l=-1==m?l+("/"+c):l.substring(0,m)+"/"+c+l.substring(m,l.length);arcgisonline.map.layer.getServiceInfo(l,null,b.hitch(this,f,d),b.hitch(this,h,d))}}else d.errback();return d},getItemWithId:function(a,c){var d;b.forEach(a,function(e){e&&e.id===c&&(d=e)});return d},getItemWithSourceMapLayerId:function(a,c){var d;b.forEach(a,function(e){e&&e.layerDefinition&&e.layerDefinition.source&&e.layerDefinition.source.mapLayerId===c&&(d=
e)});return d},getServiceToServiceFS:function(a,c,d){a.noQueryServiceUrl?d&&d():a.queryServiceUrlProcessing?setTimeout(b.hitch(arcgisonline.map.main,"getServiceToServiceFS",a,c,d),500):a.queryServiceUrl?c():(a.queryServiceUrlProcessing=!0,arcgisonline.sharing.util.getJson(esriGeowConfig.restBaseUrl+"content/items/"+a.itemId+"/relatedItems?relationshipType\x3dService2Service\x26direction\x3dreverse",b.hitch(this,function(e){e&&e.total&&b.forEach(e.relatedItems,function(f){"Feature Service"===f.type&&
(a.queryServiceUrl=f.url,!esriGeowConfig.allSSL&&"https:"!=location.protocol||!arcgisonline.sharing.util.isHostedService(a.queryServiceUrl)&&!arcgisonline.sharing.util.supportsHttps(a.queryServiceUrl)||(a.queryServiceUrl=a.queryServiceUrl.replace("http:","https:")),a.queryServiceItemId=f.id,delete a.queryServiceUrlProcessing,c())});a.queryServiceUrl||(a.noQueryServiceUrl=!0,delete a.queryServiceUrlProcessing,d&&d())}),b.hitch(this,function(){a.noQueryServiceUrl=!0;delete a.queryServiceUrlProcessing;
d&&d()})))},hasFullEditingControl:function(a){var c=!1,d=arcgisonline.sharing.util.getUser();if(d&&a.itemId){var e=arcgisonline.sharing.util.urlToObject(document.URL);e.query=e.query||{};var f=e.query.layers||e.query.services,h=[];e.query.webmap&&arcgisonline.map.save_open.openedWebMap&&(h=b.filter(arcgisonline.map.save_open.openedWebMap.operationalLayers,function(l){return l.itemId===a.itemId}));!a.itemCard&&arcgisonline.map.save_open.itemCards[a.itemId]&&(a.itemCard=arcgisonline.map.save_open.itemCards[a.itemId]);
"true"===e.query.isAdmin&&(f&&-1<f.indexOf(a.itemId)||h.length)&&a.itemCard&&-1<b.indexOf(a.itemCard.typeKeywords,"Hosted Service")&&("update"===a.itemCard.itemControl||"admin"===a.itemCard.itemControl?c=!0:d&&esriGeowConfig.userRole&&esriGeowConfig.userRole.isAdmin()&&a.itemCard.isOrgItem?c=!0:d&&a.itemCard.owner&&a.itemCard.owner===d.username?c=!0:esriGeowConfig.userRole&&esriGeowConfig.userRole.canEditFeaturesFullControl()&&esriGeowConfig.userRole.canEditFeatures()&&a.itemCard.isOrgItem&&a.serviceInfo&&
a.serviceInfo.capabilities&&(-1<a.serviceInfo.capabilities.indexOf("Create")||-1<a.serviceInfo.capabilities.indexOf("Update")||-1<a.serviceInfo.capabilities.indexOf("Delete"))&&(c=!0))}return c},hasDynamicLayers:function(a){return a.layer&&a.itemLayers&&a.itemLayers.length&&a.layer.supportsDynamicLayers&&a.itemLayers[0].layerDefinition&&a.itemLayers[0].layerDefinition.source?!0:!1},getMapLayerInfo:function(){for(var a={supportsOffline:!0},c=0;c<arcgisonline.map.main.mapLayers.length;c++){var d=arcgisonline.map.main.mapLayers[c],
e=d.layer;"base"!==d.type&&"labels"!==d.type&&(esri.isDefined(a.allOpLyrsSync)||(a.allOpLyrsSync=!0),a.allOpLyrsSync=!!(a.allOpLyrsSync&&e&&e instanceof esri.layers.FeatureLayer&&e.capabilities&&-1<e.capabilities.indexOf("Sync")&&(arcgisonline.sharing.util.isHostedService(e.url)||10.4<=e.version)));if(e&&e.url&&e instanceof esri.layers.FeatureLayer&&(e.isEditable()||isEmbedded&&isEmbedded.hideEdit)){var f=!1,h=d.serviceInfo&&d.serviceInfo._origCapabilities||e.capabilities;h=h?h.toLowerCase():"";if(-1<
h.indexOf("create")||-1<h.indexOf("edit")||-1<h.indexOf("delete")||-1<h.indexOf("update"))f=!0;f&&(a.hasEditableLayer=!0,d.isTrackingInfoLayer&&!a.trackingLayerId&&(a.trackingLayerId=d.id))}!a.supportsOffline||e&&e instanceof esri.layers.FeatureLayer&&e.url&&e.capabilities&&-1<e.capabilities.indexOf("Sync")||"mapNotes"===d.type&&!d.itemId||arcgisonline.map.featColl.isFeatureCollection(d)&&!d.itemId||e&&e instanceof esri.layers.VectorTileLayer&&e.capabilities&&e.capabilities.exportTilesAllowed||e&&
e instanceof esri.layers.ArcGISTiledMapServiceLayer&&(d.serviceInfo&&d.serviceInfo.exportTilesAllowed||!arcgisonline.sharing.util.isPortal()&&arcgisonline.sharing.util.isAgolService(e.url)&&arcgisonline.map.main.agolServiceWithExportTilesAllowed(e.url))||(a.supportsOffline=!1)}for(c=0;c<arcgisonline.map.main.mapTables.length;c++)d=arcgisonline.map.main.mapTables[c],(e=d.layer)&&e.url&&e instanceof esri.layers.FeatureLayer&&e.isEditable()&&(a.hasEditableLayer=!0),e&&e instanceof esri.layers.FeatureLayer&&
e.url&&e.capabilities&&-1<e.capabilities.indexOf("Sync")||(a.supportsOffline=!1);return a},agolServiceWithExportTilesAllowed:function(a){if(esriGeowConfig.agolServicesWithExportTilesAllowed)for(var c=0;c<esriGeowConfig.agolServicesWithExportTilesAllowed.length;c++)if(-1<a.indexOf("/"+esriGeowConfig.agolServicesWithExportTilesAllowed[c]+"/"))return!0;return!1},adjustWebMapTypeKeywords:function(a){a=a.split(",");var c=arcgisonline.map.main.getMapLayerInfo(),d=b.indexOf(a,"ArcGIS API for JavaScript");
-1<d&&a.splice(d,1);c.hasEditableLayer?(-1===b.indexOf(a,"Data Editing")&&a.push("Data Editing"),-1<b.indexOf(a,"Workforce Project")||-1<b.indexOf(a,"Workforce Worker")||-1<b.indexOf(a,"Workforce Dispatcher")?(d=b.indexOf(a,"Collector"),-1<d&&a.splice(d,1)):(d=arcgisonline.sharing.util.getUser())&&d.accountId&&-1===b.indexOf(a,"CollectorDisabled")&&(-1===b.indexOf(a,"Collector")&&d&&d.accountId?a.push("Collector"):d&&d.accountId||(d=b.indexOf(a,"Collector"),-1<d&&a.splice(d,1)))):(d=b.indexOf(a,"Data Editing"),
-1<d&&a.splice(d,1),d=b.indexOf(a,"Collector"),-1<d&&a.splice(d,1),d=b.indexOf(a,"CollectorDisabled"),-1<d&&a.splice(d,1));(d=arcgisonline.sharing.util.getUser())&&d.accountId&&-1===b.indexOf(a,"OfflineDisabled")&&(c.supportsOffline?-1===b.indexOf(a,"Offline")&&a.push("Offline"):(d=b.indexOf(a,"Offline"),-1<d&&a.splice(d,1)));return a.toString()},reloadFeatureLayer:function(a){arcgisonline.map.main.map.infoWindow.clearFeatures();arcgisonline.map.main.map.infoWindow.hide();delete a.__createDefaultPopup;
var c=!1;b.forEach(arcgisonline.map.geocode.geocoder.sources,function(f){f.layerId===a.layer.id&&(c=!0)});a.scaleChanged&&(a.serviceInfo.minScale=a.layer.minScale,a.serviceInfo.maxScale=a.layer.maxScale);a.rendererChanged&&(a.layerDefinition=a.layerDefinition||{},a.layerDefinition.drawingInfo=a.layerDefinition.drawingInfo||{},a.layerDefinition.drawingInfo.renderer=a.layer.renderer.toJson(),a.layer.labelingInfo&&(a.serviceInfo.drawingInfo.labelingInfo=b.map(a.layer.labelingInfo,function(f){return f.toJson()})));
a.featureTemplatesChanged&&(a.serviceInfo.types=a.layer.types,a.serviceInfo.templates=a.layer.templates,a.serviceInfo.typeIdField=a.layer.typeIdField);!1===a.layer.useMapTime?a.timeAnimation=!1:!0===a.layer.useMapTime&&(a.timeAnimation=!0);a.defaultOpacity=a.layer.opacity;var d=b.indexOf(arcgisonline.map.main.map.graphicsLayerIds,a.id),e=b.connect(arcgisonline.map.main.map,"onLayerRemove",function(){b.disconnect(e);arcgisonline.map.labels.removeLabelsForLayer(a.layer);delete a.layer;arcgisonline.map.layer.addLayer(a,
d,function(){b.publish("onLayerUpdate",["reopen"]);c&&arcgisonline.map.geocode.recreateGeocoder()})});arcgisonline.map.main.map.removeLayer(a.layer);arcgisonline.map.labels.removeLabelsForLayer(a.layer)},maxOffset:function(a){return Math.floor(arcgisonline.map.main.map.extent.getWidth()/arcgisonline.map.main.map.width)*a},updateLayerScaleInfo:function(a,c){if(10.1>=c.version&&a.serviceInfo&&a.serviceInfo.layers)for(var d=parseInt(c.url.substring(c.url.lastIndexOf("/")+1,c.url.length)),e=a.serviceInfo.layers.length-
1;0<=e;e--)if(a.serviceInfo.layers[e].id==d)if(0<=a.serviceInfo.layers[e].minScale&&c.setMinScale(Math.min(c.minScale,a.serviceInfo.layers[e].minScale)||a.serviceInfo.layers[e].minScale||c.minScale),0<=a.serviceInfo.layers[e].maxScale&&c.setMaxScale(Math.max(c.maxScale,a.serviceInfo.layers[e].maxScale)),-1<a.serviceInfo.layers[e].parentLayerId)d=a.serviceInfo.layers[e].parentLayerId;else break},removeUrlParameter:function(a,c){-1!=a.indexOf("\x26"+c+"\x3d")?(start=a.indexOf(c),end=a.indexOf("\x26",
start+2),a=-1==end?a.substring(0,start):a.substring(0,start)+a.substring(end,a.length)):-1!=a.indexOf("?"+c+"\x3d")&&(start=a.indexOf(c),end=a.indexOf("\x26",start+2),a=-1==end?a.substring(0,start):a.substring(0,start+1)+a.substring(end+1,a.length));return a},isTextLayer:function(a){return a.renderer&&"esri.renderer.UniqueValueRenderer"===a.renderer.declaredClass&&a.renderer.infos&&a.renderer.infos.length&&a.renderer.infos[0].symbol&&"textsymbol"===a.renderer.infos[0].symbol.type?!0:!1},switchBingToEsriBasemap:function(a){a.baseMap=
"BingMapsAerial"===a.baseMap.baseMapLayers[0].type||"BingMapsAerial"===a.baseMap.baseMapLayers[0].layerType?{title:"Imagery",baseMapLayers:[{id:"World_Imagery_2017",visibility:!0,opacity:1,url:"http://services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer"}]}:"BingMapsRoad"===a.baseMap.baseMapLayers[0].type||"BingMapsRoad"===a.baseMap.baseMapLayers[0].layerType?{title:"Streets",baseMapLayers:[{id:"World_Street_Map_8421",opacity:1,visibility:!0,url:"http://services.arcgisonline.com/ArcGIS/rest/services/World_Street_Map/MapServer"}]}:
{title:"Imagery with Labels",baseMapLayers:[{id:"World_Imagery_6611",opacity:1,visibility:!0,url:"http://services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer"},{id:"World_Boundaries_and_Places_1145",isReference:!0,opacity:1,visibility:!0,url:"http://services.arcgisonline.com/ArcGIS/rest/services/Reference/World_Boundaries_and_Places/MapServer"}]};return a},getJson:function(a,c,d){a=0<=a.indexOf("?")?a+"\x26f\x3djson":a+"?f\x3djson";esri.request({url:a,callbackParamName:"callback",
load:function(e,f){arcgisonline.sharing.util.handler(e,f,a,c,d)},error:function(e,f){arcgisonline.sharing.util.errorHandler(e,f,a,d)}})},roundVal:function(a){return arcgisonline.map.main.roundValue(a,1E4)},roundValue:function(a,c){return Math.round(a*c)/c},onKeyPress:function(a){a.keyCode==b.keys.BACKSPACE&&"INPUT"!==a.currentTarget.activeElement.nodeName&&"TEXTAREA"!==a.currentTarget.activeElement.nodeName&&(a.preventDefault(),a.stopPropagation())},doNothing:function(a){a.preventDefault()},contains:function(a,
c){for(var d=a.length;d--;)if(a[d]===c)return!0;return!1},createMapObject:function(a,c,d){b.style("map","position","relative");var e=new esri.dijit.Popup({visibleWhenEmpty:!1},b.create("div",{"class":"blueTheme"},b.byId("map")));c={nav:!1,lods:arcgisonline.map.main.mapLods,extent:c,wrapAround180:!0,infoWindow:e,showInfoWindowOnClick:!1,sliderStyle:"small"};d&&esri.isDefined(d.minScale)&&esri.isDefined(d.maxScale)&&(c.minScale=d.minScale,c.maxScale=d.maxScale);arcgisonline.map.save_open.openedWebMap&&
arcgisonline.map.save_open.openedWebMap.background&&arcgisonline.map.save_open.openedWebMap.background.color&&esri.isDefined(arcgisonline.map.save_open.openedWebMap.background.color[0])&&(c.backgroundColor=esri.Color.toDojoColor(arcgisonline.map.save_open.openedWebMap.background.color));arcgisonline.map.main.map=new esri.Map("map",c);null==a&&(a=b.hitch(arcgisonline.map.main,"onMapLoad"));b.connect(arcgisonline.map.main.map,"onLoad",a);b.connect(arcgisonline.map.main.map,"onClick",function(){arcgisonline.map.geocode.closeInfoWindow();
document.activeElement&&document.activeElement.blur&&document.activeElement.blur()});arcgisonline.map.main.onLayerAddHandler=b.connect(arcgisonline.map.main.map,"onLayerAddResult",b.hitch(arcgisonline.map.main,"onLayerAddResult"))},destroyMapObject:function(a,c){arcgisonline.map.main.map&&(arcgisonline.map.main.scalebar=null,arcgisonline.map.time.hideTimeSlider(),arcgisonline.map.time.removeTimeSlider(),arcgisonline.map.multiDimensions.removeMdSlider(),arcgisonline.map.main.destroyOverviewMap(),arcgisonline.map.main.destroyMeasureTool(),
arcgisonline.map.geocode.destroyGeocoder(),arcgisonline.map.table.destroyTable(),arcgisonline.map.main.map.destroy(),arcgisonline.map.labels.labelLayer=null,arcgisonline.map.main.map=null,b.byId("map").innerHTML="")},getDirectionsDisplayField:function(a){var c="";if(a.displayField)c=a.displayField;else{for(var d=null,e=null,f=null,h=null,l=null,g=0;g<a.fields.length;g++){var m=a.fields[g];if("name"==m.name.toLowerCase()){c=m.name;break}else"address"==m.name.toLowerCase()?e=m.name:"street"==m.name.toLowerCase()?
f=m.name:"city"==m.name.toLowerCase()?h=m.name:!d&&-1<m.name.toLowerCase().indexOf("name")?d=m.name:l||"esriFieldTypeString"!==m.type||(l=m.name)}c||(d?c=d:e?c=e:f?c=f:h?c=h:l&&(c=l))}return c},numOperationalLayers:function(){for(var a=0,c=0;c<arcgisonline.map.main.mapLayers.length;c++)"user"==arcgisonline.map.main.mapLayers[c].type&&a++;return a},numLabelsLayers:function(){for(var a=0,c=0;c<arcgisonline.map.main.mapLayers.length;c++)"labels"===arcgisonline.map.main.mapLayers[c].type&&a++;return a},
numMapNotesLayers:function(){for(var a=0,c=0;c<arcgisonline.map.main.mapLayers.length;c++)"mapNotes"===arcgisonline.map.main.mapLayers[c].type&&a++;return a},countMapNotesSubLayers:function(){for(var a=0,c=0;c<arcgisonline.map.main.mapLayers.length;c++)"mapNotes"===arcgisonline.map.main.mapLayers[c].type&&arcgisonline.map.main.mapLayers[c].layers&&(a+=arcgisonline.map.main.mapLayers[c].layers.length);return a},itemCardExtentValid:function(a){return!a||2!=a.length||2!=a[0].length||2!=a[1].length||
-90>a[1][1]||90<a[1][1]||-180>a[1][0]||180<a[1][0]||-180>a[0][0]||180<a[0][0]||-90>a[0][1]||90<a[0][1]||a[1][0]<=a[0][0]||a[1][1]<=a[0][1]?!1:!0},getNameFromUrl:function(a){var c=a;-1<a.indexOf("/MapServer")?(c=a.substring(0,a.indexOf("/MapServer")),c=c.substring(c.lastIndexOf("/")+1,c.length)):-1<a.indexOf("/ImageServer")?(c=a.substring(0,a.indexOf("/ImageServer")),c=c.substring(c.lastIndexOf("/")+1,c.length)):-1<a.indexOf("/FeatureServer")&&(c=a.substring(0,a.indexOf("/FeatureServer")),c=c.substring(c.lastIndexOf("/")+
1,c.length));-1<c.indexOf("%")&&(c=arcgisonline.map.main.decodeUrl(c));return c},addLayerId:function(a,c){var d=a.indexOf("?");return a=-1<d?a.substring(0,d)+"/"+c+a.substring(d,a.length):a+("/"+c)},decodeUrl:function(a){try{var c=decodeURIComponent(a)}catch(d){c=a}return c},displayDefaultExtent:function(){var a=new esri.symbol.SimpleLineSymbol(esri.symbol.SimpleLineSymbol.STYLE_SOLID,new b.Color([255,0,0]),2);arcgisonline.map.main.map.graphics.add(new esri.Graphic(new esri.geometry.Extent(esriGeowConfig.defaultExtent),
a))},calcFilterDlgWidth:function(){if(!arcgisonline.map.main.filterDlgWidth){var a=b.string.substitute(esri.i18nBundle.FilterDlg.expressionTemplate,{field_dropdown:"",operator_dropdown:"",values_input:esri.i18nBundle.FilterDlg.value+esri.i18nBundle.FilterDlg.field+esri.i18nBundle.FilterDlg.uniqueValues}).replace(/\s/g,"\x26nbsp;"),c=b.create("div",{innerHTML:a,style:{top:-1E3,left:0,position:"absolute"}},document.body);a=b.string.substitute(esri.i18nBundle.FilterDlg.expressionTemplate,{field_dropdown:"",
operator_dropdown:"",values_input:esri.i18nBundle.FilterDlg.andBetweenValues}).replace(/\s/g,"\x26nbsp;");a=b.create("div",{innerHTML:a,style:{top:-1E3,left:0,position:"absolute"}},document.body);var d=b.create("div",{innerHTML:"",style:{top:0,left:0,position:"absolute"},"class":"submitButtons dijitDialogPaneActionBar dijitDialog"},document.body),e=new r.form.Button({label:esri.i18nBundle.FilterDlg.applyFilterBtn,"class":"primary",type:"button"});b.place(e.domNode,d,"last");e=new r.form.Button({label:esri.i18nBundle.FilterDlg.applyFilterAndZoomBtn,
"class":"primary",type:"button"});b.place(e.domNode,d,"last");e=new r.form.Button({label:esri.i18nBundle.common.close,"class":"cancel",type:"button"});b.place(e.domNode,d,"last");e=b.coords(c).w+465;var f=b.coords(a).w+590,h=b.coords(d).w+30;arcgisonline.map.main.filterDlgWidth=Math.max(e,Math.max(f,h));document.body.removeChild(c);document.body.removeChild(a);document.body.removeChild(d)}return arcgisonline.map.main.filterDlgWidth},openFilterDlg:function(a,c,d){var e=arcgisonline.map.main.calcFilterDlgWidth(),
f=(new r.Dialog({"class":"esriAGOFilterDialog",style:"width:"+(e+30)+"px;"})).placeAt(document.body),h=new arcgisonline.sharing.dijit.dialog.FilterDlg({id:"filterDlg",dialog:f,style:"width:"+e+"px;"});e=esri.i18nBundle.FilterDlg.filter+": "+a.title;d&&(e=esri.i18nBundle.FilterDlg.defineFeatures+": "+a.title);a.layer instanceof esri.layers.ArcGISDynamicMapServiceLayer&&(e+=" - "+c.name);f.set({title:e,content:h});f.show();if(d&&!c.adminFields){var l=a.url.replace("/rest/services","/rest/admin/services"),
g={f:"json"};arcgisonline.map.itemData.getServerToken(a).then(b.hitch(this,function(m){g.token=m;esri.request({url:l,content:g,callbackParamName:"callback",load:function(n){c.adminFields=n.fields;h.start(a,c,null,d)},error:function(n){h.start(a,c,null,d)}})}),function(m){h.start(a,c,null,d)})}else h.start(a,c,null,d)},openFieldsDlg:function(a){arcgisonline.map.main.map.infoWindow.hide();arcgisonline.map.table.hideAttributeTable();var c=function(f){var h=(new r.Dialog({"class":"esriAGOFieldsDialog",
style:"width: 500px"})).placeAt(document.body),l=new arcgisonline.sharing.dijit.dialog.FieldsDlg({id:"fieldsDlg",dialog:h});h.set({title:esri.i18nBundle.FieldsDlg.defineFields+": "+a.title,content:l});h.show();l.start(a,f)};if(a.serviceInfo.adminFields)c(a.serviceInfo.adminFields);else{var d=a.url.replace("/rest/services","/rest/admin/services"),e={f:"json"};arcgisonline.map.itemData.getServerToken(a).then(b.hitch(this,function(f){e.token=f;esri.request({url:d,content:e,callbackParamName:"callback",
load:function(h){a.serviceInfo.adminFields=h.fields;c(a.serviceInfo.adminFields)},error:function(h){c(a.serviceInfo.fields)}})}),function(f){c(a.serviceInfo.fields)})}},openMapSettingsDlg:function(){var a=(new r.Dialog({"class":"esriAGOMapSettingsDialog"})).placeAt(document.body),c=new arcgisonline.sharing.dijit.dialog.MapSettingsDlg({id:"mapSettingsDlg",dialog:a});a.set({title:esri.i18nBundle.MapSettingsDlg.timeSettings,content:c});a.show();c.start()},onUTCOffsetChange:function(){var a=arcgisonline.map.table.openTableMapLayerSubId;
if(arcgisonline.map.table.openTableMapLayerId){var c=arcgisonline.map.main.getParameterListById(arcgisonline.map.table.openTableMapLayerId);arcgisonline.map.table.refreshTablePrep(c,a)}},applyUTCOffsetToMS:function(a){var c=arcgisonline.map.main.map.utcOffset;if(esri.isDefined(c)){var d=-1*(new Date).getTimezoneOffset();a=a-6E4*d+6E4*c}return a},getWebmapId:function(){return arcgisonline.map.save_open.webMapInfo?arcgisonline.map.save_open.webMapInfo.id:null},getWebmapTitle:function(){return arcgisonline.map.save_open.webMapInfo?
arcgisonline.map.save_open.webMapInfo.title:null},updateRecentWebMaps:function(a){arcgisonline.map.main.storeRecentMapsHandler||(arcgisonline.map.main.storeRecentMapsHandler=b.subscribe("onSaveExistingWebMap",function(f){arcgisonline.map.main.storeRecentWebMaps()}),b.subscribe("onWebMapSave",function(f,h,l,g,m){arcgisonline.map.main.storeRecentWebMaps(f,h,m,"thumbnail/ago_downloaded.png")}),b.subscribe("onMapFullyLoaded",function(){arcgisonline.map.save_open.webMapInfo&&arcgisonline.map.main.storeRecentWebMaps()}));
if("none"!==b.style(b.byId("header_map_newMap"),"display")||"none"!==b.style(b.byId("header_map_recentMaps"),"display")){arcgisonline.map.main.recentMapsHandlers=arcgisonline.map.main.recentMapsHandlers||[];var c;window.localStorage&&(c=window.localStorage.getItem("Esri_recent_webmaps"))&&(c=b.json.parse(c));var d=arcgisonline.sharing.util.getUser();if((c=c&&c[d?d.username:window.location.host])&&c.length)if(arcgisonline.map.main.didCheckRecentMaps)arcgisonline.map.main.displayRecentMaps(c,a);else{var e=
[];b.forEach(c,function(f,h){h=e.push;f=arcgisonline.sharing.util.request({url:esriGeowConfig.restBaseUrl+"content/items/"+f.id},{disableIdentityLookup:!0});h.call(e,f)});e.length?(new b.DeferredList(e)).addCallback(function(f){var h=[];b.forEach(f,function(g){(g=g[1])&&g.id&&h.push({id:g.id,title:g.title,owner:g.owner,thumbnail:g.thumbnail})});if(window.localStorage){var l;window.localStorage&&(l=window.localStorage.getItem("Esri_recent_webmaps"))&&(l=b.json.parse(l));l=l||{};h.length?l[d?d.username:
window.location.host]=h:delete l[d?d.username:window.location.host];window.localStorage.setItem("Esri_recent_webmaps",b.json.stringify(l))}arcgisonline.map.main.displayRecentMaps(h,a)}):arcgisonline.map.main.displayRecentMaps([],a);arcgisonline.map.main.didCheckRecentMaps=!0}else arcgisonline.map.main.displayRecentMaps(c,a);arcgisonline.map.main.checkTitleDiv()}},displayRecentMaps:function(a,c){a&&a.length&&(a=b.filter(a,function(f){return esri.isDefined(c)&&c===f.id||!esri.isDefined(c)&&arcgisonline.map.save_open.webMapInfo&&
f.id===arcgisonline.map.save_open.webMapInfo.id?!1:!0}));if(a&&a.length){b.byId("webmap-recentMap-new-link").innerHTML='\x3cspan style\x3d"margin-right: 4px;vertical-align: -4px;" class\x3d"esriPublishIcon"\x3e\x3c/span\x3e'+esri.i18nBundle.siteHeader.createNewMap;b.disconnect(arcgisonline.map.main.recentMapsHandlers["new"]);arcgisonline.map.main.recentMapsHandlers["new"]=b.connect(b.byId("webmap-recentMap-new-link"),"onclick",b.hitch(this,function(f){f.preventDefault();arcgisonline.map.main.openNewMap()}));
for(var d=0;5>d;d++)b.style(b.byId("webmap-recentMap-title"),"display","none"),b.style(b.byId("webmap-recentMap-"+d+"-link"),"display","none"),b.disconnect(arcgisonline.map.main.recentMapsHandlers[d]);a.reverse();var e=0;b.forEach(a,function(f){if(!(4<e)){var h='\x3ctable cellpadding\x3d"0" cellspacing\x3d"0" style\x3d"width:270px;"\x3e\x3ctbody\x3e\x3ctr\x3e\x3ctd style\x3d"width:77px;" valign\x3d"top"\x3e',l=f.thumbnail||arcgisonline.sharing.util.getStaticImagesUrl()+"/desktopapp.png";-1<l.indexOf("thumbnail/")&&
(l=esriGeowConfig.restBaseUrl+"content/items/"+f.id+"/info/"+l);var g=arcgisonline.sharing.util.getUser();g&&g.token&&(l+="?token\x3d"+g.token);g=f.title;75<g.length&&(g=g.substring(0,72)+"...");h=h+("\x3cimg src\x3d'"+l+"' border\x3d'0' style\x3d'width:67px; height:44px;'/\x3e\x3c/td\x3e\x3ctd style\x3d'width:190px; white-space:normal;' valign\x3d'top'\x3e\x3cspan\x3e")+(g+"\x3c/span\x3e");h+="\x3c/td\x3e\x3c/tr\x3e\x3c/tbody\x3e\x3c/table\x3e";b.byId("webmap-recentMap-"+e+"-link").innerHTML=h;b.style(b.byId("webmap-recentMap-"+
e+"-link"),"display","");b.style(b.byId("webmap-recentMap-title"),"display","");arcgisonline.map.main.recentMapsHandlers[e]=b.connect(b.byId("webmap-recentMap-"+e+"-link"),"onclick",b.hitch(this,function(m){m.preventDefault();m=esriGeowConfig.baseUrl+"webmap/viewer.html?webmap\x3d"+f.id;1==arcgisonline.map.main.mapHasChanged?arcgisonline.sharing.dijit.dialog.OpenMapDlg.prototype.statics.getInstance().show(m,null,arcgisonline.map.main.mapLayers,arcgisonline.map.main.mapTables,arcgisonline.map.save_open.webMapInfo?
arcgisonline.map.save_open.webMapInfo.title:null):document.location=m}));e++}});b.style(b.byId("header_map_newMap"),"display","none");b.style(b.byId("header_map_recentMaps"),"display","");esriGeowConfig.isRightToLeft?(a=b.coords(b.byId("header_map_recentMaps")),a=a.x+a.w,d=b.query(".js-dropdown-menu",b.byId("header_map_recentMaps"))[0],310>a?b.style(d,"left","5px"):b.style(d,"left","auto")):(a=window.innerWidth-b.coords(b.byId("header_map_recentMaps")).x,d=b.query(".js-dropdown-menu",b.byId("header_map_recentMaps"))[0])}else b.style(b.byId("header_map_recentMaps"),
"display","none"),b.style(b.byId("header_map_newMap"),"display","")},storeRecentWebMaps:function(a,c,d,e){var f;window.localStorage&&(f=window.localStorage.getItem("Esri_recent_webmaps"))&&(f=b.json.parse(f));f=f||{};var h=arcgisonline.sharing.util.getUser();var l=f[h?h.username:window.location.host]||[];l=b.filter(l,function(g){return g.id!==(a||arcgisonline.map.save_open.webMapInfo.id)});l.push({id:a||arcgisonline.map.save_open.webMapInfo.id,title:d||arcgisonline.map.save_open.webMapInfo.title,
owner:c||arcgisonline.map.save_open.webMapInfo.owner,thumbnail:e||arcgisonline.map.save_open.webMapInfo.thumbnail});10<l.length&&l.splice(0,1);window.localStorage&&(f[h?h.username:window.location.host]=l,window.localStorage.setItem("Esri_recent_webmaps",b.json.stringify(f)));arcgisonline.map.main.updateRecentWebMaps(a)},hideRouteLayer:function(a){arcgisonline.map.main.showRouteLayer();arcgisonline.map.main.hiddenRouteLayers=[];b.forEach(arcgisonline.map.main.mapLayers,function(c){c.itemId===a&&(c.layers?
b.forEach(c.layers,function(d){d.visible&&(d.hide(),arcgisonline.map.main.hiddenRouteLayers.push(d))}):(c.layer.hide(),arcgisonline.map.main.hiddenRouteLayers.push(c.layer)))})},showRouteLayer:function(){arcgisonline.map.main.hiddenRouteLayers=arcgisonline.map.main.hiddenRouteLayers||[];b.forEach(arcgisonline.map.main.hiddenRouteLayers,function(a){a.show()});delete arcgisonline.map.main.hiddenRouteLayers},getPictureMarkerSize:function(a){var c=new b.Deferred;if(!a||10>a.length||0!==a.indexOf("http"))c.errback();
else{arcgisonline.map.main.testImageHandler&&b.disconnect(arcgisonline.map.main.testImageHandler);arcgisonline.map.main.testImageHandler=b.connect(b.byId("viewer_testImage"),"onload",function(){clearTimeout(d);d=null;var e=b.style(b.byId("viewer_testImage"),"width"),f=b.style(b.byId("viewer_testImage"),"height");1==e&&1==f||0===e||0===f?c.errback():c.callback([e,f])},{});var d=setTimeout(b.hitch(this,function(){clearTimeout(d);d=null;c.errback()}),5E3);b.byId("viewer_testImage").src=a;return c}},
getTitleFromUrl:function(a,c){if(!a)return null;var d=null,e=a.toLowerCase();-1<e.indexOf("/mapserver",10)?(d=a.substring(0,e.indexOf("/mapserver",10)),d=d.substring(d.lastIndexOf("/")+1,d.length)):-1<e.indexOf("/vectortileserver")?(d=a.substring(0,e.indexOf("/vectortileserver")),d=d.substring(d.lastIndexOf("/")+1,d.length)):-1<e.indexOf("/imageserver")?(d=a.substring(0,e.indexOf("/imageserver")),d=d.substring(d.lastIndexOf("/")+1,d.length)):-1<e.indexOf("/featureserver")?(d=a.substring(0,e.indexOf("/featureserver")),
d=d.substring(d.lastIndexOf("/")+1,d.length)):c&&c.documentInfo&&c.documentInfo.Title&&0<c.documentInfo.Title.length?d=c.documentInfo.Title:c&&c.mapName&&0<c.mapName.length&&(d=c.mapName);d&&-1<d.indexOf("%")&&(d=arcgisonline.map.main.decodeUrl(d));return d=arcgisonline.sharing.util.stripHTML(d)},getSpecialTitle:function(a){var c=null;if("BingMapsRoad"===a.type||"BingMapsRoad"===a.layerType)c="Bing Maps Road";else if("BingMapsAerial"===a.type||"BingMapsAerial"===a.layerType)c="Bing Maps Aerial";else if("BingMapsHybrid"===
a.type||"BingMapsHybrid"===a.layerType)c="Bing Maps Hybrid";else if("OpenStreetMap"===a.type||"OpenStreetMap"===a.layerType)c="OpenStreetMap";return c},getLayerTitle:function(a,c){var d=a.title;if(a.layer&&a.layer.layerInfos)arcgisonline.map.main.hasDynamicLayers(a)?b.forEach(a.itemLayers,function(f){c===f.id&&f.name&&(d+=" - "+f.name)}):(a=arcgisonline.map.main.getItemWithId(a.layer.layerInfos,c),a.name&&(d+=" - "+a.name));else if(a.layers||a.tables){var e=a.layers;a.tables&&(e=e.concat(a.tables));
a=arcgisonline.map.main.getItemWithId(e,a.id+"_"+c);a.name&&(d+=" - "+a.name)}return d},getTitleForBasemapLayer:function(a){var c=a.title&&a.title!==arcgisonline.map.main.mapLayers[0].title?a.title:null,d=arcgisonline.sharing.util,e=d.stripHTML;if(!(c=a.itemId&&a.itemCard&&a.itemCard.title||c||a.layer&&a.layer.name))if(c=a.url||a.templateUrl,a.layer instanceof esri.layers.VectorTileLayer&&a.itemCard&&(c=a.itemCard.url),c){var f=arcgisonline.map.main.getTitleFromUrl(c,a.serviceInfo);f||(f=c.substring(c.indexOf("://")+
3).replace(/\//g,"-"));c=f}else c=null;return e.call(d,c||a.title||"No Name")},isBlankViewer:function(){if(arcgisonline.map.save_open.webMapItemCard||arcgisonline.map.save_open.itemCard)return!1;var a=arcgisonline.sharing.util.urlToObject(document.URL);a.query=a.query||{};delete a.query.useExisting;return arcgisonline.isEmpty(a.query)?!0:0===arcgisonline.map.main.numOperationalLayers()&&0===arcgisonline.map.main.numMapNotesLayers()?!0:!1},hasMapOnly:function(){var a=arcgisonline.sharing.util.urlToObject(document.URL);
a.query=a.query||{};return a.query.mapOnly&&"true"===a.query.mapOnly?!0:!1},isItemFromSamePortal:function(a){return a&&a.restBaseUrl&&-1===esriGeowConfig.restBaseUrl.indexOf(a.restBaseUrl)?!1:!0},setupMapAlert:function(){arcgisonline.map.main.handlers=arcgisonline.map.main.handlers||{};b.byId("alertDiv")||(b.create("div",{id:"alertDiv","class":"alertIcon",style:"display:none;"},b.byId("map")),arcgisonline.map.main.handlers.onLayerUpdateHandler&&b.unsubscribe(arcgisonline.map.main.handlers.onLayerUpdateHandler),
arcgisonline.map.main.handlers.updateEndHandler&&b.unsubscribe(arcgisonline.map.main.handlers.updateEndHandler),delete arcgisonline.map.main.handlers.onLayerUpdateHandler,delete arcgisonline.map.main.handlers.updateEndHandler);arcgisonline.map.main.handlers.onLayerUpdateHandler=b.subscribe("onLayerUpdate",null,b.hitch(this,function(a){arcgisonline.map.main.checkMapAlert()}));arcgisonline.map.main.handlers.updateEndHandler||(arcgisonline.map.main.handlers.updateEndHandler=arcgisonline.map.main.map.on("update-end",
b.hitch(this,function(){arcgisonline.map.main.checkMapAlert()})));arcgisonline.map.main.handlers.updateStartHandler||(arcgisonline.map.main.handlers.updateStartHandler=arcgisonline.map.main.map.on("update-start",b.hitch(this,function(){})))},checkMapAlert:function(a){arcgisonline.map.main.alertHandler||"execute"===a?a&&(arcgisonline.map.main.queryLimitExceededLayers=[],b.forEach(arcgisonline.map.main.mapLayers,function(c){if(c){var d=c.layer;d&&"esri.layers.FeatureLayer"===d.declaredClass&&!d.hasAllFeatures()&&
arcgisonline.map.main.createMapAlert(c)}}),arcgisonline.map.main.queryLimitExceededLayers.length?b.byId("alertDiv")&&b.style(b.byId("alertDiv"),"display",""):b.byId("alertDiv")&&b.style(b.byId("alertDiv"),"display","none")):arcgisonline.map.main.alertHandler=setTimeout(function(){delete arcgisonline.map.main.alertHandler;arcgisonline.map.main.checkMapAlert("execute")},2E3)},createMapAlert:function(a){if(a.layer&&!a.layer.suspended){-1===b.indexOf(arcgisonline.map.main.queryLimitExceededLayers,a.title)&&
arcgisonline.map.main.queryLimitExceededLayers.push({title:a.title,hasFeatureReduction:a.layer.hasFeatureReduction&&a.layer.hasFeatureReduction(),hasUpdateError:a.layer.hasUpdateError()});if(1===arcgisonline.map.main.queryLimitExceededLayers.length)var c=a.layer.hasFeatureReduction&&a.layer.hasFeatureReduction()?a.layer.hasUpdateError()?b.string.substitute(esri.i18nBundle.viewer.layer.queryLimitExceededSingleMsgCluster,{name:a.title}):b.string.substitute(esri.i18nBundle.viewer.layer.queryLimitExceededSingleMsgCluster,
{name:a.title})+" "+esri.i18nBundle.viewer.layer.queryLimitExceededClusterTooMany:a.layer.hasUpdateError()?b.string.substitute(esri.i18nBundle.viewer.layer.queryLimitExceededSingleMsg,{name:a.title}):b.string.substitute(esri.i18nBundle.viewer.layer.queryLimitExceededSingleMsg,{name:a.title})+" "+esri.i18nBundle.viewer.layer.queryLimitExceededTooMany;else{for(var d=a=!1,e=0;e<arcgisonline.map.main.queryLimitExceededLayers.length;e++)arcgisonline.map.main.queryLimitExceededLayers[e].hasFeatureReduction&&
(a=!0),arcgisonline.map.main.queryLimitExceededLayers[e].hasUpdateError&&(d=!0);c=a?d?esri.i18nBundle.viewer.layer.queryLimitExceededMultipleMsgCluster:esri.i18nBundle.viewer.layer.queryLimitExceededMultipleMsgCluster+" "+esri.i18nBundle.viewer.layer.queryLimitExceededClusterTooMany:d?esri.i18nBundle.viewer.layer.queryLimitExceededMultipleMsg:esri.i18nBundle.viewer.layer.queryLimitExceededMultipleMsg+" "+esri.i18nBundle.viewer.layer.queryLimitExceededTooMany;c+="\x3cul\x3e";b.forEach(arcgisonline.map.main.queryLimitExceededLayers,
function(f){c+="\x3cli\x3e"+f.title+"\x3c/li\x3e"});c+="\x3c/ul\x3e"}arcgisonline.map.layer.tooManyFeaturesTooltip&&arcgisonline.map.layer.tooManyFeaturesTooltip.destroy();arcgisonline.map.layer.tooManyFeaturesTooltip=new r.Tooltip({connectId:b.byId("alertDiv"),label:"\x3cdiv class\x3d'tooManyFeaturesTooltip' style\x3d'width:350px;'\x3e"+c+"\x3c/div\x3e",position:["above","after"]})}},refreshMapTables:function(){var a=arcgisonline.map.storage.buildWebMapText().tables||[];b.forEach(arcgisonline.map.main.mapLayers,
function(c){!c.url&&c.tables&&b.forEach(c.tables,function(d){var e=d.toJson();e.id=d.id;e.title=c.title+" - "+d.name;a.push(e)})});arcgisonline.map.main.map.tables=a},setupHandlerForCache:function(){var a=arcgisonline.sharing.util.getUser();a&&a.accountId&&b.subscribe("layerAdded",b.hitch(this,function(c){(c=arcgisonline.map.main.getParameterListById(c))&&c.url&&c.itemCard&&arcgisonline.sharing.util.isHostedService(c.url)&&-1<c.url.toLowerCase().indexOf("/featureserver")&&(b.connect(c.layer,"onAddAttachmentComplete",
b.hitch(this,function(d){arcgisonline.map.main.ignoreCache(d)},c)),b.connect(c.layer,"onDeleteAttachmentsComplete",b.hitch(this,function(d){arcgisonline.map.main.ignoreCache(d)},c)))}))},initIgnoreCache:function(a){var c=new b.Deferred,d=arcgisonline.sharing.util.getUser();if(!(d&&a.url&&a.itemCard&&arcgisonline.sharing.util.isHostedService(a.url))||-1===b.indexOf(a.itemCard.typeKeywords,"Hosted Service")||-1===a.url.toLowerCase().indexOf("/featureserver")||a.itemCard.owner!==d.username&&"update"!==
a.itemCard.itemControl&&"admin"!==a.itemCard.itemControl)return c.callback(),c;d=a.url.toLowerCase().indexOf("/featureserver");var e=a.url.substring(0,d+14).replace("/rest/services","/rest/admin/services"),f=function(g){if(g.adminServiceInfo&&esri.isDefined(g.adminServiceInfo.cacheMaxAge)&&0<g.adminServiceInfo.cacheMaxAge&&g.layers){var m=0;b.forEach(g.layers,function(n){n.editingInfo&&n.editingInfo.lastEditDate&&(m=Math.max(m,n.editingInfo.lastEditDate))});0<m&&((new Date).getTime()-m)/1E3<g.adminServiceInfo.cacheMaxAge&&
arcgisonline.map.main.ignoreCache(a)}};arcgisonline.map.main.adminLayerInfos=arcgisonline.map.main.adminLayerInfos||{};if(arcgisonline.map.main.adminLayerInfos[e]){var h=function(g){var m=arcgisonline.map.main.adminLayerInfos[e];"failed"===m?g.callback():"inProgress"===m?setTimeout(b.hitch(this,function(){h(g)}),1E3):(f(m),g.callback())};h(c)}else{arcgisonline.map.main.adminLayerInfos[e]="inProgress";var l={f:"json",_ts:Math.round((new Date).getTime()/1E4)};arcgisonline.map.itemData.getServerToken(a).then(b.hitch(this,
function(g){l.token=g;esri.request({url:e,content:l,callbackParamName:"callback",load:b.hitch(this,function(m){arcgisonline.map.main.adminLayerInfos[e]=m;f(m);c.callback()}),error:function(m){arcgisonline.map.main.adminLayerInfos[e]="failed";c.callback()}})}),function(){arcgisonline.map.main.adminLayerInfos[e]="failed";c.callback()})}return c},ignoreCache:function(a){if(-1!==document.location.href.indexOf("viewer.html")){var c=arcgisonline.sharing.util.getUser();if(c&&a.url&&a.itemCard&&arcgisonline.sharing.util.isHostedService(a.url)&&
-1!==a.url.toLowerCase().indexOf("/featureserver")&&(a.itemCard.owner===c.username||"update"===a.itemCard.itemControl||"admin"===a.itemCard.itemControl)){c=a.url.toLowerCase().indexOf("/featureserver");var d=a.url.substring(0,c+14),e=d.replace("/rest/services","/rest/admin/services");arcgisonline.map.main.adminLayerInfos=arcgisonline.map.main.adminLayerInfos||{};(a=arcgisonline.map.main.adminLayerInfos[e])&&a.adminServiceInfo&&esri.isDefined(a.adminServiceInfo.cacheMaxAge)&&0!==a.adminServiceInfo.cacheMaxAge&&
(d=d.substring(7),e=e.substring(7),arcgisonline.map.main.cacheTimestamp=(new Date).getTime(),arcgisonline.map.main.requestPreCallbacks=arcgisonline.map.main.requestPreCallbacks||{},arcgisonline.map.main.requestPreCallbacks[d]||(arcgisonline.map.main.requestPreCallbacks[d]=!0,esri.setRequestPreCallback(b.hitch(this,function(f){f.url&&(-1<f.url.indexOf(d)||-1<f.url.indexOf(e))&&(f.content=f.content||{},f.content._ts=arcgisonline.map.main.cacheTimestamp);return f}))))}}},corsCheck:function(a){var c=
a.tileIndexUrl||a.url;!c||arcgisonline.sharing.util.isHostedService(c)||esri.hasSameOrigin(c,window.location.href)||-1===b.indexOf("esri.layers.FeatureLayer esri.layers.StreamLayer esri.layers.MapImageLayer esri.layers.ArcGISDynamicMapServiceLayer esri.layers.ArcGISImageServiceLayer esri.layers.ArcGISImageServiceVectorLayer esri.layers.ArcGISTiledMapServiceLayer".split(" "),a.declaredClass)||(arcgisonline.map.main.telemetry||(arcgisonline.map.main.telemetry=arcgisonline.telemetry.default.init({name:"Map Viewer",
config:esriGeowConfig.self,logPageView:!1})),esri.canUseXhr(c)?arcgisonline.map.main.telemetry.logEvent({eventType:"click",category:"CORS",label:"yes"}):arcgisonline.map.main.telemetry.logEvent({eventType:"click",category:"CORS",label:"no"}))},logFeatureLayerLoadTime:function(a){esriGeowConfig.usageTrackingEnabled&&!arcgisonline.sharing.util.isPortal()&&(arcgisonline.map.main.telemetry||(arcgisonline.map.main.telemetry=arcgisonline.telemetry.default.init({name:"Map Viewer",config:esriGeowConfig.self,
logPageView:!1})),a.onUpdateStartHndl=b.connect(a.layer,"onUpdateStart",function(){a.onUpdateStartTime=(new Date).getTime();b.disconnect(a.onUpdateStartHndl);delete a.onUpdateStartHndl}),a.onUpdateEndHndl=b.connect(a.layer,"onUpdateEnd",function(){var c=(new Date).getTime();if(a.onUpdateStartTime){var d=c-a.onUpdateStartTime;c=arcgisonline.sharing.util.isHostedService(a.url);var e=a.url;switch(a.layer.geometryType){case "esriGeometryPoint":var f="point";break;case "esriGeometryMultiPoint":f="multipoint";
break;case "esriGeometryPolyline":f="line";break;case "esriGeometryPolygon":f="polygon";break;default:f="unknown"}d={eventType:"performance",category:"load",action:"feature layer",label:"initial load",duration:d,attribute:"geometryType: "+f,details:c?"hosted":"not hosted",count:a.layer.graphics?a.layer.graphics.length:0};c&&(c=-1<e.indexOf("://")?e.split("/")[2]:e.split("/")[0],c=c.split(":")[0],d.urlRequested=c);arcgisonline.map.main.telemetry.logEvent(d);delete a.onUpdateStartTime}b.disconnect(a.onUpdateEndHndl);
delete a.onUpdateEndHndl}))},showRFxEditor:function(a){a&&(arcgisonline.map.main.rasterFunctionEditor?(arcgisonline.map.main.rasterFunctionEditor.set("parent",a.parent),arcgisonline.map.main.rasterFunctionEditor.set("item",a.item),arcgisonline.map.main.rasterFunctionEditor.open()):this.loadNewEditor(a))},updateRFxEditor:function(a){a&&arcgisonline.map.main.rasterFunctionEditor&&a.parent&&arcgisonline.map.main.rasterFunctionEditor.set("parent",a.parent)},loadNewEditor:function(a){a=a||{};a.showOnStart=
!0;arcgisonline.map.main.rasterFunctionEditor=null;a=new arcgisonline.sharing.dijit.RasterFunctionEditor(a,b.place(b.create("div"),document.body,"last"));a.startup();b.place(a.domNode,document.body);arcgisonline.map.main.rasterFunctionEditor=a},dojoPatch:function(){b.mixin(r.byId("dijitToolbar"),{_onContainerKeypress:function(a){if(!a.ctrlKey&&!a.altKey&&a.keyCode!=b.keys.HOME&&a.keyCode!=b.keys.END&&a.keyCode!=b.keys.LEFT_ARROW&&a.keyCode!=b.keys.RIGHT_ARROW){var c=this._keyNavCodes[a.charOrCode];
c&&(c(),event.stop(a))}}})}}});